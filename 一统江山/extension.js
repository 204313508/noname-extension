game.import("extension",{name:"一统江山",content:function (config,pack){
    
},precontent:function (){
    
},help:{"一统江山":"<ul type=\"circle\"><li>特殊类皮肤扩展包</li>【更新公告】<br/><br/><li>2017.4.11 更新</li><li>更新武将：佳期若梦,一世风华,谑浪笑傲 体验本拓展请关闭兼容模式</li>【配音包说明】<br/><br/><li>解压一统江山配音包</li><li>吧解压出来的文件夹里的文件</li><li>放到游戏根目录下，相对应的文件加里面</li><li>欢迎大家在群里反馈bug以及各种问题</li><li>QQ群号 113606756</li></ul>"},config:{},package:{
    character:{
        character:{
            "魏武东临":["male","wei",6,["gui1","护驾"],["zhu"]],
            "醉玉颓山":["male","wei",6,["慷慨"],[]],
            "业火红莲":["male","wu",4,["天火","琴音"],[]],
            "白衣渡江":["male","wu",7,["白衣","圣光"],["zhu"]],
            "一统江山":["male","wei",8,["千影","归心"],["zhu"]],
            "观星唤雨":["male","shu",6,["星辰","晨雾","暴风"],[]],
            "战神金刚":["male","qun",5,["暴走","神怒","无前","邪神"],[]],
            "狂傲不羁":["male","shu",10,["fangu","善谋"],[]],
            "魏王称帝":["male","wei",4,["放生","送葬","颂威"],["zhu"]],
            "恢拓洪业":["male","wei",4,["宏图","明主","兴衰"],["zhu"]],
            "绰约多姿":["female","wei",4,["情逝","无情"],[]],
            "烈帝后裔":["male","shu",5,["死战","北地王"],["zhu"]],
            "武继先人":["female","shu",6,["血舞","龙啸","继武"],[]],
            "翩若惊鸿":["female","wei",6,["惊鸿","qing1","文昭"],[]],
            "从征四方":["male","wei",6,["变阵"],[]],
            "符檄擅声":["male","wei",5,["songwen","口诛"],[]],
            "猛勇精进":["male","wei",6,["突进"],[]],
            "威震华夏":["male","shu",7,["赤魂"],[]],
            "枪碎星河":["female","shu",6,["淑德","枪魂"],[]],
            "胸中兵甲":["male","shu",6,["谣言","控蛮"],[]],
            "浴火蛮神":["female","shu",8,["象阵","巨刃"],[]],
            "彪劲虎卫":["male","wei",6,["抛戟","横冲"],[]],
            "明以举贤":["male","wei",5,["王佐","驱虎吞狼"],[]],
            "神兵天降":["male","wei",7,["qibing","天险","积粮"],[]],
            "抬棺决死":["male","wei",6,["抬棺"],[]],
            "单骑千里":["male","wei",8,["鬼武","护行"],[]],
            "鬼谋乱世":["male","wei",5,["怂乱","千虑","zhenlue"],[]],
            "婉娩流逸":["female","wei",6,["旧情","默书"],[]],
            "挥剑惊石":["male","wei",5,["战勋","举兵"],[]],
            "握筹布画":["male","wei",5,["伏兵","刚直"],[]],
            "镇卫江夏":["male","wei",6,["镇守"],[]],
            "仁爱神童":["male","wei",7,["仁爱","神童"],[]],
            "破羌攻胡":["male","wei",8,["精算"],[]],
            "傲雪凌霜":["male","wei",7,["迂回","趋向"],[]],
            "七步绝章":["male","wei",6,["落梅","妙笔"],["zhu"]],
            "威重严整":["male","wei",7,["严整"],[]],
            "十二奇策":["male","wei",6,["外愚","妙策"],[]],
            "精练策数":["male","wei",8,["权宜","起兵"],[]],
            "镇守魏南":["male","wei",6,["酷法","御敌"],[]],
            "雷霆之威":["male","wei",7,["制敌"],[]],
            "清流雅望":["male","wei",5,["中正","法定"],[]],
            "下辩扬威":["male","wei",7,["驹骑","虎豹"],[]],
            "诗礼之训":["male","wei",6,["墨心","辅佐"],[]],
            "猛击劈浪":["male","wei",7,["劈浪"],[]],
            "魏武霸业":["male","wei",9,["雄才","护主"],["zhu"]],
            "辅政平乱":["male","wei",6,["料敌","谋士"],[]],
            "身先士卒":["male","wei",7,["獠牙","mashu","偷营"],[]],
            "势如破竹":["male","wei",7,["虎痴","狂拳"],[]],
            "破虏大将":["male","wei",7,["厚兵","破虏"],[]],
            "试尝百草":["male","wei",5,["病疾","兵谋"],[]],
            "御驾亲征":["male","shu",7,["烈帝","亲征"],["zhu"]],
            "浴火士元":["male","shu",6,["铁索","落凤"],[]],
            "逸群之才":["male","shu",5,["燃火","八卦","看穿"],[]],
            "烽火乱世":["male","shu",6,["胆略","承志"],[]],
            "挤眉弄眼":["male","shu",6,["后主","简政","愚智"],["zhu"]],
            "轻舞花烛":["female","shu",6,["助威","归吴"],[]],
            "虎将无双":["male","shu",8,["虎将"],[]],
            "白眉智士":["male","shu",6,["协睦","蛮兵"],[]],
            "计斩妙才":["male","shu",7,["恩仇","辅翼"],[]],
            "一言不发":["male","shu",4,["不言","洞察"],[]],
            "老骥伏枥":["male","shu",6,["先锋","迟暮"],[]],
            "龙吟九霄":["male","shu",7,["青龙"],[]],
            "平北将军":["male","shu",7,["潜行","mashu"],[]],
            "立嗣陷危":["male","shu",8,["危嗣"],["zhu"]],
            "大展宏图":["male","shu",7,["过目","展图"],[]],
            "忠勇当先":["male","shu",6,["忠胆"],[]],
            "采映荷灯":["female","shu",5,["采樵","呢喃"],[]],
            "持权贪贿":["male","shu",4,["祸乱","贿赂"],[]],
            "舐犊情深":["female","shu",6,["昭烈","智心"],[]],
            "断石酬志":["male","shu",7,["仁王","御驾"],["zhu"]],
            "单刀赴会":["male","shu",8,["烈武","恩断","匡汉"],[]],
            "智擒严颜":["male","shu",8,["豪气","真假"],[]],
            "寒光凛然":["male","shu",8,["绝尘","横枪","咫尺","沧海"],[]],
            "西凉雄狮":["male","shu",9,["西凉","骑乘"],[]],
            "侠义谋略":["male","shu",6,["谋杀","弃武"],[]],
            "绝色异彩":["female","wei",7,["玉碎","孤险"],[]],
            "心系君魂":["female","wei",6,["诏书","禅心"],[]],
            "空城退敌":["male","shu",5,["险计","星象"],[]],
            "一世风华":["male","wei",6,["惊天","遗策","悟法","锦计"],[]],
            "佳期若梦":["male","wei",6,["狼顾","改命","shenmou","伟略"],[]],
            "谑浪笑傲":["male","shu",7,["辩论","使臣"],[]],
        },
        translate:{
            "魏武东临":"魏武东临",
            "醉玉颓山":"醉玉颓山",
            "业火红莲":"业火红莲",
            "白衣渡江":"白衣渡江",
            "一统江山":"一统江山",
            "观星唤雨":"观星唤雨",
            "战神金刚":"战神金刚",
            "狂傲不羁":"狂傲不羁",
            "魏王称帝":"魏王称帝",
            "恢拓洪业":"恢拓洪业",
            "绰约多姿":"绰约多姿",
            "烈帝后裔":"烈帝后裔",
            "武继先人":"武继先人",
            "翩若惊鸿":"翩若惊鸿",
            "从征四方":"从征四方",
            "符檄擅声":"符檄擅声",
            "猛勇精进":"猛勇精进",
            "威震华夏":"威震华夏",
            "枪碎星河":"枪碎星河",
            "胸中兵甲":"胸中兵甲",
            "浴火蛮神":"浴火蛮神",
            "彪劲虎卫":"彪劲虎卫",
            "明以举贤":"明以举贤",
            "神兵天降":"神兵天降",
            "抬棺决死":"抬棺决死",
            "单骑千里":"单骑千里",
            "鬼谋乱世":"鬼谋乱世",
            "婉娩流逸":"婉娩流逸",
            "挥剑惊石":"挥剑惊石",
            "握筹布画":"握筹布画",
            "镇卫江夏":"镇卫江夏",
            "仁爱神童":"仁爱神童",
            "破羌攻胡":"破羌攻胡",
            "傲雪凌霜":"傲雪凌霜",
            "七步绝章":"七步绝章",
            "威重严整":"威重严整",
            "十二奇策":"十二奇策",
            "精练策数":"精练策数",
            "镇守魏南":"镇守魏南",
            "雷霆之威":"雷霆之威",
            "清流雅望":"清流雅望",
            "下辩扬威":"下辩扬威",
            "诗礼之训":"诗礼之训",
            "猛击劈浪":"猛击劈浪",
            "魏武霸业":"魏武霸业",
            "辅政平乱":"辅政平乱",
            "身先士卒":"身先士卒",
            "势如破竹":"势如破竹",
            "破虏大将":"破虏大将",
            "试尝百草":"试尝百草",
            "御驾亲征":"御驾亲征",
            "浴火士元":"浴火士元",
            "逸群之才":"逸群之才",
            "烽火乱世":"烽火乱世",
            "挤眉弄眼":"挤眉弄眼",
            "轻舞花烛":"轻舞花烛",
            "虎将无双":"虎将无双",
            "白眉智士":"白眉智士",
            "计斩妙才":"计斩妙才",
            "一言不发":"一言不发",
            "老骥伏枥":"老骥伏枥",
            "龙吟九霄":"龙吟九霄",
            "平北将军":"平北将军",
            "立嗣陷危":"立嗣陷危",
            "大展宏图":"大展宏图",
            "忠勇当先":"忠勇当先",
            "采映荷灯":"采映荷灯",
            "持权贪贿":"持权贪贿",
            "舐犊情深":"舐犊情深",
            "断石酬志":"断石酬志",
            "单刀赴会":"单刀赴会",
            "智擒严颜":"智擒严颜",
            "寒光凛然":"寒光凛然",
            "西凉雄狮":"西凉雄狮",
            "侠义谋略":"侠义谋略",
            "绝色异彩":"绝色异彩",
            "心系君魂":"心系君魂",
            "空城退敌":"空城退敌",
            "一世风华":"一世风华",
            "佳期若梦":"佳期若梦",
            "谑浪笑傲":"谑浪笑傲",
        },
    },
    card:{
        card:{
        },
        translate:{
        },
        list:[],
    },
    skill:{
        skill:{
            "慷慨":{
                audio:["慷慨",2],
                trigger:{
                    global:"shaBegin",
                },
                filter:function (event,player){
        return get.distance(player,event.target)<=99;
    },
                check:function (event,player){
        return ai.get.attitude(player,event.target)>=0;
    },
                content:function (){
        "step 0"
        player.draw(2);
        player.recover();
        if(trigger.target!=player){
            player.chooseCard(true,'he','交给'+get.translation(trigger.target)+'一张牌').set('ai',function(card){
                if(get.position(card)=='e') return -1;
                if(card.name=='shan') return 1;
                if(get.type(card)=='equip') return 0.5;
                return 0;
            });
        }
        else{
            event.finish();
        }
        "step 1"
        trigger.target.gain(result.cards);
        player.$give(result.cards,trigger.target);
        game.delay();
        event.card=result.cards[0];
        if(get.type(event.card)!='equip') event.finish();
        "step 2"
        if(!trigger.target.isMin()){
            trigger.target.chooseBool('是否装备'+get.translation(event.card)+'？').set('ai',function(){
                var current=_status.event.player.get('e',{subtype:get.subtype(_status.event.card)});
                if(current&&current.length){
                    return ai.get.equipValue(event.card)>ai.get.equipValue(current[0]);
                }
                return true;
            }).set('card',event.card);
        }
        else{
            event.finish();
        }
        "step 3"
        if(result.bool){
            trigger.target.equip(event.card);
        }
    },
                ai:{
                    threaten:1.1,
                },
            },
            "天火":{
                unique:true,
                enable:"phaseUse",
                audio:["天火",2],
                animationColor:"fire",
                skillAnimation:"legend",
                filter:function (event,player){
        return !player.storage.天火;
    },
                init:function (player){
        player.storage.天火=false;
    },
                filterTarget:function (card,player,target){
        var length=ui.selected.cards.length;
        return player!=target&&(length==0||length==4);
    },
                filterCard:function (card){
        var suit=get.suit(card);
        for(var i=0;i<ui.selected.cards.length;i++){
            if(get.suit(ui.selected.cards[i])==suit) return false;
        }
        return true;
    },
                mark:true,
                selectCard:[0,4],
                line:"fire",
                check:function (){return -1},
                selectTarget:function (){
        if(ui.selected.cards.length==4) return 1;
        if(ui.selected.cards.length==0) return [1,3];
        game.uncheck('target');
        return [1,3];
    },
                content:function (){
        player.unmark('天火');
        player.storage.天火=true;
        if(cards.length==4){
            player.recover(1);
            target.damage('fire',6);
        }
        else{
            target.damage('fire');
        }
    },
                intro:{
                    content:"limited",
                },
                ai:{
                    order:1,
                    result:{
                        target:function (player,target){
                if(target.hasSkillTag('nofire')) return 0;
                if(lib.config.mode=='versus') return -1;
                for(var i=0;i<game.players.length;i++){
                    if(lib.config.mode=='identity'){
                        if(game.players[i].ai.shown<=0.2) return 0;
                    }
                    else if(lib.config.mode=='guozhan'){
                        if(game.players[i].identity=='unknown') return 0;
                    }
                }
                return ai.get.damageEffect(target,player);
            },
                    },
                },
            },
            "琴音":{
                audio:["琴音",2],
                trigger:{
                    player:"phaseDiscardEnd",
                },
                direct:true,
                filter:function (event,player){
        return event.cards&&event.cards.length>1
    },
                content:function (){
        "step 0"
        if(typeof event.count!='number'){
            // event.count=trigger.cards.length-1;
            event.count=1;
        }
        var recover=0,lose=0;
        for(var i=0;i<game.players.length;i++){
            if(!game.players[i].isOut()){
                if(game.players[i].hp<game.players[i].maxHp){
                    if(ai.get.attitude(player,game.players[i])>0){
                        if(game.players[i].hp<2){
                            lose--;
                            recover+=0.5;
                        }
                        lose--;
                        recover++;
                    }
                    else if(ai.get.attitude(player,game.players[i])<0){
                        if(game.players[i].hp<2){
                            lose++;
                            recover-=0.5;
                        }
                        lose++;
                        recover--;
                    }
                }
                else{
                    if(ai.get.attitude(player,game.players[i])>0){
                        lose--;
                    }
                    else if(ai.get.attitude(player,game.players[i])<0){
                        lose++;
                    }
                }
            }
        }
        var prompt=get.prompt('琴音')+'（剩余'+get.cnNumber(event.count)+'次）';
        player.chooseControl('失去体力','回复体力','cancel',
        ui.create.dialog(get.prompt('琴音'),'hidden')).ai=function(){
            if(lose>recover&&lose>0) return 0;
            if(lose<recover&&recover>0) return 1;
            return 2;
        }
        "step 1"
        if(result.bool==false||result.control=='cancel'){
            event.finish();
        }
        else{
            player.logSkill('琴音');
            event.bool=(result.control=='回复体力');
            event.num=0;
            event.players=game.players.slice(0);
        }
        "step 2"
        if(event.num<event.players.length){
            var target=event.players[event.num];
            if(event.bool){
                target.recover(2);
                player.draw(3);
            }
            else{
                target.loseHp(2);
                player.gainMaxHp();
            }
            event.num++;
            event.redo();
        }
        "step 3"
        if(event.count>1){
            event.count--;
            event.goto(0);
        }
    },
                ai:{
                    expose:0.1,
                    threaten:2,
                },
            },
            "白衣":{
                audio:["白衣",2],
                group:"白衣2",
                trigger:{
                    player:"phaseDrawBefore",
                },
                content:function (){
        "step 0"
        trigger.untrigger();
        trigger.finish();
        "step 1"
        event.cards=get.cards(10);
        if(event.isMine()==false){
            event.dialog=ui.create.dialog('白衣',event.cards);
            game.delay(2);
        }
        "step 2"
        if(event.dialog) event.dialog.close();
        var dialog=ui.create.dialog('白衣',event.cards);
        player.chooseButton([0,5],dialog,true).filterButton=function(button){
            for(var i=0;i<ui.selected.buttons.length;i++){
                if(get.suit(button.link)==get.suit(ui.selected.buttons[i].link)) return false;
            }
            return true;
        }
        "step 3"
        var cards2=[];
        for(var i=0;i<result.buttons.length;i++){
            cards2.push(result.buttons[i].link);
            cards.remove(result.buttons[i].link);
        }
        player.gain(cards2);
        if(cards2.length) player.$gain(cards2);
        for(var i=0;i<cards.length;i++){
            ui.discardPile.appendChild(cards[i]);
        }
        game.delay(2);
    },
                ai:{
                    threaten:1.2,
                },
            },
            "圣光":{
                audio:["圣光",2],
                enable:"phaseUse",
                usable:3,
                filterTarget:function (card,player,target){
        return target!=player&&target.num('h');
    },
                content:function (){
        "step 1"
        event.videoId=lib.status.videoId++;
        var cards=target.get('h');
        if(player.isOnline2()){
            player.send(function(cards,id){
                ui.create.dialog('圣光',cards).videoId=id;
            },cards,event.videoId);
        }
        event.dialog=ui.create.dialog('圣光',cards);
        event.dialog.videoId=event.videoId;
        if(!event.isMine()){
            event.dialog.style.display='none';
        }
        player.chooseButton().set('filterButton',function(button){
            return get.suit(button.link)=='heart';
        }).set('dialog',event.videoId);
        "step 2"
        if(result.bool){
            event.card=result.links[0];
            var func=function(card,id){
                var dialog=get.idDialog(id);
                if(dialog){
                    for(var i=0;i<dialog.buttons.length;i++){
                        if(dialog.buttons[i].link==card){
                            dialog.buttons[i].classList.add('selectedx');
                        }
                        else{
                            dialog.buttons[i].classList.add('unselectable');
                        }
                    }
                }
            }
            if(player.isOnline2()){
                player.send(func,event.card,event.videoId);
            }
            else if(event.isMine()){
                func(event.card,event.videoId);
            }
            player.chooseControl('弃置','放到牌堆顶');
        }
        else{
            if(player.isOnline2()){
                player.send('closeDialog',event.videoId);
            }
            event.dialog.close();
            event.finish();
        }
        "step 3"
        if(player.isOnline2()){
            player.send('closeDialog',event.videoId);
        }
        event.dialog.close();
        var card=event.card;
        if(result.control=='放到牌堆顶'){
            target.lose(card);
            player.showCards(card,'置于牌堆顶');
            player.draw(2);
        }
        else{
            target.discard(card);
            event.finish();
            player.recover();
        }
        "step 4"
        event.card.fix();
        ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
        game.log(player,'将',event.card,'置于牌堆顶');
    },
                ai:{
                    threaten:1.5,
                    result:{
                        target:function (player,target){
                return -target.num('h');
            },
                    },
                    order:10,
                    expose:0.4,
                },
            },
            "归心":{
                audio:["归心",2],
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                check:function (event,player){
        if(player.isTurnedOver()) return true;
        var num=0;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].num('he')&&game.players[i]!=player&&
                ai.get.attitude(player,game.players[i])<=0){
                num++;
            }
            if(game.players[i].num('j')&&game.players[i]!=player&&
                ai.get.attitude(player,game.players[i])<=0){
                num++;
            }
            if(num>=2) return true;
        }
        return false;
    },
                content:function (){
        "step 0"
        var targets=game.players.slice(0);
        targets.remove(player);
        targets.sort(lib.sort.seat);
        event.targets=targets;
        event.num=0;
        "step 1"
        if(num<event.targets.length){
            if(event.targets[num].num('hej')){
                player.gainPlayerCard(2,event.targets[num],'hej',true);
            }
            event.num++;
            event.redo();
        }
        "step 2"
        player.turnOver();
    },
                ai:{
                    maixie:true,
                    threaten:function (player,target){
            if(target.hp==1) return 2.5;
            return 1;
        },
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(player.hasSkill('jueqing')) return [1,-2];
                    if(target.hp==1) return;
                    if(target.isTurnedOver()) return [0,3];
                    var num=0;
                    for(var i=0;i<game.players.length;i++){
                        if(game.players[i].num('he')&&game.players[i]!=player&&
                            ai.get.attitude(player,game.players[i])<=0){
                            num++;
                        }
                        if(game.players[i].num('j')&&game.players[i]!=player&&
                            ai.get.attitude(player,game.players[i])>0){
                            num++;
                        }
                        if(num>2) return [0,1];
                        if(num==2) return [0.5,1];
                    }
                }
            },
                    },
                },
            },
            "千影":{
                enable:"chooseToUse",
                filter:function (event,player){
        return _status.currentPhase!=player;
    },
                filterCard:function (card){
        return get.color(card)==('red','black');
    },
                position:"he",
                viewAs:{
                    name:"tao",
                    suit:"club",
                    number:2,
                },
                prompt:"将一张牌当桃使用",
                check:function (card){return 15-ai.get.value(card)},
                ai:{
                    skillTagFilter:function (player){
            return player.num('he',{color:('red','black')})>0&&_status.currentPhase!=player;
        },
                    threaten:1.5,
                    save:true,
                    basic:{
                        order:function (card,player){
                if(player.hasSkillTag('pretao')) return 5;
                return 2;
            },
                        useful:[8,6.5],
                        value:[8,6.5],
                    },
                    result:{
                        target:function (player,target){
                // if(player==target&&player.hp<=0) return 2;
                var nh=target.num('h');
                var keep=false;
                if(nh<=target.hp){
                    keep=true;
                }
                else if(nh==target.hp+1&&target.hp>=2&&target.num('h','tao')<=1){
                    keep=true;
                }
                var mode=get.mode();
                if(target.hp>=2&&keep&&target.hasFriend()){
                    if(target.hp>2) return 0;
                    if(target.hp==2){
                        for(var i=0;i<game.players.length;i++){
                            if(target!=game.players[i]&&ai.get.attitude(target,game.players[i])>=3){
                                if(game.players[i].hp<=1) return 0;
                                if(mode=='identity'&&game.players[i].isZhu&&game.players[i].hp<=2) return 0;
                            }
                        }
                    }
                }
                if(target.hp<0&&target!=player&&target.identity!='zhu') return 0;
                var att=ai.get.attitude(player,target);
                if(att<3&&att>=0&&player!=target) return 0;
                var tri=_status.event.getTrigger();
                if(mode=='identity'&&player.identity=='fan'&&target.identity=='fan'){
                    if(tri&&tri.name=='dying'&&tri.source&&tri.source.identity=='fan'&&tri.source!=target){
                        var num=0;
                        for(var i=0;i<game.players.length;i++){
                            if(game.players[i].identity=='fan'){
                                num+=game.players[i].num('h','tao');
                                if(num>2) return 2;
                            }
                        }
                        if(num>1&&player==target) return 2;
                        return 0;
                    }
                }
                if(mode=='identity'&&player.identity=='zhu'&&target.identity=='nei'){
                    if(tri&&tri.name=='dying'&&tri.source&&tri.source.identity=='zhong'){
                        return 0;
                    }
                }
                if(mode=='stone'&&target.isMin()&&
                player!=target&&tri&&tri.name=='dying'&&player.side==target.side&&
                tri.source!=target.getEnemy()){
                    return 0;
                }
                return 2;
            },
                    },
                    tag:{
                        recover:1,
                        save:1,
                    },
                },
                mod:{
                    globalTo:function (from,to,distance){
            return distance+2;
        },
                },
            },
            "星辰":{
                audio:["星辰",2],
                group:"xingchen7",
                unique:true,
                trigger:{
                    global:"gameDrawAfter",
                    player:"phaseBegin",
                },
                forced:true,
                check:function (event,player){
        return player.hp<=1;
    },
                filter:function (event,player){
        return !player.storage.星辰;
    },
                content:function (){
        "step 0"
        player.gain(get.cards(20))._triggered=null;
        "step 1"
        if(player==game.me){
            game.addVideo('delay',null);
        }
        player.chooseCard('选择十张牌作为星',10,true).ai=function(card){
            return ai.get.value(card);
        };
        "step 2"
        player.lose(result.cards,ui.special)._triggered=null;
        player.storage.星辰=result.cards;
        game.addVideo('storage',player,['星辰',get.cardsInfo(player.storage.星辰),'cards']);
    },
                mark:true,
                intro:{
                    mark:function (dialog,content,player){
            if(content&&content.length){
                if(player==game.me||player.isUnderControl()){
                    dialog.add(content);
                }
                else{
                    return '共有'+get.cnNumber(content.length)+'张星';
                }
            }
        },
                    content:function (content,player){
            if(content&&content.length){
                if(player==game.me||player.isUnderControl()){
                    return get.translation(content);
                }
                return '共有'+get.cnNumber(content.length)+'张星';
            }
        },
                },
            },
            "晨雾":{
                unique:true,
                trigger:{
                    player:"phaseEnd",
                },
                priority:1,
                direct:true,
                filter:function (event,player){
        return player.storage.星辰&&player.storage.星辰.length;
    },
                audio:["晨雾",2],
                content:function (){
        "step 0"
        player.chooseTarget('选择角色获得晨雾标记',
        [1,Math.min(game.players.length,player.storage.星辰.length)]).ai=function(target){
            if(target.isMin()) return 0;
            if(target.hasSkill('biantian2')) return 0;
            var att=ai.get.attitude(player,target);
            if(att>=4){
                if(target.hp==1&&target.maxHp>2) return att;
                if(target.hp==2&&target.maxHp>3&&target.num('he')==0) return att*0.7;
                return 0;
            }
            return -1;
        }
        "step 1"
        if(result.bool){
            var length=result.targets.length;
            for(var i=0;i<length;i++){
                result.targets[i].addSkill('chenwu2');
                result.targets[i].popup('晨雾');
            }
            player.logSkill('晨雾',result.targets,'thunder');
            game.log(player,'对',result.targets,'发动了晨雾')
            player.chooseCardButton('弃置'+get.cnNumber(length)+'枚星',length,player.storage.星辰,true);
        }
        else{
            event.finish();
        }
        "step 2"
        for(var i=0;i<result.links.length;i++){
            player.storage.星辰.remove(result.links[i]);
        }
        if(player.storage.星辰.length==0){
            player.unmarkSkill('星辰');
        }
        game.addVideo('storage',player,['星辰',get.cardsInfo(player.storage.星辰),'cards']);
        player.discard(result.links);
    },
                group:"chenwu3",
            },
            "暴风":{
                unique:true,
                audio:["暴风",2],
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        return player.storage.星辰&&player.storage.星辰.length;
    },
                content:function (){
        "step 0"
        player.chooseTarget('选择一名角色获得暴风标记').ai=function(target){
            return -1;
        }
        "step 1"
        if(result.bool){
            var length=result.targets.length;
            for(var i=0;i<length;i++){
                result.targets[i].addSkill('baofeng2');
                result.targets[i].popup('暴风');
            }
            player.logSkill('暴风',result.targets,'fire');
            player.chooseCardButton('弃置'+get.cnNumber(length)+'枚星',length,player.storage.星辰,true);
        }
        else{
            event.finish();
        }
        "step 2"
        for(var i=0;i<result.links.length;i++){
            player.storage.星辰.remove(result.links[i]);
        }
        if(player.storage.星辰.length==0){
            player.unmarkSkill('星辰');
        }
        game.addVideo('storage',player,['星辰',get.cardsInfo(player.storage.星辰),'cards']);
        player.discard(result.links);
    },
            },
            "暴走":{
                trigger:{
                    source:"damageEnd",
                    player:"damageEnd",
                },
                forced:true,
                mark:true,
                audio:["暴走",2],
                filter:function (event){
        return event.num>0;
    },
                init:function (player){
        player.storage.暴走=4;
        game.addVideo('storage',player,['暴走',player.storage.暴走]);
    },
                content:function (){
        player.storage.暴走+=trigger.num;
        game.addVideo('storage',player,['暴走',player.storage.暴走]);
    },
                intro:{
                    content:"mark",
                },
            },
            "神怒":{
                audio:["神怒",2],
                enable:"phaseUse",
                filter:function (event,player){
        return !player.storage.神怒&&player.storage.暴走>=6;
    },
                init:function (player){
        player.storage.神怒=false;
    },
                skillAnimation:true,
                animationColor:"metal",
                mark:true,
                content:function (){
        "step 0"
        player.unmark('神怒');
        player.storage.神怒=false;
        player.storage.暴走-=6;
        event.targets=game.players.slice(0);
        event.targets.remove(player);
        event.targets.sort(lib.sort.seat);
        event.targets2=event.targets.slice(0);
        player.turnOver();
        "step 1"
        if(event.targets.length){
            event.targets.shift().damage(2);
            event.redo();
        }
        "step 2"
        if(event.targets2.length){
            var cur=event.targets2.shift();
            if(cur&&cur.num('he')){
                cur.chooseToDiscard('he',true,6);
            }
            event.redo();
        }
    },
                intro:{
                    content:"limited",
                },
                ai:{
                    order:10,
                    result:{
                        player:function (player){
                var num=0;
                for(var i=0;i<game.players.length;i++){
                    if(game.players[i]!=player){
                        if(game.players[i].ai.shown==0) return 0;
                        num+=ai.get.damageEffect(game.players[i],player,player)>0?1:-1;
                    }
                }
                return num;
            },
                    },
                },
            },
            "无前":{
                audio:["无前",2],
                enable:"phaseUse",
                filter:function (event,player){
        return player.storage.暴走>=1;
    },
                content:function (){
        player.storage.暴走-=2;
        player.addTempSkill('wushuang','phaseAfter');
    },
                ai:{
                    order:5,
                    result:{
                        player:function (player){
                if(!player.storage.shenfen) return 0;
                var cards=player.get('h','sha');
                if(cards.length){
                    for(var i=0;i<game.players.length;i++){
                        if(player.canUse('sha',game.players[i])&&
                        ai.get.effect(game.players[i],cards[0],player,player)>0&&
                        game.players[i].num('h','shan')){
                            return 1;
                        }
                    }
                }
                return 0;
            },
                    },
                },
            },
            "邪神":{
                trigger:{
                    player:"turnOverBefore",
                },
                forced:true,
                content:function (){
        trigger.untrigger();
        trigger.finish();
    },
                ai:{
                    noturnOver:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'turnOver')) return [0,0];
            },
                    },
                },
                group:["魔神"],
            },
            "放生":{
                audio:["放生",2],
                trigger:{
                    player:"damageEnd",
                },
                filter:function (event, player) {
        return event.source != undefined;
    },
                check:function (event, player) {
        return (ai.get.attitude(player, event.source) <= 0);
    },
                content:function () {
        'step 0'
        trigger.source.judge(function (card) {
            player.storage.放生 = get.color(card);
            var num = 0;
            if (player.storage.放生 == 'red')
            player.draw(2);
            player.gainMaxHp();
        });
        'step 1'
        if (player.storage.放生 == 'black')
            trigger.source.loseMaxHp(2)._triggered=null;
    },
            },
            "送葬":{
                audio:["送葬",2],
                trigger:{
                    global:"dieAfter",
                },
                frequent:true,
                content:function (){
        player.draw(5);
        player.recover(888)._triggered=null;
    },
            },
            "颂威":{
                unique:true,
                global:"songwei5",
                zhuSkill:true,
            },
            "魔神":{
                audio:"ext:一统江山:true",
                rigger:{
                    player:"damageBegin",
                },
                forced:true,
                filter:function (event,player){
        if(event.num<=1) return false;
        if(event.parent.player.num('s','unequip')) return false;
        return true;
    },
                priority:-10,
                content:function (){
        trigger.num--;
    },
            },
            "chenwu3":{
                trigger:{
                    player:["phaseBegin","dieBegin"],
                },
                forced:true,
                popup:false,
                silent:true,
                content:function (){
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].hasSkill('chenwu2')){
                game.players[i].removeSkill('chenwu2');
                game.players[i].popup('chenwu2');
            }
            if(game.players[i].hasSkill('baofeng2')){
                game.players[i].removeSkill('baofeng2');
                game.players[i].popup('baofeng2');
            }
        }
    },
            },
            "chenwu2":{
                trigger:{
                    player:["damageBefore","loseHpBefor"],
                },
                filter:function (event){
        if(event.nature!='thunder') return true;
        return false;
    },
                mark:true,
                forced:true,
                content:function (){
        trigger.untrigger();
        trigger.finish();
    },
                ai:{
                    nofire:true,
                    nodamage:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'damage')&&!get.tag(card,'thunderDamage')) return [0,0];
            },
                    },
                },
                intro:{
                    content:"已获得辰雾标记",
                },
            },
            "baofeng2":{
                trigger:{
                    player:"damageBegin",
                },
                filter:function (event){
        if(event.nature=='fire') return true;
        return false;
    },
                mark:true,
                intro:{
                    content:"已获得暴风标记",
                },
                forced:true,
                content:function (){
        trigger.num+=2;
    },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'fireDamage')) return 1.5;
            },
                    },
                },
            },
            "宏图":{
                audio:["宏图",2],
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                direct:true,
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('宏图')).set('ai',function(target){
            var player=_status.event.player;
            if(ai.get.attitude(player,target)>0){
                return ai.get.recoverEffect(target,player,player)+1;
            }
            return 0;
        });
        'step 1'
        if(result.bool){
            player.logSkill('宏图',result.targets);
            var target=result.targets[0];
            event.target=target;
            target.judge(function(card){
                if(target.hp==target.maxHp){
                    if(get.color(card)=='red') return 0;
                }
                if(get.color(card)=='red') return 1.5;
                return 1;
            });
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.color){
            if(result.color=='red'){
                if(event.target.hp<event.target.maxHp) event.target.recover();
            }
            else{
                event.target.gainMaxHp(trigger.num);
                event.target.draw(trigger.num);
            }
        }
    },
            },
            "明主":{
                audio:["明主",2],
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        return player!=target;
    },
                filter:function (event,player){
        return player.num('h')>0;
    },
                filterCard:true,
                selectCard:-1,
                discard:false,
                lose:true,
                content:function (){
        player.$give(cards.length,target);
        target.gain(cards);
        target.addTempSkill('mingzhu2',{player:'phaseAfter'});
        player.recover();
    },
                ai:{
                    order:1,
                    result:{
                        target:function (player,target){
                if(player.num('h')==1&&player.num('h','du')) return -1;
                if(player.hp<=2&&player.num('h','shan')) return 0;
                if(target.num('h')+player.num('h')>target.hp+2) return 0;
                if(ai.get.attitude(player,target)>3) return 1;
                return 0;
            },
                    },
                },
            },
            "mingzhu2":{
                mark:true,
                intro:{
                    content:"手牌上限+2，与其他角色计算距离-2",
                },
                mod:{
                    maxHandcard:function (player,num){
                    return num+2;
                },
                    globalFrom:function (fiom,to,distance){
                    return distance-2;
                },
                },
            },
            "兴衰":{
                skillAnimation:true,
                audio:["兴衰",2],
                trigger:{
                    player:"dying",
                },
                priority:6,
                zhuSkill:true,
                filter:function (event,player){
        if(player.storage.xingshuai) return false;
        if(player.hp>0) return false;
        if(!player.hasZhuSkill('xingshuai')) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i]!=player&&game.players[i].group=='wei') return true;
        }
        return false;
    },
                init:function (player){
        if(player.hasZhuSkill('xingshuai')){
            player.markSkill('xingshuai');
            player.storage.xingshuai=false;
        }
    },
                intro:{
                    content:"limited",
                },
                unique:true,
                content:function (){
        'step 0'
        player.storage.xingshuai=true;
        player.unmarkSkill('xingshuai');
        var targets=get.players();
        targets.remove(player);
        event.targets=targets;
        event.damages=[];
        'step 1'
        if(event.targets.length){
            var current=event.targets.shift();
            if(current.group=='wei'){
                current.chooseBool('是否令'+get.translation(player)+'回复一点体力？').set('ai',function(){
                    return ai.get.attitude(_status.event.player,_status.event.target)>2;
                }).set('target',player);
                event.current=current;
            }
            else{
                event.redo();
            }
        }
        else{
            event.goto(3);
        }
        'step 2'
        if(result.bool){
            event.damages.push(event.current);
            event.current.line(player,'green');
            game.log(event.current,'令',player,'回复一点体力');
        }
        if(event.targets.length){
            event.goto(1);
        }
        'step 3'
        if(event.damages.length){
            player.recover(event.damages.length);
        }
        'step 4'
        if(event.damages.length){
            event.damages.shift().damage('nosource');
            event.redo();
        }
    },
            },
            "情逝":{
                audio:["情逝",2],
                trigger:{
                    player:["loseEnd","changeHp"],
                },
                forced:true,
                filter:function (event,player){
        return (player.num('h')<Math.min(player.maxHp-player.hp));
    },
                content:function (){
        player.draw(Math.min(player.maxHp-player.hp)-player.num('h'));
        player.gainMaxHp();
        player.recover();
    },
                ai:{
                    noh:true,
                    skillTagFilter:function (player,tag){
            if(tag=='noh'&&player.maxHp-player.hp<player.num('h')){
                return false;
            }
        },
                },
            },
            "无情":{
                trigger:{
                    source:"damageBefore",
                },
                forced:true,
                audio:["无情",2],
                priority:16,
                check:function (){return false;},
                content:function (){
        trigger.untrigger();
        trigger.finish();
        var ex=0;
        if(trigger.card&&trigger.card.name=='sha'){
            if(player.hasSkill('jiu')) ex++;
            if(player.hasSkill('luoyi2')) ex++;
            if(player.hasSkill('reluoyi2')) ex++;
        }
        trigger.player.loseHp(trigger.num+ex);
    },
            },
            "songwei5":{
                audio:["颂威",2],
                forceaudio:true,
                trigger:{
                    player:"judgeEnd",
                },
                filter:function (event,player){
                if(player.group!='wei') return false;
                if(get.color(event.result.card)!='black') return false;
                return game.hasPlayer(function(target){
            return player!=target&&target.hasZhuSkill('颂威',player);
                });
},
                direct:true,
                content:function (){
        'step 0'
        var list=[];
        for(var i=0;i<game.players.length;i++){
            if(game.players[i]!=player&&game.players[i].hasZhuSkill('颂威',player)){
                list.push(game.players[i]);
            }
        }
        event.list=list;
        'step 1'
        if(event.list.length){
            var current=event.list.shift();
            event.current=current;
            player.chooseBool(get.prompt('颂威',current)).set('choice',ai.get.attitude(player,current)>0);
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.bool){
            player.logSkill('颂威',event.current);
            event.current.draw();
        }
        event.goto(1);
    },
            },
            "死战":{
                audio:["死战",2],
                enable:"phaseUse",
                usable:5,
                filterCard:true,
                selectCard:-1,
                filter:function (event,player){
        if(!player.num('h')) return false;
        if(player.storage.死战>=2) return false;
        return true;
    },
                viewAs:{
                    name:"juedou",
                    suit:"spade",
                    number:1,
                },
                group:["sizhan2","sizhan3","sizhan4"],
                ai:{
                    order:1,
                    result:{
                        target:function (player,target){
                if(player.num('h')>=3||target.num('h')>=3) return 0;
                if(player.num('h','tao')) return 0;
                if(target.num('h','sha')>1) return 0;
                return -1.5;
            },
                        player:function (player,target){
                if(ai.get.damageEffect(target,player,target)>0&&ai.get.attitude(player,target)>0&&ai.get.attitude(target,player)>0){
                    return 0;
                }
                var hs1=target.get('h','sha');
                var hs2=player.get('h','sha');
                if(hs1.length>hs2.length+1){
                    return -2;
                }
                var hsx=target.get('h');
                if(hsx.length>2&&hs2.length==0&&hsx[0].number<6){
                    return -2;
                }
                if(hsx.length>3&&hs2.length==0){
                    return -2;
                }
                if(hs1.length>hs2.length&&(!hs2.length||hs1[0].number>hs2[0].number)){
                    return -2;
                }
                return -0.5;
            },
                    },
                    basic:{
                        order:5,
                        useful:1,
                        value:4.5,
                    },
                    tag:{
                        respond:2,
                        respondSha:2,
                        damage:1,
                    },
                },
            },
            "sizhan2":{
                trigger:{
                    player:"phaseBefore",
                },
                forced:true,
                popup:false,
                silent:true,
                content:function (){
        player.storage.死战=0;
    },
            },
            "sizhan3":{
                trigger:{
                    player:"damageAfter",
                    source:"damageAfter",
                },
                forced:true,
                popup:false,
                filter:function (event,player){
        return event.parent.skill=='死战';
    },
                content:function (){
        player.storage.sizhan2=trigger.player;
    },
            },
            "sizhan4":{
                trigger:{
                    player:"juedouAfter",
                },
                forced:true,
                popup:false,
                filter:function (event,player){
        return event.skill=='死战';
    },
                content:function (){
        if(player.storage.sizhan2==player){
            player.draw(2);
            player.storage.sizhan+=2;
        }
        else if(player.storage.sizhan2){
            if(player.storage.sizhan2.isAlive()){
                game.asyncDraw([player,player.storage.sizhan2]);
            }
            else{
                player.draw();
            }
            player.storage.sizhan++;
        }
        else{
            player.draw();
            player.storage.sizhan++;
        }
        delete player.storage.sizhan2;
    },
            },
            "北地王":{
                unique:true,
                group:["beidi1","beidi2"],
                zhuSkill:true,
            },
            "beidi1":{
                audio:["北地王",2],
                trigger:{
                    player:"chooseToRespondBegin",
                },
                filter:function (event,player){
        if(event.responded) return false;
        if(!player.hasZhuSkill('北地王')) return false;
        if(!player.num('he')) return false;
        if(event.filterCard({name:'sha'},player,event)==false) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i]!=player&&game.players[i].group=='shu') return true;
        }
        return false;
    },
                direct:true,
                content:function (){
        "step 0"
        var yep=false;
        if(!player.storage.jijianging){
            for(var i=0;i<game.players.length;i++){
                var nh=game.players[i].num('h');
                if(game.players[i].group=='shu'&&ai.get.attitude(game.players[i],player)>1&&(nh>=4||(nh>=3&&game.players[i].num('h','sha')))){
                    yep=true;break;
                }
            }
        }
        var next=player.chooseToDiscard(get.prompt('北地王'),'he');
        next.set('ai',function(card){
            if(_status.event.yep) return 5-ai.get.value(card);
            return 0;
        });
        next.set('yep',yep);
        next.logSkill='北地王'
        "step 1"
        if(!result.bool){
            event.finish();
        }
        "step 2"
        if(event.current==undefined) event.current=player.next;
        if(event.current==player){
            event.finish();
        }
        else if(event.current.group=='shu'){
            player.storage.jijianging=true;
            var next=event.current.chooseToRespond('是否替'+get.translation(player)+'打出一张杀？',{name:'sha'});
            next.set('ai',function(){
                var event=_status.event;
                return (ai.get.attitude(event.player,event.source)-2);
            });
            next.set('source',player);
            next.autochoose=lib.filter.autoRespondSha;
        }
        else{
            event.current=event.current.next;
            event.redo();
        }
        "step 3"
        player.storage.jijianging=false;
        if(result.bool){
            event.finish();
            trigger.result=result;
            trigger.responded=true;
            trigger.animate=false;
            event.current.draw();
            if(typeof event.current.ai.shown=='number'&&event.current.ai.shown<0.95){
                event.current.ai.shown+=0.3;
                if(event.current.ai.shown>0.95) event.current.ai.shown=0.95;
            }
        }
        else{
            event.current=event.current.next;
            event.goto(2);
        }
    },
            },
            "beidi2":{
                audio:["北地王",2],
                enable:"chooseToUse",
                filter:function (event,player){
        if(event.filterCard&&!event.filterCard({name:'sha'},player,event)) return false;
        if(!player.hasZhuSkill('北地王')) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].group=='shu'&&game.players[i]!=player){
                return lib.filter.cardUsable({name:'sha'},player);
            }
        }
        return false;
    },
                filterCard:true,
                position:"he",
                check:function (card){
        var player=_status.event.player;
        for(var i=0;i<game.players.length;i++){
            var nh=game.players[i].num('h');
            if(game.players[i].group=='shu'&&ai.get.attitude(game.players[i],player)>1&&(nh>=4||(nh>=3&&game.players[i].num('h','sha')))){
                return 5-ai.get.value(card);
            }
        }
        return 0;
    },
                filterTarget:function (card,player,target){
        if(_status.event._backup&&
            typeof _status.event._backup.filterTarget=='function'&&
            !_status.event._backup.filterTarget({name:'sha'},player,target)){
            return false;
        }
        return player.canUse({name:'sha'},target);
    },
                content:function (){
        "step 0"
        if(event.current==undefined) event.current=player.next;
        if(event.current==player){
            player.addSkill('jijiang3');
            event.getParent(2).step=0;
            event.finish();
        }
        else if(event.current.group=='shu'){
            var next=event.current.chooseToRespond('是否替'+get.translation(player)+'对'+get.translation(target)+'使用一张杀',
            function(card){
                var evt=_status.event.getParent();
                return evt.player.canUse(card,evt.target)&&card.name=='sha';
            });
            next.set('ai',function(card){
                var event=_status.event;
                return ai.get.effect(event.target,card,event.source,event.player);
            });
            next.set('source',player);
            next.set('target',target);
            next.autochoose=lib.filter.autoRespondSha;
        }
        else{
            event.current=event.current.next;
            event.redo();
        }
        "step 1"
        if(result.bool){
            event.finish();
            event.current.draw();
            if(result.cards&&result.cards.length==1&&result.cards[0].name=='sha'){
                player.useCard(result.cards[0],target).animate=false;
            }
            else{
                player.useCard({name:'sha'},target).animate=false;
            }
            if(typeof event.current.ai.shown=='number'&&event.current.ai.shown<0.95){
                event.current.ai.shown+=0.3;
                if(event.current.ai.shown>0.95) event.current.ai.shown=0.95;
            }
        }
        else{
            event.current=event.current.next;
            event.goto(0);
        }
    },
                ai:{
                    result:{
                        target:function (player,target){
                if(player.hasSkill('jijiang3')) return 0;
                return ai.get.effect(target,{name:'sha'},player,target);
            },
                    },
                    order:function (){
            return lib.card.sha.ai.order-0.1;
        },
                },
            },
            "血舞":{
                audio:["血舞",2],
                enable:"phaseUse",
                usable:2,
                filter:function (event,player){
        return player.hp<player.maxHp&&player.num('he',{color:'red'})>0;
    },
                filterTarget:function (card,player,target){
        return player!=target&&get.distance(player,target,'attack')<=1;
    },
                position:"he",
                filterCard:function (card){
      return get.color(card)=='red';
    },
                content:function (){
        "step 0"
        target.damage(2,'fire')._triggered=null;
        "step 1"
        target.chooseToDiscard(2,'he',true);
    },
            },
            "龙啸":{
                audio:["龙啸",2],
                trigger:{
                    player:"shaMiss",
                },
                forced:true,
                content:function (){
        "step 0"
        player.draw();
        "step 1"
        player.addTempSkill('wushuang','phaseAfter');
        player.addTempSkill('wusheng','phaseAfter');
        player.addTempSkill('paoxiao','phaseAfter');
    },
            },
            "继武":{
                skillAnimation:true,
                audio:["继武",2],
                trigger:{
                    player:"phaseEnd",
                },
                forced:true,
                filter:function (event,player){
        return player.getStat('damage')>=3;
    },
                content:function (){
        "step 0"
        player.removeSkill('龙啸');
        player.gainMaxHp();
        player.draw(3);
        "step 1"
        player.recover();
        player.addTempSkill('wusheng');
    },
            },
            "惊鸿":{
                audio:["惊鸿",2],
                trigger:{
                    player:["phaseBegin","phaseEnd"],
                },
                frequent:true,
                content:function (){
        "step 0"
        if(event.cards==undefined) event.cards=[];
        player.judge(function(card){
            if(get.color(card)=='red') return 1.5;
            return -1.5;
        },ui.special);
        "step 1"
        if(result.judge>0){
            event.cards.push(result.card);
            if(lib.config.autoskilllist.contains('惊鸿')){
                player.chooseBool('是否再次发动？');
            }
            else{
                event._result={bool:true};
            }
        }
        else{
            for(var i=0;i<event.cards.length;i++){
                if(get.position(event.cards[i])!='s'){
                    event.cards.splice(i,1);i--;
                }
            }
            player.gain(event.cards);
            if(event.cards.length){
                player.$draw(event.cards);
            }
            event.finish();
        }
        "step 2"
        if(result.bool){
            event.goto(0);
        }
        else{
            player.gain(event.cards);
            if(event.cards.length){
                player.$draw(event.cards);
            }
        }
    },
            },
            "qing2":{
                mod:{
                    globalFrom:function (from,to,distance){
            for(var i=0;i<game.players.length;i++){
                if(game.players[i].sex=='male'){
                    distance--;
                }
            }
            return distance;
        },
                },
            },
            "qing1":{
                audio:["倾国",2],
                global:["qing2","qing4"],
            },
            "qing4":{
                mod:{
                    targetInRange:function (card,player,target,now){
            if(card.name=='sha'&&get.color(card)=='black') return true;
        },
                },
                trigger:{
                    player:"shaBegin",
                },
                audio:["倾国",2],
                forced:true,
                filter:function (event,player){
                return event.card&&get.color(event.card)=='black';
            },
                content:function (){
                trigger.directHit=true;
            },
            },
            "狼顾":{
                audio:["狼顾",2],
                trigger:{
                    player:"damageEnd",
                },
                direct:true,
                filter:function (event,player){
        return (event.source&&event.source.num('hej'));
    },
                content:function (){
        "step 0"
        player.recover()._triggered=null;
        player.choosePlayerCard(get.prompt('狼顾',trigger.source),trigger.source,ai.get.buttonValue,'he');
        "step 1"
        if(result.bool){
            player.logSkill('狼顾',trigger.source);
            player.gain(result.links[0]);
            trigger.source.$give(1,player);
            player.draw(1);
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(player.num('he')>1&&get.tag(card,'damage')){
                    if(ai.get.attitude(target,player)<0) return [1,1];
                }
            },
                    },
                },
                mod:{
                    maxHandcard:function (player,num){
            return 4+num;
        },
                },
            },
            "改命":{
                audio:["改命",2],
                trigger:{
                    global:"judge",
                },
                direct:true,
                filter:function (event,player){
        return player.num('he')>0;
    },
                content:function (){
        "step 0"
        player.chooseCard(get.translation(trigger.player)+'的'+(trigger.judgestr||'')+'判定为'+
        get.translation(trigger.player.judging[0])+'，'+get.prompt('reguicai'),'he').set('ai',function(card){
            var trigger=_status.event.getTrigger();
            var player=_status.event.player;
            var judging=_status.event.judging;
            var result=trigger.judge(card)-trigger.judge(judging);
            var attitude=ai.get.attitude(player,trigger.player);
            if(attitude==0||result==0) return 0;
            if(attitude>0){
                return result-ai.get.value(card)/2;
            }
            else{
                return -result-ai.get.value(card)/2;
            }
        }).set('judging',trigger.player.judging[0]);
        "step 1"
        if(result.bool){
            player.respond(result.cards,'highlight');
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            player.logSkill('改命');
            if(trigger.player.judging[0].clone){
                trigger.player.judging[0].clone.classList.remove('thrownhighlight');
                game.broadcast(function(card){
                    if(card.clone){
                        card.clone.classList.remove('thrownhighlight');
                    }
                },trigger.player.judging[0]);
                game.addVideo('deletenode',player,get.cardsInfo([trigger.player.judging[0].clone]));
            }
            ui.discardPile.appendChild(trigger.player.judging[0]);
            trigger.player.judging[0]=result.cards[0];
            if(!get.owner(result.cards[0],'judge')){
                trigger.position.appendChild(result.cards[0]);
            }
            game.log(trigger.player,'的判定牌改为',result.cards[0]);
            game.delay(2);
        }
          "step 3"
          player.draw(1);
          player.recover();
},
                ai:{
                    tag:{
                        rejudge:1,
                    },
                },
            },
            "变阵":{
                audio:["变阵",2],
                group:["bianzhen1","bianzhen2","bianzhen3","bianzhen4"],
                ai:{
                    threaten:3,
                },
            },
            "bianzhen1":{
                audio:["变阵",2],
                trigger:{
                    player:"phaseJudgeBefore",
                },
                filter:function (event,player){
        return player.num('h')>0;
    },
                direct:true,
                frequent:true,
                content:function (){
        "step 0"
        if(player.num('j')==0&&(!event.isMine()||!lib.config.autoskilllist.contains('bianzhen1'))){
            event.finish();
        }
        else{
            var next=player.chooseToDiscard('是否发动变阵跳过判定阶段？');
            next.set('ai',ai.get.unuseful2);
            next.set('logSkill','变阵');
        }
        "step 1"
        if(result.bool){
            trigger.untrigger();
            trigger.finish(); 
            player.recover();
        }
    },
            },
            "bianzhen2":{
                audio:["变阵",2],
                trigger:{
                    player:"phaseDrawBefore",
                },
                filter:function (event,player){
        return player.num('h')>0;
    },
                direct:true,
                content:function (){
        "step 0"
        var check,i,num=0,num2=0;
        for(i=0;i<game.players.length;i++){
            if(player!=game.players[i]&&game.players[i].num('h')){
                var att=ai.get.attitude(player,game.players[i]);
                if(att<=0){
                    num++;
                }
                if(att<0){
                    num2++;
                }
            }
        }
        check=(num>=2&&num2>0);

        player.chooseCardTarget({
            ai1:function(card){
                var evt=_status.event;
                if(!evt.check) return 0;
                return 6-ai.get.useful(card);
            },
            ai2:function(target){
                var evt=_status.event;
                if(!evt.check) return 0;
                return 1-ai.get.attitude(evt.player,target);
            },
            filterTarget:function(card,player,target){
                return target.num('h')>0;
            },
            selectTarget:[0,2],
            filterCard:true,
            prompt:'是否发动变阵跳过摸牌阶段？',
            check:check,
            target:target
        });
        "step 1"
        if(result.bool){
            player.logSkill('变阵',result.targets);
            player.discard(result.cards);
            event.targets=result.targets;
            player.recover();
        }
        else{
            event.finish();
        }
        "step 2"
        game.delay();
        "step 3"
        for(var i=0;i<event.targets.length;i++){
            player.gain(event.targets[i].get('h').randomGet());
            event.targets[i].$give(1,player);
        }
        trigger.finish();
        trigger.untrigger();
        game.delay();
        "step 4"
        if(result.bool) game.delay();
    },
                ai:{
                    expose:0.2,
                },
            },
            "bianzhen3":{
                audio:["变阵",2],
                trigger:{
                    player:"phaseUseBefore",
                },
                filter:function (event,player){
        return player.num('h')>0;
    },
                direct:true,
                content:function (){
        "step 0"
        var check;
        for(var i=0;i<game.players.length;i++){
            if(ai.get.attitude(player,game.players[i])>0&&game.players[i].num('j')){
                check=true;break;
            }
        }
        if(!check){
            if(player.num('h')>player.hp+1){
                check=false;
            }
            else if(player.num('h',{name:['wuzhong']})){
                check=false;
            }
            else{
                check=true;
            }
        }
        player.chooseCardTarget({
            ai1:function(card){
                if(!_status.event.check) return 0;
                return 7-ai.get.useful(card);
            },
            ai2:function(target){
                if(!_status.event.check) return 0;
                var player=_status.event.player;
                if(ui.selected.targets.length==0){
                    if(target.num('j')&&ai.get.attitude(player,target)>0) return 10;
                    if(ai.get.attitude(player,target)<0){
                        for(var i=0;i<game.players.length;i++){
                            if(ai.get.attitude(player,game.players[i])>0){
                                if((target.get('e','1')&&!game.players[i].get('e','1'))||
                                (target.get('e','2')&&!game.players[i].get('e','2'))||
                                (target.get('e','3')&&!game.players[i].get('e','3'))||
                                (target.get('e','4')&&!game.players[i].get('e','4'))||
                                (target.get('e','5')&&!game.players[i].get('e','5'))) return -ai.get.attitude(player,target);
                            }
                        }
                    }
                    return 0;
                }
                return -ai.get.attitude(player,target)*ai.get.attitude(player,ui.selected.targets[0]);
            },
            multitarget:true,
            filterTarget:function(card,player,target){
                if(ui.selected.targets.length){
                    var from=ui.selected.targets[0];
                    var judges=from.get('j');
                    for(var i=0;i<judges.length;i++){
                        if(!target.hasJudge(judges[i].viewAs||judges[i].name)) return true;
                    }
                    if(target.isMin()) return false;
                    if((from.get('e','1')&&!target.get('e','1'))||
                        (from.get('e','2')&&!target.get('e','2'))||
                        (from.get('e','3')&&!target.get('e','3'))||
                        (from.get('e','4')&&!target.get('e','4'))||
                        (from.get('e','5')&&!target.get('e','5'))) return true;
                    return false;
                }
                else{
                    return target.num('ej')>0;
                }
            },
            selectTarget:2,
            filterCard:true,
            prompt:'是否发动变阵跳过出牌阶段？',
            targetprompt:['被移走','移动目标'],
            check:check,
            target:target
        });
        "step 1"
        if(!result.bool){
            event.finish();
            return;
        }
        trigger.untrigger();
        trigger.finish();
        player.discard(result.cards);
        player.logSkill('变阵',result.targets,false);
        player.line2(result.targets);
        player.draw();
        event.targets=result.targets;
        "step 2"
        game.delay();
        "step 3"
        if(targets.length==2){
            player.choosePlayerCard('ej',function(button){
                var player=_status.event.player;
                var targets0=_status.event.targets0;
                var targets1=_status.event.targets1;
                if(ai.get.attitude(player,targets0)>ai.get.attitude(player,targets1)){
                    return get.position(button.link)=='j'?10:0;
                }
                else{
                    if(get.position(button.link)=='j') return -10;
                    return ai.get.equipValue(button.link);
                }
            },targets[0]).set('targets0',targets[0]).set('targets1',targets[1]).set('filterButton',function(button){
                var targets1=_status.event.targets1;
                if(get.position(button.link)=='j'){
                    return !targets1.hasJudge(button.link.viewAs||button.link.name);
                }
                else{
                    return !targets1.num('e',{subtype:get.subtype(button.link)});
                }
            });
        }
        else{
            event.finish();
        }
        "step 4"
        if(result.bool){
            var link=result.links[0];
            if(get.position(link)=='e'){
                event.targets[1].equip(link);
            }
            else if(link.viewAs){
                event.targets[1].addJudge({name:link.viewAs},[link]);
            }
            else{
                event.targets[1].addJudge(link);
            }
            event.targets[0].$give(link,event.targets[1])
            game.delay();
        }
    },
                ai:{
                    expose:0.2,
                },
            },
            "bianzhen4":{
                audio:["变阵",2],
                trigger:{
                    player:"phaseDiscardBefore",
                },
                direct:true,
                filter:function (event,player){
        return player.num('h')>0;
    },
                content:function (){
        "step 0"
        var discard=player.num('h')>player.hp;
        var next=player.chooseToDiscard('是否发动变阵跳过弃牌阶段？');
        next.logSkill='变阵';
        next.ai=function(card){
            if(discard){
                return 100-ai.get.useful(card);
            }
            else{
                return -1;
            }
        };
        "step 1"
        if(result.bool){
            trigger.untrigger();
            trigger.finish();
            player.gainMaxHp();
        }
    },
            },
            songwen:{
                audio:["颂文",2],
                enable:"phaseUse",
                usable:5,
                filter:function (){
        for(var i=0;i<game.players.length;i++){
            if(!game.players[i].storage.songwen) return true;
        }
        return false;
    },
                init:function (player){
        player.storage.songwen=false;
    },
                filterTarget:function (card,player,target){
        return (!target.storage.songwen&&target.num('h')!=target.hp);
    },
                content:function (){
        if(target.num('h')>target.hp){
            target.chooseToDiscard(2,'he',true);
        }
        else{
            target.draw(2);
        }
    },
                ai:{
                    order:7,
                    threaten:1.5,
                    expose:0.2,
                    result:{
                        target:function (player,target){
                if(target.num('h')<target.hp){
                    if(target.num('h')<=2) return 1;
                }
                else if(target.num('h')>target.hp){
                    if(target.num('h')<=3) return -1;
                }
            },
                    },
                },
            },
            "口诛":{
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                audio:["口诛",2],
                filter:function (event,player){
        return player.num('h')>0;
    },
                content:function (){
        "step 0"
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].storage.口诛){
                game.players[i].addSkill('kouzhu2');
            }
        }
        player.chooseCardTarget({
            filterCard:true,
            filterTarget:function(card,player,target){
                return player!=target&&!target.storage.口诛;
            },
            ai1:function(card){
                return 7-ai.get.value(card);
            },
            ai2:function(target){
                var num=target.hasSkillTag('maixie')?2:0;
                return -ai.get.attitude(_status.event.player,target)-num;
            },
            prompt:get.prompt('口诛')
        });
        "step 1"
        if(result.bool){
            player.logSkill('口诛',result.targets[0]);
            result.targets[0].addSkill('kouzhu2');
            result.targets[0].storage.口诛=[result.cards[0],player];
            player.lose(result.cards[0],result.targets[0].node.special);
            player.$give(1,result.targets[0]);
        }
    },
                ai:{
                    threaten:1.7,
                    expose:0.3,
                },
            },
            "kouzhu2":{
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                mark:true,
                content:function (){ 
        "step 0"
        if(player.storage.口诛[1].isAlive()&&player.num('he'))
        { player.chooseCard(get.translation(player.storage.口诛[1])+ '的笔伐为'+get.translation(player.storage.口诛[0]),
       function(card){ return get.type(card,'trick')==_status.event.type; }).set('ai',function(card){ return 8-ai.get.value(card); }).set('type',get.type(player.storage.口诛[0],'trick')); 
        } 
        else{ 
            event.directfalse=true;
        } 
        "step 1" 
        if(result.bool&&!event.directfalse){ 
            player.storage.口诛[1].gain(result.cards); player.$give(result.cards,player.storage.口诛[1]); player.gain(player.storage.口诛[0],'draw2'); 
        } 
        else{ 
      ui.discardPile.appendChild(player.storage.口诛[0]);
      game.log(player.storage.口诛[0],'进入弃牌堆');             
      player.$throw(player.storage.口诛[0],1000); player.loseHp();player.loseMaxHp();player.draw(2);
        }
        player.removeSkill('kouzhu2'); 
        delete player.storage.口诛; 
    },
                intro:{
                    name:"笔伐",
                    content:"已成为笔伐目标",
                },
            },
            "突进":{
                audio:["突进",2],
                trigger:{
                    global:"phaseEnd",
                },
                check:function (event,player){
        return ai.get.damageEffect(event.player,player,player)>0;
    },
                filter:function (event,player){
        return event.player.isAlive()&&event.player!=player&&player.num('h',{type:'basic'});
    },
                direct:true,
                content:function (){
        "step 0"
        var nono=(Math.abs(ai.get.attitude(player,trigger.player))<3);
        if(ai.get.damageEffect(trigger.player,player,player)<=0){
            nono=true;
        }
        var next=player.chooseToDiscard(get.prompt('突进',trigger.player));
        next.set('ai',function(card){
            if(_status.event.nono) return 0;
            return 8-ai.get.useful(card);
        });
        next.set('logSkill',['突进',trigger.player]);
        next.set('nono',nono);
        "step 1"
        if(result.bool){
            var nono=(ai.get.damageEffect(trigger.player,player,trigger.player)>=0);
            trigger.player.chooseToDiscard('he',{type:'equip'}).set('ai',function(card){
                if(_status.event.nono){
                    return 0;
                }
                if(_status.event.player.hp==1) return 10-ai.get.value(card);
                return 9-ai.get.value(card);
            }).set('nono',nono);
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            player.draw(2);
            player.recover();
        }
        else{
            trigger.player.damage();
            trigger.player.loseHp();
        }
    },
                ai:{
                    expose:0.3,
                    threaten:1.3,
                },
            },
            "赤魂":{
                audio:["赤魂",2],
                enable:["chooseToRespond","chooseToUse"],
                filterCard:function (card){
        return get.color(card)=='red';
    },
                position:"he",
                viewAs:{
                    name:"sha",
                    suit:"heart",
                    number:2,
                },
                viewAsFilter:function (player){
        if(!player.num('he',{color:'red'})) return false;
    },
                prompt:"将一张红色牌当杀使用或打出",
                check:function (card){return 4-ai.get.value(card)},
                ai:{
                    skillTagFilter:function (player){
            if(!player.num('he',{color:'red'})) return false;
        },
                    respondSha:true,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    order:3,
                    result:{
                        target:function (player,target){
                if(player.hasSkill('jiu')&&!target.num('e','baiyin')){
                    if(ai.get.attitude(player,target)>0){
                        return -6;
                    }
                    else{
                        return -3.05+(sgs.getDefenseSha(target,player))/30;
                    }
                }
                return -1.55+(sgs.getDefenseSha(target,player))/30;
            },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                if(card.nature=='poison') return;
                return 1;
            },
                        natureDamage:function (card){
                if(card.nature) return 1;
            },
                        fireDamage:function (card,nature){
                if(card.nature=='fire') return 1;
            },
                        thunderDamage:function (card,nature){
                if(card.nature=='thunder') return 1;
            },
                        poisonDamage:function (card,nature){
                if(card.nature=='poison') return 1;
            },
                    },
                },
                group:["chi2","chi3"],
            },
            "chi2":{
                audio:["赤魂",2],
                trigger:{
                    player:"phaseAfter",
                },
                forced:true,
                filter:function (event,player){
       return Math.random()<=1;
},
                content:function (){
      player.draw(2);
},
            },
            "chi3":{
                trigger:{
                    player:"useCard",
                },
                forced:true,
                priority:10,
                filter:function (event){
        return event.card.name=='sha';
    },
                content:function (){
        player.addTempSkill('unequip','useCardAfter');
    },
            },
            "淑德":{
                audio:["淑德",2],
                trigger:{
                    global:"discardAfter",
                },
                filter:function (event,player){
        if(event.player==player||_status.currentPhase==player) return false;
        for(var i=0;i<event.cards.length;i++){
            if(get.type(event.cards[i])=='basic'){
                return true;
            }
        }
        return false;
    },
                frequent:true,
                content:function (){
        "step 0"
        if(trigger.delay==false) game.delay();
        "step 1"
        player.draw();
    },
                ai:{
                    threaten:1.5,
                },
            },
            "枪魂":{
                audio:["枪魂",2],
                enable:"phaseUse",
                usable:1,
                content:function (){
         "step 0"
        player.judge(function(card){
            if(get.color(card)=='red') return 2;
            return 1;
        })
        "step 1"
        if(result.judge==1){
           var list=["sha"];
           player.gain(game.createCard(list.randomGet()));
           player.$draw();
           player.gain(game.createCard(list.randomGet()));
           player.$draw();
           player.gain(game.createCard(list.randomGet()));
           player.$draw();
           player.addTempSkill('paoxiao','phaseAfter');
        }
        else{
            if(result.judge==2){
                player.recover(10);
                player.draw(3);
            }
        }
    },
                ai:{
                    result:{
                        player:1,
                    },
                    order:11,
                },
            },
            "谣言":{
                audio:["谣言",2],
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        for(var i=0;i>game.players.length;i++){
            if(game.players[i].hp>target.hp) return false;
        }
        return true;
    },
                check:function (card){return 7-ai.get.value(card);},
                position:"he",
                filterCard:true,
                content:function (){
        target.damage(2);
    },
                ai:{
                    result:{
                        target:function (player,target){
                if(target.num('j')&&ai.get.attitude(player,target)>0){
                    return 1;
                }
                if(target.num('e')){
                    return -1;
                }
                return ai.get.damageEffect(target,player);
            },
                    },
                    order:7,
                },
            },
            "控蛮":{
                audio:["控蛮",2],
                trigger:{
                    source:"damageBefore",
                },
                check:function (event,player){
        if(ai.get.damageEffect(event.player,player,player)<0) return true;
        var att=ai.get.attitude(player,event.player);
        if(att>0&&event.player.num('j')) return true;
        if(event.num>1){
            if(att<0) return false;
            if(att>0) return true;
        }
        var cards=event.player.get('e');
        for(var i=0;i<cards.length;i++){
            if(ai.get.equipValue(cards[i])>=6) return true;
        }
        return false;
    },
                content:function (){
        if(trigger.player.num('hej')){
            player.gainPlayerCard(2,trigger.player,'hej',true);
        }
        trigger.untrigger();
        trigger.finish();
    },
            },
            "象阵":{
                unique:true,
                locked:true,
                group:["xiangzhen1","xiangzhen2","xiangzhen3"],
                ai:{
                    effect:{
                        target:function (card){
                if(card.name=='nanman') return [0,1];
            },
                    },
                },
            },
            "xiangzhen1":{
                audio:["象阵",2],
                trigger:{
                    target:"useCardToBefore",
                },
                forced:true,
                priority:15,
                filter:function (event,player){
        return (event.card.name=='nanman');
    },
                content:function (){
        trigger.untrigger();
        trigger.finish();
    },
            },
            "xiangzhen2":{
                trigger:{
                    global:"useCardAfter",
                },
                forced:true,
                filter:function (event,player){
        return (event.card.name=='nanman'&&event.player!=player&&get.position(event.card)=='d'&&get.itemtype(event.card)=='card');
    },
                content:function (){
        player.gain(trigger.card);
        player.$gain2(trigger.card);
   player.recover();
    },
            },
            "xiangzhen3":{
                trigger:{
                    source:"damageBegin",
                },
                filter:function (event){
        return event.card&&event.card.name=='nanman';
    },
                forced:true,
                content:function (){
        trigger.num+=2;
    },
            },
            "巨刃":{
                audio:["巨刃",2],
                trigger:{
                    source:"damageEnd",
                },
                filter:function (event,player){
        return (event.card&&event.card.name=='sha'&&
            event.player.classList.contains('dead')==false&&
            event.player.num('h')&&player.num('h'));
    },
                check:function (event,player){
        return ai.get.attitude(player,event.player)<0&&player.num('h')>1;
    },
                priority:5,
                content:function (){
        "step 1"
        player.chooseToCompare(trigger.player);
        trigger.player.damage('fire',2);
        "step 2"
        if(result.bool&&trigger.player.num('he')){
           player.gainPlayerCard(2,trigger.player,true,'he');
        }
    },
            },
            "抛戟":{
                audio:["抛戟",2],
                group:["pao1"],
                enable:"phaseUse",
                usable:1,
                filterCard:function (card){
        return get.subtype(card)==('equip1','equip2','equip3','equip4','equip5');
    },
                selectCard:[0,1],
                filterTarget:function (card,player,target){
        if(player==target) return false;
        return get.distance(player,target,'attack')<=1;
    },
                content:function (){
        "step 0"
        if(cards.length==0){
            player.loseHp();
            player.gainMaxHp();
            player.draw();
        }
        "step 1"
        target.loseHp(2);
        target.loseMaxHp();
    },
                check:function (card){
        return 10-ai.get.value(card);
    },
                position:"he",
                ai:{
                    order:8,
                    result:{
                        player:function (player,target){
                if(player.get('e','1')) return 0;
                if(player.hp>=target.hp) return -0.9;
                if(player.hp<=2) return -10;
                return -2;
            },
                        target:function (player,target){
                if(!player.get('e','1')){
                    if(player.hp<2) return 0;
                    if(player.hp==2&&target.hp>=2) return 0;
                }
                return ai.get.damageEffect(target,player);
            },
                    },
                },
                threaten:1.3,
            },
            "pao1":{
                audio:["抛戟",2],
                trigger:{
                    player:"loseEnd",
                },
                frequent:true,
                filter:function (event,player){
        for(var i=0;i<event.cards.length;i++){
            if(event.cards[i].original=='e') return true;
        }
        return false;
    },
                content:function (){
        var num=0;
        for(var i=0;i<trigger.cards.length;i++){
            if(trigger.cards[i].original=='e') num+=2;
        }
        player.recover(num);
    },
                ai:{
                    noe:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.type(card)=='equip') return [1,3];
            },
                    },
                },
            },
            "王佐":{
                audio:["王佐",2],
                trigger:{
                    player:"damageEnd",
                },
                direct:true,
                filter:function (event,player){
        return event.num>0
    },
                content:function (){
        "step 0"
        player.chooseTarget(2,get.prompt('王佐'),[trigger.num],function(card,player,target){
            return target.num('h')<Math.min(target.maxHp);
        }).set('ai',function(target){
            var att=ai.get.attitude(_status.event.player,target);
            if(att>3){
                return Math.min(target.maxHp)-target.num('h');
            }
            return att/3;
        });
        "step 1"
        if(result.bool){
            player.logSkill('王佐',result.targets);
            for(var i=0;i<result.targets.length;i++){
                result.targets[i].draw(Math.min(result.targets[i].maxHp)-result.targets[i].num('h'));
            }
        }
    },
                ai:{
                    maixie:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'damage')&&target.hp>1){
                    if(player.hasSkill('jueqing')) return [1,-2];
                    var max=0;
                    for(var i=0;i<game.players.length;i++){
                        if(ai.get.attitude(target,game.players[i])>0){
                            max=Math.max(Math.min(5,game.players[i].hp)-game.players[i].num('h'),max);
                        }
                    }
                    switch(max){
                        case 0:return 2;
                        case 1:return 1.5;
                        case 2:return [1,2];
                        default:return [0,max];
                    }
                }
                if((card.name=='tao'||card.name=='caoyao')&&
                    target.hp>1&&target.num('h')<=target.hp) return [0,0];
            },
                    },
                },
            },
            "驱虎吞狼":{
                audio:["驱虎吞狼",2],
                enable:"phaseUse",
                usable:3,
                filter:function (event,player){
        if(player.num('h')==0) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].hp!=player.hp&&game.players[i].num('h')) return true;
        }
        return false;
    },
                filterTarget:function (card,player,target){
        return target.hp!=player.hp&&target.num('h')>0;
    },
                content:function (){
        "step 0"
        player.chooseToCompare(target);
        "step 1"
        if(result.bool){
            if(game.hasPlayer(function(player){
                return player!=target&&get.distance(target,player,'attack')<=1;
            })){
                player.chooseTarget(function(card,player,target){
                    var source=_status.event.source;
                    return target!=source&&get.distance(source,target,'attack')<=1;
                },true).set('ai',function(target){
                    return ai.get.damageEffect(target,_status.event.source,player);
                }).set('source',target);
            }
            else{
                event.finish();
            }
        }
        else{
            player.damage(target);
            event.finish();
        }
        "step 2"
        if(result.bool&&result.targets&&result.targets.length){
            target.line(result.targets[0],'green');
            result.targets[0].damage(target);
        }
    },
                ai:{
                    order:0.5,
                    result:{
                        target:function (player,target){
                var att=ai.get.attitude(player,target);
                var oc=(target.num('h')==1);
                if(att>0&&oc) return 0;
                for(var i=0;i<game.players.length;i++){
                    if(game.players[i]!=target&&game.players[i]!=player&&
                        get.distance(target,game.players[i],'attack')<=1){
                        if(ai.get.damageEffect(game.players[i],target,player)>0){
                            return att>0?att/2:att-(oc?5:0);
                        }
                    }
                }
                return 0;
            },
                        player:function (player,target){
                if(target.hasSkill('jueqing')) return -10;
                var mn=1;
                var hs=player.get('h');
                for(var i=0;i<hs.length;i++){
                    mn=Math.max(mn,hs[i].number);
                }
                if(mn<=11&&player.hp<2) return -20;
                var max=player.maxHp-hs.length;
                for(var i=0;i<game.players.length;i++){
                    if(ai.get.attitude(player,game.players[i])>2){
                        max=Math.max(Math.min(5,game.players[i].hp)-game.players[i].num('h'),max);
                    }
                }
                switch(max){
                    case 0:return mn==13?0:-20;
                    case 1:return mn>=12?0:-15;
                    case 2:return 0;
                    case 3:return 1;
                    default:return max;
                }
            },
                    },
                    expose:0.2,
                },
            },
            qibing:{
                audio:["奇兵",2],
                trigger:{
                    global:"useCardAfter",
                },
                forced:true,
                filter:function (event,player){
        return (event.card.name=='shunshou'&&event.player!=player&&get.position(event.card)=='d'&&get.itemtype(event.card)=='card');
    },
                content:function (){
        player.gain(trigger.card);
        player.$gain2(trigger.card);
        player.recover();
        player.draw();
    },
                group:["qibing2"],
            },
            "qibing2":{
                mod:{
                    globalFrom:function (from,to,distance){
            return distance-99;
        },
                },
            },
            "天险":{
                audio:["天险",2],
                trigger:{
                    target:"useCardToBegin",
                },
                filter:function (event,player){
        return event.card&&event.card.name=='juedou';
    },
                content:function (){
     trigger.player.loseHp();          
    },
                mod:{
                    globalTo:function (from,to,distance){
            return distance+5;
        },
                },
            },
            "积粮":{
                audio:["积粮",2],
                trigger:{
                    player:"loseEnd",
                },
                frequent:true,
                filter:function (event,player){
        return _status.currentPhase!=player;
    },
                content:function (){
        player.draw();
    },
            },
            "抬棺":{
                audio:["抬棺",2],
                enable:"phaseUse",
                filter:function (event,player){
        return player.num('he')>0;
    },
                filterTarget:function (card,player,target){
        return target!=player&&target.num('he')>0;
    },
                filterCard:function (card){
       return get.color(card)=='black';
    },
                content:function (){
        'step 0'
        target.chooseToDiscard(2,'he',true);
        player.draw();
        'step 1'       
         player.useCard({name:'juedou'},target);
          player.recover();
    },
                ai:{
                    order:2,
                    result:{
                        target:function (player,target){
                if(ai.get.effect(target,{name:'juedou'},player,player)<=0){
                    return 0;
                }
                if(target.hp<player.hp){
                    if(player.num('h')>player.hp) return -0.1;
                    return 0;
                }
                var hs1=target.get('h','sha');
                var hs2=player.get('h','sha');
                if(hs1.length>hs2.length){
                    return 0;
                }
                var hsx=target.get('h');
                if(hsx.length>2&&hs2.length<=1&&hsx[0].number<6){
                    return 0;
                }
                if(hsx.length>3&&hs2.length<=1){
                    return 0;
                }
                if(hs1.length>hs2.length-1&&hs1.length>0&&(hs2.length<=1||hs1[0].number>hs2[0].number)){
                    return 0;
                }
                return -1;
            },
                    },
                },
            },
            "鬼武":{
                audio:["鬼武",2],
                enable:["chooseToRespond","chooseToUse"],
                filterCard:function (card){
        return get.color(card)=='black';
    },
                position:"he",
                viewAs:{
                    name:"sha",
                    suit:"spade",
                    number:13,
                },
                viewAsFilter:function (player){
        if(!player.num('he',{color:'black'})) return false;
    },
                prompt:"将一张黑色牌当杀使用或打出",
                check:function (card){return 4-ai.get.value(card)},
                ai:{
                    skillTagFilter:function (player){
            if(!player.num('he',{color:'black'})) return false;
        },
                    respondSha:true,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    order:3,
                    result:{
                        target:function (player,target){
                if(player.hasSkill('jiu')&&!target.num('e','baiyin')){
                    if(ai.get.attitude(player,target)>0){
                        return -6;
                    }
                    else{
                        return -3.05+(sgs.getDefenseSha(target,player))/30;
                    }
                }
                return -1.55+(sgs.getDefenseSha(target,player))/30;
            },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                if(card.nature=='poison') return;
                return 1;
            },
                        natureDamage:function (card){
                if(card.nature) return 1;
            },
                        fireDamage:function (card,nature){
                if(card.nature=='fire') return 1;
            },
                        thunderDamage:function (card,nature){
                if(card.nature=='thunder') return 1;
            },
                        poisonDamage:function (card,nature){
                if(card.nature=='poison') return 1;
            },
                    },
                },
            },
            "护行":{
                audio:["护行",2],
                skillAnimation:true,
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                filter:function (event,player){
        return !player.storage.护行&&player.num('h')>player.hp;
    },
                content:function (){
        player.storage.护行=true;
        player.loseMaxHp();
        player.addSkill('mashu');
        player.addSkill('过关斩将');
    },
            },
            "过关斩将":{
                trigger:{
                    player:"useCard",
                },
                filter:function (event,player){
        return event.card&&event.card.name=='sha'&&event.cards&&
            event.cards.length==1&&get.type(event.cards[0],'trick')=='trick';
    },
                forced:true,
                content:function (){
        if(player.stat[player.stat.length-1].card.sha>0){
            player.stat[player.stat.length-1].card.sha--;
        }
        player.draw();
    },
                group:"guoguanzhanjiang2",
            },
            "guoguanzhanjiang2":{
                trigger:{
                    source:"damageBegin",
                },
                forced:true,
                filter:function (event,player){
        return event.card&&event.card.name=='sha'&&event.cards&&
            event.cards.length==1&&get.type(event.cards[0])=='equip';
    },
                content:function (){
        trigger.num+=2;
     player.recover(2)._triggered=null;
    },
            },
            "怂乱":{
                audio:["怂乱",2],
                unique:true,
                enable:"phaseUse",
                usable:1,
                animationColor:"thunder",
                skillAnimation:"epic",
                filter:function (event,player){
        return !player.storage.怂乱&&player.num('h',{color:'black'})>0;
    },
                init:function (player){
        player.storage.怂乱=false;
    },
                filterTarget:function (card,player,target){
        if(ui.selected.targets.length){
            return target.num('h')>0&&target.distanceTo(ui.selected.targets[0])<=1;
        }
        return true;
    },
                filterCard:{
                    color:"black",
                },
                mark:true,
                discard:false,
                delay:0,
                check:function (card){return 6-ai.get.value(card);},
                selectTarget:2,
                multitarget:true,
                content:function (){
        'step 0'
        player.$give(cards,targets[0]);
        player.unmark('怂乱');
        player.storage.怂乱=false;
        targets[0].gain(cards,player);
        'step 1'
        targets[0].chooseToCompare(targets[1]);
        'step 2'
        if(result.bool){
            targets[0].chooseToDiscard('he',999,true);
            targets[1].loseHp(2);
        }
        else{
            targets[1].chooseToDiscard('he',999,true);
            targets[0].loseHp(2);
        }
    },
                intro:{
                    content:"limited",
                },
                ai:{
                    expose:0.4,
                    order:4,
                    result:{
                        target:function (player,target){
                if(player.hasUnknown()) return 0;
                if(ui.selected.targets.length) return -1;
                return -0.5;
            },
                    },
                },
            },
            "千虑":{
                audio:["千虑",2],
                unique:true,
                trigger:{
                    player:"damageEnd",
                },
                animationColor:"fire",
                skillAnimation:"legend",
                filter:function (event,player){
        return !player.storage.千虑;
    },
                init:function (player){
        player.storage.千虑=false;
    },
                mark:true,
                direct:true,
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('千虑'),function(card,player,target){
            return target.sex=='male'&&target!=player;
        }).set('ai',function(target){
            if(!_status.event.goon) return 0;
            var player=_status.event.player;
            var att=ai.get.attitude(player,target);
            if(att<=1) return 0;
            var mode=get.mode();
            if(mode=='identity'||(mode=='versus'&&_status.mode=='four')){
                if(target.name&&lib.character[target.name]){
                    for(var i=0;i<lib.character[target.name][3].length;i++){
                        if(lib.skill[lib.character[target.name][3][i]].zhuSkill){
                            return att*2;
                        }
                    }
                }
            }
            return att;
        }).set('goon',!player.hasUnknown());
        'step 1'
        if(result.bool){
            player.unmarkSkill('千虑');
            player.storage.千虑=true;
            player.logSkill('千虑',result.targets);
            var target=result.targets[0];
            target.gainMaxHp(true);
            target.draw(4);
            var mode=get.mode();
            if(mode=='identity'||(mode=='versus'&&_status.mode=='four')){
                if(target.name&&lib.character[target.name]){
                    var skills=lib.character[target.name][3];
                    target.storage.zhuSkill_千虑=[];
                    for(var i=0;i<skills.length;i++){
                        var info=lib.skill[skills[i]];
                        if(info.zhuSkill){
                            target.storage.zhuSkill_千虑.push(skills[i]);
                            if(info.init){
                                info.init(target);
                            }
                            if(info.init2){
                                info.init2(target);
                            }
                        }
                    }
                }
            }
        }
    },
                ai:{
                    expose:0.2,
                },
            },
            "旧情":{
                audio:["旧情",2],
                trigger:{
                    global:"dying",
                },
                priority:6,
                filter:function (event,player){
        return event.player.hp<=0;
    },
                direct:true,
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('旧情'),function(card,player,target){
            return target!=player&&target!=_status.event.getTrigger().player;
        }).set('ai',function(target){
            var player=_status.event.player;
            var trigger=_status.event.getTrigger();
            if(ai.get.attitude(player,trigger.player)>0){
                var att1=ai.get.attitude(target,player);
                var att2=ai.get.attitude(target,trigger.player);
                var att3=ai.get.attitude(player,target);
                if(att3<0) return 0;
                return att1/2+att2+att3;
            }
            else{
                return 0;
                // return ai.get.attitude(player,target);
            }
        });
        'step 1'
        if(result.bool){
            event.target=result.targets[0];
            event.target.draw(8);
            player.logSkill('旧情',event.target);
        }
        else{
            event.finish();
        }
        'step 2'
        var target=event.target;
        var tosave=trigger.player;
        var att=ai.get.attitude(target,tosave);
        var hastao=target.num('h','tao');
        target.chooseToDiscard(4,true,'he').set('ai',function(card){
            var hastao=_status.event.hastao;
            var att=_status.event.att;
            if(!hastao&&att>0){
                var suit=get.suit(card);
                for(var i=0;i<ui.selected.cards.length;i++){
                    if(get.suit(ui.selected.cards[i])==suit){
                        return -4-ai.get.value(card);
                    }
                }
            }
            if(att<0&&ui.selected.cards.length==3){
                var suit=get.suit(card);
                for(var i=0;i<ui.selected.cards.length;i++){
                    if(get.suit(ui.selected.cards[i])==suit){
                        return -ai.get.value(card);
                    }
                }
                return -10-ai.get.value(card);
            }
            return -ai.get.value(card);
        }).set('hastao',hastao).set('att',att);
        'step 3'
        if(result.cards&&result.cards.length==4){
            var suits=[];
            for(var i=0;i<result.cards.length;i++){
                suits.add(get.suit(result.cards[i]));
            }
            if(suits.length==4){
                event.target.useCard({name:'tao'},trigger.player);
            }
        }
    },
            },
            "默书":{
                audio:["默书",2],
                intro:{
                    content:"cards",
                },
                init:function (player){
        player.storage.默书=[];
    },
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        return player.storage.默书.length>0&&player.num('h')>0;
    },
                content:function (){
        if(player.storage.默书.length&&player.num('h')){
            var card=player.storage.默书.shift();
            card={name:card.name,nature:card.nature,suit:card.suit,number:card.number};
            if(lib.filter.cardEnabled(card)){
                for(var i=0;i<game.players.length;i++){
                    if(player.canUse(card,game.players[i])){
                        break;
                    }
                }
                if(i<game.players.length){
                    lib.skill.默书.viewAs=card;
                    var next=player.chooseToUse();
                    if(next.isOnline()){
                        player.send(function(card){
                            lib.skill.默书.viewAs=card;
                        },card)
                    }
                    next.logSkill='默书';
                    next.set('openskilldialog','将一张手牌当'+get.translation(card)+'使用');
                    next.set('norestore',true);
                    next.set('_backupevent','默书');
                    next.backup('默书');
                }
            }
            event.redo();
        }
    },
                group:["moshu2","moshu3"],
            },
            "moshu2":{
                trigger:{
                    player:"phaseAfter",
                },
                forced:true,
                silent:true,
                popup:false,
                content:function (){
        player.storage.默书.length=0;
        player.unmarkSkill('默书');
    },
            },
            "moshu3":{
                audio:["默书",2],
                trigger:{
                    player:"useCard",
                },
                forced:true,
                silent:true,
                popup:false,
                filter:function (event,player){
        if(_status.currentPhase!=player) return false;
        if(event.parent.parent.name!='phaseUse') return false;
        var type=get.type(event.card);
        return player.storage.默书.length<4&&(type=='basic'||type=='trick');
    },
                content:function (){
        player.storage.默书.add(trigger.card);
        if(player.get('s').contains('默书')) player.markSkill('默书');
    },
            },
            "战勋":{
                audio:["战勋",2],
                trigger:{
                    global:"dieAfter",
                },
                forced:true,
                unique:true,
                content:function (){
        player.gainMaxHp(2);
        player.recover();
        player.draw(3);
    },
                ai:{
                    threaten:1.5,
                },
            },
            "举兵":{
                skillAnimation:true,
                audio:["举兵",1],
                trigger:{
                    player:"phaseBegin",
                },
                filter:function (event,player){
        return player.maxHp>game.players.length&&player.hp<player.maxHp&&!player.storage.举兵;
    },
                forced:true,
                unique:true,
                content:function (){
        var num=player.maxHp-player.num('h');
        if(num>0){
            player.draw(num);
        }
        player.addSkill('内乱');
        player.addSkill('危重');
        player.storage.举兵=true;
    },
            },
            "危重":{
                audio:["危重",1],
                trigger:{
                    player:["gainMaxHpEnd","loseMaxHpEnd","loseHpEnd","gainHpEnd","recoverEnd","damageEnd"],
                },
                forced:true,
                content:function (){
        player.draw();
    },
            },
            "内乱":{
                audio:["内乱",1],
                trigger:{
                    player:"phaseEnd",
                },
                content:function (){
        player.chooseToDiscard(2,true);
        player.recover();
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(card.name=='guiyoujie') return [0,1];
            },
                    },
                },
            },
            "伏兵":{
                trigger:{
                    global:["phaseDiscardEnd","phaseBegin"],
                },
                direct:true,
                audio:["伏兵",2],
                init:function (player){
        player.storage.伏兵=[];
        player.storage.fubing2=[];
    },
                filter:function (event,player){
        return player.num('h')>0;
    },
                intro:{
                    content:"cards",
                    mark:function (dialog,content,player){
            if(content&&content.length){
                dialog.add(content);
                if(player.isUnderControl(true)){
                    var str='';
                    for(var i=0;i<player.storage.fubing2.length;i++){
                        str+=get.translation(player.storage.fubing2[i]);
                        if(i<player.storage.fubing2.length-1){
                            str+='、';
                        }
                    }
                    dialog.add('<div class="text center">'+str+'</div>')
                }
            }
        },
                },
                content:function (){
        'step 0'
        player.draw(2);
        var list1=[],list2=[],list3=[];
        for(var i=0;i<lib.inpile.length;i++){
            var type=get.type(lib.inpile[i]);
            if(type=='basic'){
                list1.push(['基本','',lib.inpile[i]]);
            }
            else if(type=='trick'){
                list2.push(['锦囊','',lib.inpile[i]]);
            }
            else if(type=='delay'){
                list3.push(['锦囊','',lib.inpile[i]]);
            }
        }
        player.chooseButton([get.prompt('伏兵'),[list1.concat(list2).concat(list3),'vcard']]).set('filterButton',function(button){
            var player=_status.event.player;
            if(player.storage.fubing2&&player.storage.fubing2.contains(button.link[2])) return false;
            return true;
        }).set('ai',function(button){
            var rand=_status.event.rand*2;
            switch(button.link[2]){
                case 'sha':return 5+rand[1];
                case 'tao':return 4+rand[2];
                case 'lebu':return 3+rand[3];
                case 'shan':return 4.5+rand[4];
                case 'wuzhong':return 4+rand[5];
                case 'shunshou':return 3+rand[6];
                case 'nanman':return 2+rand[7];
                case 'wanjian':return 2+rand[8];
                default:return rand[9];
            }
        }).set('rand',[Math.random(),Math.random(),Math.random(),Math.random(),
        Math.random(),Math.random(),Math.random(),Math.random()],Math.random());
        'step 1'
        if(result.bool){
            player.storage.fubing2.push(result.links[0][2]);
            player.logSkill('伏兵');
            player.chooseCard('he','选择一张牌作为“陷阱”',true);
            if(player.isOnline2()){
                player.send(function(storage){
                    game.me.storage.fubing2=storage;
                },player.storage.fubing2);
            }
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.bool){
            var card=result.cards[0];
            player.lose(card,ui.special);
            player.storage.伏兵.push(card);
            player.syncStorage('伏兵');
            player.markSkill('伏兵');
            player.$give(card,player);
        }
    },
                group:["fubing2"],
            },
            "fubing2":{
                trigger:{
                    global:["useCard","respondEnd"],
                },
                priority:15,
                audio:["伏兵",2],
                filter:function (event,player){
        if(_status.currentPhase==player) return false;
        if(event.name=='respond'){
            if(event.getParent(2).name!='sha') return false;
        }
        return player.storage.fubing2&&player.storage.fubing2.contains(event.card.name);
    },
                direct:true,
                content:function (){
        "step 0"
        var effect=0;
        if(trigger.card.name=='wuxie'||trigger.name=='respond'){
            if(ai.get.attitude(player,trigger.player)<-1){
                effect=-1;
            }
        }
        else if(trigger.targets&&trigger.targets.length){
            for(var i=0;i<trigger.targets.length;i++){
                effect+=ai.get.effect(trigger.targets[i],trigger.card,trigger.player,player);
            }
        }
        var str='伏兵：是否令'+get.translation(trigger.player);
        if(trigger.targets&&trigger.targets.length){
            str+='对'+get.translation(trigger.targets);
        }
        str+='的'+get.translation(trigger.card)+'失效？'
        var next=player.chooseBool(str,function(){
            var player=_status.event.player;
            var trigger=_status.event.getTrigger();
            if(_status.event.effect<0){
                if(trigger.card.name=='sha'){
                    var target=trigger.targets[0];
                    if(target==player){
                        return !player.num('h','shan');
                    }
                    else{
                        return target.hp==1||(target.num('h')<=2&&target.hp<=2);
                    }
                }
                else{
                    return true;
                }
            }
            return false;
        });
        next.set('effect',effect);
        "step 1"
        if(result.bool){
            player.logSkill('伏兵');
            var index=player.storage.fubing2.indexOf(trigger.card.name);
            if(index!=-1){
                var card=player.storage.伏兵[index];
                ui.discardPile.appendChild(card);
                player.$throw(card);
                player.storage.伏兵.splice(index,1);
                player.storage.fubing2.splice(index,1);
                if(player.storage.伏兵.length==0){
                    player.unmarkSkill('伏兵');
                }
                else{
                    player.syncStorage('伏兵');
                    player.markSkill('伏兵');
                    if(player.isOnline2()){
                        player.send(function(storage){
                            game.me.storage.fubing2=storage;
                        },player.storage.fubing2);
                    }
                }
            }
            game.delay(2);
            if(trigger.name=='respond'){
                if(trigger.parent.result){
                    trigger.parent.result.bool=false;
                }
            }
            else{
                trigger.untrigger();
                trigger.finish();
                player.gainMaxHp();
            }
        }
        else{
            event.finish();
        }
        "step 2"
        game.broadcastAll(ui.clear);
    },
                ai:{
                    threaten:1.8,
                    expose:0.3,
                },
            },
            "刚直":{
                audio:["刚直",2],
                trigger:{
                    player:"damageEnd",
                },
                filter:function (event,player){
        if(!event.source) return false;
        var nh1=player.num('h');
        var nh2=event.source.num('h');
        if(nh1==nh2) return false;
        if(nh2<nh2) return false;
        if(nh2>nh2&&event.source.isDead()) return false;
        return true;
    },
                direct:true,
                content:function (){
        "step 0"
        var num1=player.num('h');
        var num2=trigger.source.num('h');
        if(num1>num2){
            var next=player.chooseToDiscard([num2,num1],'刚直：是否弃置至少'+(num2)+'张手牌,并对'+get.translation(trigger.source)+'造成二点伤害？');
            next.logSkill=['刚直',trigger.source];
            next.set('ai',function(card){
                var trigger=_status.event.getTrigger();
                var player=_status.event.player;
                if(ui.selected.cards.length>=_status.event.num){
                    return -1;
                }
                if(ai.get.damageEffect(trigger.source,player,player)>0&&_status.event.num<=2){
                    return 8-ai.get.value(card);
                }
                return -1;
            });
            next.set('num',num2);
        }
        else{
            event.draw=true;
            event.num=Math.min(num2)-num1;
            player.chooseBool(get.prompt('刚直'));
        }
        "step 1"
        if(result.bool){
            if(event.draw){
                player.logSkill('刚直',trigger.source);
                player.draw(event.num);
            }
            else{
                trigger.source.damage(2,player);
                player.recover();
            }
        }
    },
            },
            "镇守":{
                trigger:{
                    global:"useCardToBefore",
                },
                audio:["镇守",2],
                direct:true,
                priority:5,
                filter:function (event,player){
        if(player==event.target||player==event.player) return false;
        if(!player.countCards('he')) return false;
        if(event.targets.length>1) return false;
        if(!event.target) return false;
        if(event.target.hp>=player.hp) return false;

        var card=event.card;
        if(card.name=='sha') return true;
        if(get.type(card)=='trick') return true;
        return false;
    },
                content:function (){
        "step 0"
        var save=false;
        if(ai.get.attitude(player,trigger.target)>2){
            if(trigger.card.name=='sha'){
                if(player.countCards('h','shan')||player.getEquip(2)||
                trigger.target.hp==1||player.hp>trigger.target.hp+1){
                    if(!trigger.target.countCards('h','shan')||trigger.target.countCards('h')<player.countCards('h')){
                        save=true;
                    }
                }
            }
            else if(trigger.card.name=='juedou'&&trigger.target.hp==1){
                save=true;
            }
            else if(trigger.card.name=='shunshou'&&
                ai.get.attitude(player,trigger.player)<0&&
                ai.get.attitude(trigger.player,trigger.target)<0){
                save=true;
            }
        }
        var next=player.chooseToDiscard('he',get.prompt('zhenwei'));
        next.logSkill=['镇守',trigger.target];
        next.set('ai',function(card){
            if(_status.event.aisave){
                return 7-ai.get.value(card);
            }
            return 0;
        });
        next.set('aisave',save);
        "step 1"
        if(result.bool){
            player.chooseControl('转移','失效',function(){
                var trigger=_status.event.getTrigger();
                var player=_status.event.player;
                if(trigger.card.name=='sha'){
                    if(player.countCards('h','shan')) return '转移';
                }
                else if(trigger.card.name=='juedou'){
                    if(player.countCards('h','sha')) return '转移';
                }
                return '失效';
            }).set('prompt','将'+get.translation(trigger.card)+'转移给你，或令其失效');
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.control=='转移'){
            player.draw(2);
            trigger.target=player;
            trigger.targets.length=0;
            trigger.targets.push(player);
            trigger.untrigger();
            trigger.trigger('useCardToBefore');
            trigger.trigger(trigger.card.name+'Before');
            trigger.player.line(player);
        }
        else{
            if(get.itemtype(trigger.card)=='card'){
                trigger.player.$gain2(trigger.card);
                if(!trigger.player.storage.镇守2){
                    trigger.player.storage.镇守2=[trigger.card];
                }
                else{
                    trigger.player.storage.镇守2.push(trigger.card);
                }
                ui.special.appendChild(trigger.card);
                trigger.player.markSkill('镇守2');
            }
            trigger.untrigger();
            trigger.finish();
            trigger.player.addSkill('镇守2');
        }
        game.delay();
    },
                ai:{
                    threaten:1.1,
                },
            },
            "仁爱":{
                trigger:{
                    global:"damageBefore",
                },
                audio:["仁爱",2],
                priority:6,
                filter:function (event,player){
        return event.player!=player&&event.player.hp==1&&player.num('he',{type:'equip'})>0;
    },
                direct:true,
                content:function (){
        "step 0"
        var next=player.chooseToDiscard(get.prompt('仁爱',trigger.player),{type:'equip'},'he');
        next.logSkill=['仁爱',trigger.player];
        next.set('ai',function(card){
            var player=_status.event.player;
            if(ai.get.attitude(player,_status.event.getTrigger().player)>3){
                return 11-ai.get.value(card);
            }
            return -1;
        });
        "step 1"
        
         event.finish();
 
        "step 2"
        trigger.untrigger();
        trigger.finish();
        player.gianMaxHp();
        palyer.recover();
    },
                ai:{
                    expose:0.5,
                },
            },
            "神童":{
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                direct:true,
                audio:["神童",2],
                content:function (){
        "step 0"
        event.cards=get.cards(8);
        event.videoId=lib.status.videoId++;
        game.broadcastAll(function(player,id,cards){
            var str;
            if(player==game.me&&!_status.auto){
                str='神童：选择任意张点数小于16的牌';
            }
            else{
                str='神童';
            }
            var dialog=ui.create.dialog(str,cards);
            dialog.videoId=id;
        },player,event.videoId,event.cards);
        event.time=get.utc();
        game.addVideo('showCards',player,['神童',get.cardsInfo(event.cards)]);
        game.addVideo('delay',null,2);
        "step 1"
        var next=player.chooseButton([0,4]);
        next.set('dialog',event.videoId);
        next.set('filterButton',function(button){
            var num=0
            for(var i=0;i<ui.selected.buttons.length;i++){
                num+=get.number(ui.selected.buttons[i].link);
            }
            return (num+get.number(button.link)<=16);
        });
        next.set('ai',function(button){
            return ai.get.value(button.link,_status.event.player);
        });
        "step 2"
        if(result.bool&&result.links){
            player.logSkill('神童');
            var cards2=[];
            for(var i=0;i<result.links.length;i++){
                cards2.push(result.links[i]);
                cards.remove(result.links[i]);
            }
            for(var i=0;i<cards.length;i++){
                ui.discardPile.appendChild(cards[i]);
            }
            event.cards2=cards2;
        }
        else{
            event.finish();
        }
        var time=1000-(get.utc()-event.time);
        if(time>0){
            game.delay(0,time);
        }
        "step 3"
        game.broadcastAll('closeDialog',event.videoId);
        var cards2=event.cards2;
        player.gain(cards2);
        player.$draw(cards2);
        game.log(player,'获得了',cards2)
        game.delay(2);
    },
                ai:{
                    maixie:true,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(player.hasSkill('jueqing')) return [1,-2];
                    var hasfriend=false;
                    for(var i=0;i<game.players.length;i++){
                        if(game.players[i]!=target&&ai.get.attitude(game.players[i],target)>=0){
                            hasfriend=true;break;
                        }
                    }
                    if(!hasfriend) return;
                    if(target.hp>=4) return [1,2];
                    if(target.hp==3) return [1,1.5];
                    if(target.hp==2) return [1,0.5];
                }
            },
                    },
                },
            },
            "精算":{
                trigger:{
                    player:"phaseUseEnd",
                },
                frequent:true,
                filter:function (event,player){
        return get.cardCount(true,player)<=player.hp;
    },
                content:function (){
        var num=get.cardCount(true,player);
        if(num>0){
            player.draw(num);
        }
    },
                audio:["精算",2],
                init:function (player){player.storage.精算=true},
                intro:{
                    content:function (storage,player){
            if(_status.currentPhase==player) return '已使用'+get.cardCount(true,player)+'张牌';
        },
                },
            },
            "can2":{
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                popup:false,
                silent:true,
                content:function (){
        player.storage.迂回=0;
    },
            },
            "迂回":{
                audio:["迂回",2],
                trigger:{
                    player:"useCard",
                },
                direct:true,
                filter:function (event,player){
        if(!event.targets) return false;
        if(_status.currentPhase!=player) return false;
        var type=get.type(event.card,'trick');
        if(type!='basic'&&type!='trick'&&type!=='equip') return false;
        return game.hasPlayer(function(target){
            return !event.targets.contains(target)&&target.num('he')>0;
        });
    },
                content:function (){
        'step 0'
         player.chooseTarget(get.prompt('迂回'),function(card,player,target){
                    return target.num('he')>0;
                }).set('ai',function(target){
                    var player=_status.event.player;
                    if(target==player) return 2;
                    if(ai.get.attitude(player,target)<=0){
                        return 1
                    }
                    return 0.5;
                });
        'step 1'
        if(result.bool){
            player.storage.迂回++;
            if(!event.isMine()) game.delay();
            player.logSkill('迂回',result.targets);
            player.discardPlayerCard(result.targets[0],true,'he');
            event.target=result.targets[0];
        }
        else{
            event.finish();
        }
        'step 2'
        player.draw();
    },
                group:"can2",
            },
            "趋向":{
                group:"quxiang2",
                trigger:{
                    player:"phaseEnd",
                },
                audio:["趋向",2],
                check:function (event,player){
        return player.storage.迂回>=player.num('h');
    },
                prompt:function (event,player){
        if(typeof player.storage.迂回!='number'){
            '趋向：是否摸'+get.cnNumber(0)+'张牌并将手牌弃置至'+get.cnNumber(0)+'张？';
        }
        return '趋向：是否摸'+get.cnNumber(player.storage.迂回)+'张牌并将手牌弃置至'+get.cnNumber(player.storage.迂回)+'张？';
    },
                content:function (){
        'step 0'
        player.draw(player.storage.迂回);
        'step 1'
        if(typeof player.storage.迂回!='number'){
            player.storage.迂回=0;
        }
        var dh=player.num('h')-player.storage.迂回;
        if(dh>0){
            player.chooseToDiscard(dh,true);
        }
    },
            },
            "quxiang2":{
                audio:["趋向",2],
                trigger:{
                    player:"phaseEnd",
                },
                prompt:function (event,player){
        if(typeof player.storage.迂回!='number'){
            '趋向：是否增加1点体力上限并将体力回复至至'+get.cnNumber(0)+'点？';
        }
        return '趋向：是否增加1点体力上限并将体力回复至至'+get.cnNumber(player.storage.迂回)+'点？';
    },
                content:function (){
        'step 0'
        player.gainMaxHp(1);
        'step 1'
        if(typeof player.storage.迂回!='number'){
            player.storage.迂回=0;
        }
        var dh=player.storage.迂回;
        if(dh>0){
            player.recover(dh,true);
        }
    },
            },
            "落梅":{
                unique:true,
                gainable:true,
                group:["luomei1","luomei2"],
            },
            "luomei1":{
                audio:["落梅",2],
                trigger:{
                    global:"discardAfter",
                },
                filter:function (event,player){
                if(event.player==player) return false;
                for(var i=0;i<event.cards.length;i++){
                    if(get.position(event.cards[i])=='d'){
                        return true;
                    }
                }
                return false;
            },
                frequent:"check",
                check:function (event,player){
                for(var i=0;i<event.cards.length;i++){
                    if(get.position(event.cards[i])=='d'){
                        if(event.cards[i].name=='du') return false;
                    }
                }
                return true;
            },
                content:function (){
                "step 0"
                if(trigger.delay==false) game.delay();
                "step 1"
                var cards=[];
                for(var i=0;i<trigger.cards.length;i++){
                    if(get.position(trigger.cards[i])=='d'){
                        cards.push(trigger.cards[i]);
                    }
                }
                if(cards.length){
                    player.gain(cards);
                    player.$gain2(cards);
                    game.log(player,'发动落梅，获得了',cards);
             player.recover();
                }
            },
            },
            "luomei2":{
                audio:["落梅",2],
                trigger:{
                    global:"judgeAfter",
                },
                frequent:"check",
                check:function (event,player){
                return event.result.card.name!='du';
            },
                filter:function (event,player){
                if(event.player==player) return false;
                if(event.result.card.parentNode.id!='discardPile') return false;
            },
                content:function (){
                player.gain(trigger.result.card);
                player.$gain2(trigger.result.card);
                player.recover();
            },
            },
            "妙笔":{
                group:["miaobi1","miaobi2","miaobi3"],
            },
            "miaobi1":{
                audio:["妙笔",2],
                enable:"chooseToUse",
                filter:function (event,player){
        if(player.classList.contains('turnedover')) return false;
        if(event.parent.name=='phaseUse'){
            return lib.filter.filterCard({name:'jiu'},player,event);
        }
        if(event.type!='dying') return false;
        if(player!=event.dying) return false;
        return true;
    },
                content:function (){
        if(_status.event.getParent(2).type=='dying'){
            event.dying=player;
        }
        player.turnOver();
        player.recover();
        player.useCard({name:'tao'},player);
    },
                ai:{
                    save:true,
                    skillTagFilter:function (player){
            return player.hp<=0&&!player.isTurnedOver();
        },
                    order:5,
                    result:{
                        player:function (player){
                if(_status.event.parent.name=='phaseUse'){
                    if(player.num('h','jiu')>0) return 0;
                    if(player.num('e','zhuge')&&player.num('h','sha')>1) return 0;
                    if(!player.num('h','sha')) return 0;
                    var targets=[];
                    var target;
                    for(var i=0;i<game.players.length;i++){
                        if(ai.get.attitude(player,game.players[i])<0){
                            if(player.canUse('sha',game.players[i],true,true)){
                                targets.push(game.players[i]);
                            }
                        }
                    }
                    if(targets.length){
                        target=targets[0];
                    }
                    else{
                        return 0;
                    }
                    var num=ai.get.effect(target,{name:'sha'},player,player);
                    for(var i=1;i<targets.length;i++){
                        var num2=ai.get.effect(targets[i],{name:'sha'},player,player);
                        if(num2>num){
                            target=targets[i];
                            num=num2;
                        }
                    }
                    if(num<=0) return 0;
                    var e2=target.get('e','2');
                    if(e2){
                        if(e2.name=='tengjia'){
                            if(!player.num('h',{name:'sha',nature:'fire'})&&!player.num('e','zhuque')) return 0;
                        }
                        if(e2.name=='renwang'){
                            if(!player.num('h',{name:'sha',color:'red'})) return 0;
                        }
                        if(e2.name=='baiyin') return 0;
                    }
                    if(player.num('e','guanshi')&&player.num('he')>2) return 1;
                    return target.num('h')>3?0:1;
                }
                if(player==_status.event.dying||player.isTurnedOver()) return 3;
            },
                    },
                    effect:{
                        target:function (card,player,target){
                if(card.name=='guiyoujie') return [0,0.5];
                if(target.isTurnedOver()){
                    if(get.tag(card,'damage')){
                        if(player.hasSkill('jueqing')) return [1,-2];
                        if(target.hp==1) return;
                        return [1,target.num('h')/2];
                    }
                }
            },
                    },
                },
            },
            "miaobi2":{
                trigger:{
                    player:"damageBegin",
                },
                forced:true,
                popup:false,
                silent:true,
                filter:function (event,player){
        return player.classList.contains('turnedover');
    },
                content:function (){
        player.storage.妙笔=true;
    },
            },
            "miaobi3":{
                audio:["妙笔",2],
                trigger:{
                    player:"damageAfter",
                },
                check:function (event,player){
                return player.isTurnedOver();
            },
                filter:function (event,player){
                if(player.storage.妙笔){
                    return true;
                }
                return false;
            },
                content:function (){
                player.storage.妙笔=false;
                player.turnOver();
           player.gainMaxHp();
           player.draw(2);
            },
            },
            "严整":{
                group:"yanzheng1",
            },
            "yanzheng1":{
                audio:["严整",1],
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                content:function (){
        'step 0'
        player.chooseCardTarget({
            filterTarget:function(card,player,target){
                return target!=player&&target.num('he')>0;
            },
            filterCard:lib.filter.cardDiscardable,
            ai1:function(card){
                return 7-ai.get.useful(card);
            },
            ai2:function(target){
                return 1-ai.get.attitude(_status.event.player,target);
            },
            prompt:get.prompt('严整')
        });
        'step 1'
        if(result.bool){
            player.logSkill('yanzheng1',result.targets);
            player.discard(result.cards);
            var target=result.targets[0];
            event.target=target;
            target.chooseCard('将一张牌置于'+get.translation(player)+'的武将牌上，或令其弃置你的一张牌','he').set('ai',function(card){
                if(card.name=='du') return 20;
                var player=_status.event.player;
                if(ai.get.attitude(player,_status.event.getParent().player)>0){
                    return 8-ai.get.value(card);
                }
                var nh=player.num('h');
                if(nh<=2){
                    return 6-ai.get.value(card);
                }
                if(nh<=3){
                    return 2-ai.get.value(card);
                }
                return 0;
            });
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.bool&&result.cards&&result.cards.length){
            event.target.$give(result.cards,player);
            player.storage.yanzheng2=result.cards[0];
            event.target.lose(result.cards[0],ui.special);
            player.syncStorage('yanzheng2');
            player.addSkill('yanzheng2');
            player.recover(3);
        }
        else if(event.target.num('he')){
            player.discardPlayerCard(event.target,true);
            player.draw(3);
        }
    },
                ai:{
                    expose:0.1,
                },
            },
            "yanzheng2":{
                mark:"card",
                intro:{
                    content:"card",
                },
                audio:["严整",1],
                enable:"chooseToUse",
                filterCard:function (card){
        return get.color(card)=='black';
    },
                viewAsFilter:function (player){
        return player.num('h',{color:'black'})>0;
    },
                viewAs:{
                    name:"南蛮",
                },
                prompt:"将一张黑色手牌当南蛮入侵使用",
                check:function (card){return 8-ai.get.value(card)},
                threaten:1.2,
                group:["yanzheng3","yanzheng4"],
                ai:{
                },
            },
            "yanzheng3":{
                enable:["chooseToRespond"],
                filterCard:function (card){
        return get.color(card)=='red';
    },
                viewAs:{
                    name:"tao",
                },
                viewAsFilter:function (player){
        if(!player.num('h',{color:'red'})) return false;
    },
                audio:["严整",1],
                prompt:"将一张红色手牌当桃打出",
                check:function (){return 1},
                ai:{
                    respondShan:true,
                    skillTagFilter:function (player){
            if(!player.num('h',{color:'red'})) return false;
        },
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'respondShan')&&current<0) return 0.8
            },
                    },
                    basic:{
                        order:function (card,player){
                if(player.hasSkillTag('pretao')) return 5;
                return 2;
            },
                        useful:[8,6.5],
                        value:[8,6.5],
                    },
                    result:{
                        target:function (player,target){
                // if(player==target&&player.hp<=0) return 2;
                var nh=target.num('h');
                var keep=false;
                if(nh<=target.hp){
                    keep=true;
                }
                else if(nh==target.hp+1&&target.hp>=2&&target.num('h','tao')<=1){
                    keep=true;
                }
                var mode=get.mode();
                if(target.hp>=2&&keep&&target.hasFriend()){
                    if(target.hp>2) return 0;
                    if(target.hp==2){
                        for(var i=0;i<game.players.length;i++){
                            if(target!=game.players[i]&&ai.get.attitude(target,game.players[i])>=3){
                                if(game.players[i].hp<=1) return 0;
                                if(mode=='identity'&&game.players[i].isZhu&&game.players[i].hp<=2) return 0;
                            }
                        }
                    }
                }
                if(target.hp<0&&target!=player&&target.identity!='zhu') return 0;
                var att=ai.get.attitude(player,target);
                if(att<3&&att>=0&&player!=target) return 0;
                var tri=_status.event.getTrigger();
                if(mode=='identity'&&player.identity=='fan'&&target.identity=='fan'){
                    if(tri&&tri.name=='dying'&&tri.source&&tri.source.identity=='fan'&&tri.source!=target){
                        var num=0;
                        for(var i=0;i<game.players.length;i++){
                            if(game.players[i].identity=='fan'){
                                num+=game.players[i].num('h','tao');
                                if(num>2) return 2;
                            }
                        }
                        if(num>1&&player==target) return 2;
                        return 0;
                    }
                }
                if(mode=='identity'&&player.identity=='zhu'&&target.identity=='nei'){
                    if(tri&&tri.name=='dying'&&tri.source&&tri.source.identity=='zhong'){
                        return 0;
                    }
                }
                if(mode=='stone'&&target.isMin()&&
                player!=target&&tri&&tri.name=='dying'&&player.side==target.side&&
                tri.source!=target.getEnemy()){
                    return 0;
                }
                return 2;
            },
                    },
                    tag:{
                        recover:1,
                        save:1,
                    },
                },
            },
            "yanzheng4":{
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                content:function (){
        player.gain(player.storage.yanzheng2,'gain2');
        player.storage.yanzheng2=null;
        player.removeSkill('yanzheng2');
    },
            },
            "外愚":{
                audio:["外愚",2],
                trigger:{
                    player:"damageEnd",
                },
                content:function (){
        "step 0"
        player.draw();
        "step 1"
        player.showHandcards();
        "step 2"
        if(!trigger.source) return;
        var cards=player.get('h');
        for(var i=1;i<cards.length;i++){
            if(get.color(cards[i])!=get.color(cards[0])){
        trigger.source.chooseToDiscard(1);
        player.recover();
        player.draw();
            }
        }
    },
                ai:{
                    threaten:0.9,
                },
            },
            "妙策":{
                enable:"phaseUse",
                audio:["妙策",2],
                filter:function (event,player){
        return player.num('h')>0
    },
                chooseButton:{
                    dialog:function (){
            var list=['taoyuan','wugu','juedou','huogong','jiedao','tiesuo','guohe','shunshou','wuzhong','wanjian','nanman'];
            for(var i=0;i<list.length;i++){
                list[i]=['锦囊','',list[i]];
            }
            return ui.create.dialog([list,'vcard']);
        },
                    filter:function (button,player){
            return lib.filter.filterCard({name:button.link[2]},player,_status.event.getParent());
        },
                    check:function (button){
            var player=_status.event.player;
            var recover=0,lose=1;
            for(var i=0;i<game.players.length;i++){
                if(!game.players[i].isOut()){
                    if(game.players[i].hp<game.players[i].maxHp){
                        if(ai.get.attitude(player,game.players[i])>0){
                            if(game.players[i].hp<2){
                                lose--;
                                recover+=0.5;
                            }
                            lose--;
                            recover++;
                        }
                        else if(ai.get.attitude(player,game.players[i])<0){
                            if(game.players[i].hp<2){
                                lose++;
                                recover-=0.5;
                            }
                            lose++;
                            recover--;
                        }
                    }
                    else{
                        if(ai.get.attitude(player,game.players[i])>0){
                            lose--;
                        }
                        else if(ai.get.attitude(player,game.players[i])<0){
                            lose++;
                        }
                    }
                }
            }
            if(lose>recover&&lose>0) return (button.link[2]=='nanman')?1:-1;
            if(lose<recover&&recover>0) return (button.link[2]=='taoyuan')?1:-1;
            return (button.link[2]=='wuzhong')?1:-1;
        },
                    backup:function (links,player){
            return {
                filterCard:true,
                selectCard:-1,
                audio:["妙策",2],
                popname:true,
                viewAs:{name:links[0][2]},
            }
        },
                    prompt:function (links,player){
            return '将全部手牌当作'+get.translation(links[0][2])+'使用';
        },
                },
                ai:{
                    order:1,
                    result:{
                        player:function (player){
                var num=0;
                var cards=player.get('h');
                if(cards.length>=3&&player.hp>=3) return 0;
                for(var i=0;i<cards.length;i++){
                    num+=Math.max(0,ai.get.value(cards[i],player,'raw'));
                }
                num/=cards.length;
                num*=Math.min(cards.length,player.hp);
                return 12-num;
            },
                    },
                    threaten:1.6,
                },
            },
            "起兵":{
                skillAnimation:true,
                audio:["起兵",2],
                unique:true,
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                filter:function (event,player){
        return !player.hasSkill('族裔')&&player.storage.权宜&&player.storage.权宜.length>=9;
    },
                content:function (){
        "step 0"
        player.chooseControl('recover_hp','draw_card',function(event,player){
            if(player.hp>=2) return 'draw_card';
            return 'recover_hp';
        });
        "step 1"
        if(result.control=='draw_card'){
            player.draw(4);
            palyer.gainMaxHp(4);
        }
        else{
            player.gainMaxHp();
            player.recover(3);
        }
        "step 2"
        player.loseMaxHp();
        player.addSkill('族裔');
    },
            },
            "权宜":{
                audio:["权宜",2],
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                frequent:true,
                locked:false,
                init:function (player){
        player.storage.权宜=[];
    },
                filter:function (event){
        return event.num>0;
    },
                content:function (){
        "step 0"
        player.draw(2);
        player.recover();
        "step 1"
        if(player.num('he')){
            player.chooseCard('将'+get.cnNumber(trigger.num)+'张手牌置于武将牌上作为“权”',trigger.num,true);
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.cards&&result.cards.length){
            player.lose(result.cards,ui.special);
            player.storage.权宜=player.storage.权宜.concat(result.cards);
            player.syncStorage('权宜');
            player.markSkill('权宜');
            game.log(player,'将',result.cards,'置于武将牌上作为“权”');
        }
    },
                intro:{
                    content:"cards",
                },
                mod:{
                    maxHandcard:function (player,num){
            return num+=(player.storage.权宜.length*2);
        },
                },
                ai:{
                    maixie:true,
                    threaten:0.8,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(player.hasSkill('jueqing')) return [1,-2];
                    var hasfriend=false;
                    for(var i=0;i<game.players.length;i++){
                        if(game.players[i]!=target&&ai.get.attitude(game.players[i],target)>=0){
                            hasfriend=true;break;
                        }
                    }
                    if(!hasfriend) return;
                    if(target.hp>=4) return [0.5,get.tag(card,'damage')*2];
                    if(!target.hasSkill('族裔')&&target.hp>1) return [0.5,get.tag(card,'damage')*1.5];
                    if(target.hp==3) return [0.5,get.tag(card,'damage')*1.5];
                    if(target.hp==2) return [1,get.tag(card,'damage')*0.5];
                }
            },
                    },
                },
            },
            "族裔":{
                enable:"phaseUse",
                usable:1,
                audio:["族裔",2],
                filterTarget:true,
                filter:function (event,player){
        return player.storage.权宜.length>0;
    },
                content:function (){
        "step 0"
        player.chooseCardButton(player.storage.权宜,true);
        "step 1"
        var card=result.links[0];
        player.discard(card);
        player.storage.权宜.remove(card);
        if(!player.storage.权宜.length){
            player.unmarkSkill('权宜');
        }
        else{
            player.markSkill('权宜');
        }
        player.syncStorage('权宜');
        "step 2"
        target.draw(2);
        target.gainMaxHp();
        "step 3"
        if(target.num('h')>player.num('h')){
         target.damage();
        }
    },
                ai:{
                    order:1,
                    result:{
                        target:function (player,target){
                if(player!=target) return 0;
                if(player.num('h')+2<=player.hp+player.storage.权宜.length) return 1;
                return 0;
            },
                    },
                },
            },
            "酷法":{
                enable:"phaseUse",
                audio:["酷法",2],
                usable:1,
                filterCard:true,
                selectCard:[1,null],
                filter:function (event,player){
        return player.num('h')>0;
    },
                check:function (card){
        if(ui.selected.cards.length) return -1;
        var val=ai.get.value(card);
        if(get.type(card)=='basic') return 8-ai.get.value(card);
        return 5-ai.get.value(card);
    },
                filterTarget:function (card,player,target){
        return player!=target;
    },
                content:function (){
        "step 0"
        var types=[];
        for(var i=0;i<cards.length;i++){
            types.add(get.type(cards[i],'trick'));
        }
        target.chooseToDiscard(function(card){
            return !_status.event.types.contains(2,get.type(card,'trick'));
        }).set('ai',function(card){
            if(_status.event.player.isTurnedOver()) return -1;
            return 8-ai.get.value(card);
        }).set('types',types).set('dialog',['弃置一张与'+get.translation(player)+'弃置的牌类别均不同的牌，或失去1点体力上限，流失1点体力，并将武将牌翻面','hidden',cards]);
        "step 1"
        if(!result.bool){
            target.turnOver();
            target.loseHp(cards.length);
            target.loseMaxHp();
        }
    },
                ai:{
                    order:2,
                    expose:0.3,
                    threaten:1.8,
                    result:{
                        target:function (player,target){
                if(target.isTurnedOver()) return 2;
                return -1/(target.num('h')+1);
            },
                    },
                },
            },
            "御敌":{
                audio:["御敌",2],
                trigger:{
                    player:["damageAfter","loseHpEnd"],
                },
                direct:true,
                filter:function (event,player){
        return player.num('h')>0;
    },
                content:function (){
        "step 0"
        var next=player.chooseToDiscard(get.prompt('御敌'));
        next.logSkill='御敌';
        next.set('ai',function(card){
            return 7-ai.get.value(card);
        });
        "step 1"
        if(result.bool){
            var type=get.type(result.cards[0],'trick');
            if(trigger.source){
                trigger.source.chooseToDiscard('弃置一张'+get.translation(type)+'牌或令'+get.translation(player)+'回复一点体力',function(card){
                    return get.type(card,'trick')==_status.event.type;
                }).set('ai',function(card){
                    if(ai.get.recoverEffect(_status.event.getParent().player,_status.event.player,_status.event.player)<0){
                        return 7-ai.get.value(card);
                    }
                    return 0;
                }).set('type',type);
            }
            else{
                event.recover=true;
            }
        }
        else{
            event.finish();
        }
        "step 2"
        if(event.recover){
            player.recover();
            player.draw();
        }
        else if(result.bool){
            player.draw();
            player.gainMaxHp();
        }
        else{
            player.recover();
            player.draw();
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage'&&target.num('h'))){
                    return 0.8
                }
            },
                    },
                },
            },
            "制敌":{
                audio:["制敌",2],
                group:"zhidi6",
                trigger:{
                    global:"phaseUseBegin",
                },
                direct:true,
                filter:function (event,player){
        if(event.player==player) return false;
        var hs=player.get('h');
        if(!hs.length) return false;
        var es=player.get('e');
        if(!es.length) return false;
        var color=[];
        for(var i=0;i<es.length;i++){
            color.add(get.color(es[i]));
        }
        if(color.length==2) return true;
        color=color[0];
        for(var i=0;i<hs.length;i++){
            if(get.color(hs[i])==color) return true;
        }
        return false;
    },
                ai:{
                    threaten:1.5,
                },
                content:function (){
        'step 0'
        var goon=true;
        if(ai.get.attitude(player,trigger.player)>=-0.8) goon=false;
        else if(trigger.player.num('h')<=3) goon=false;
        else if(player.num('h','shan')==0) goon=false;
        var es=player.get('e');
        var color=[];
        for(var i=0;i<es.length;i++){
            color.add(get.color(es[i]));
        }
        if(color.length==2) color='all';
        else color=color[0];
        player.chooseToDiscard(get.prompt('制敌',trigger.player),function(card){
            if(_status.event.color=='all') return true;
            return get.color(card)==_status.event.color;
        }).set('ai',function(card){
            if(_status.event.goon) return 6-ai.get.value(card);
            return 0;
        }).set('goon',goon).set('color',color).set('logSkill',['制敌',trigger.player]);
        'step 1'
        if(result.bool){
            trigger.player.addSkill('zhidi2');
            trigger.player.storage.zhidi2=get.color(result.cards[0]);
            trigger.player.storage.zhidi4=player;
            trigger.player.syncStorage('zhidi2');
        }
    },
            },
            "zhidi2":{
                mark:true,
                group:["zhidi2_sha","zhidi2_end"],
                subSkill:{
                    sha:{
                        trigger:{
                            player:"shaBegin",
                        },
                        forced:true,
                        popup:false,
                        content:function (){
                player.storage.zhidi3=true;
            },
                    },
                    end:{
                        trigger:{
                            player:"phaseUseAfter",
                        },
                        forced:true,
                        popup:false,
                        audio:["制敌",2],
                        content:function (){
                if(!player.storage.zhidi3&&player.storage.zhidi4.isAlive()){
                    player.storage.zhidi4.useCard({name:'sha'},player);
                }
                delete player.storage.zhidi2;
                delete player.storage.zhidi3;
                delete player.storage.zhidi4;
                player.removeSkill('zhidi2');
            },
                    },
                },
                mod:{
                    cardEnabled:function (card,player){
            if(get.color(card)==player.storage.zhidi2) return false;
        },
                    cardUsable:function (card,player){
            if(get.color(card)==player.storage.zhidi2) return false;
        },
                    cardRespondable:function (card,player){
            if(get.color(card)==player.storage.zhidi2) return false;
        },
                    cardSavable:function (card,player){
            if(get.color(card)==player.storage.zhidi2) return false;
        },
                },
                intro:{
                    content:function (color){
            return '不能使用或打出'+get.translation(color)+'的牌';
        },
                },
            },
            "zhidi6":{
                trigger:{
                    target:"shaBefore",
                },
                forced:true,
                audio:["制敌",2],
                filter:function (event,player){
        if(player.get('e','2')) return false;
        return (event.card.name=='sha')
    },
                content:function (){
        trigger.untrigger();
        trigger.finish();
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(target.get('e','2')) return;
                if(card.name=='sha'&&get.color(card)=='black') return 'zerotarget';
            },
                    },
                },
            },
            "中正":{
                enable:"phaseUse",
                usable:5,
                audio:["中正",2],
                filter:function (event,player){
        return player.num('h')>0;
    },
                filterTarget:function (card,player,target){
        return target.hp<target.maxHp&&!target.tempSkills.zhongzheng2;
    },
                filterCard:true,
                check:function (card){
        return 6-ai.get.value(card);
    },
                content:function (){
        "step 0"
        target.judge(function(card){
            return get.color(card)=='black'?1:-1;
        });
        "step 1"
        if(result.bool){
            target.draw(target.maxHp-target.hp);
            target.addTempSkill('zhongzheng2','phaseAfter');
        }
        else{
            player.turnOver();
            player.loseHp();
        }
    },
                ai:{
                    order:9,
                    result:{
                        target:function (player,target){
                if(player.isTurnedOver()) return 1;
                if(target.hp<target.maxHp-1) return 1;
                return 0;
            },
                    },
                },
            },
            "zhongzheng2":{
            },
            "法定":{
                audio:["法定",2],
                trigger:{
                    global:["turnOverAfter","loseHpEnd"],
                },
                filter:function (event,player){
        if(event.name=='link') return event.player.isLinked();
        return true;
    },
                check:function (event,player){
        return ai.get.attitude(player,event.player)>0;
    },
                content:function (){
        var num=player.maxHp-player.num('h');
        if(num>0){
            player.line(trigger.player,'green');
            trigger.player.draw(num);
            trigger.player.recover();
        }
    },
                ai:{
                    expose:0.2,
                },
            },
            "驹骑":{
                mod:{
                    globalFrom:function (from,to,distance){
            return distance-(from.maxHp-from.hp);
        },
                    globalTo:function (from,to,distance){
            return distance+(from.maxHp-from.hp);
        },
                },
            },
            "虎豹":{
                audio:["虎豹",2],
                trigger:{
                    source:"damageBegin",
                },
                check:function (event,player){
        return ai.get.attitude(player,event.player)<0;
    },
                filter:function (event,player){
        return event.card&&event.card.name=='sha'&&player.get('e','1');
    },
                content:function (){
        'step 0'
        var num=1;
        var info=get.info(player.get('e','1'));
        if(info&&info.distance&&info.distance.attackFrom){
            num-=info.distance.attackFrom;
        }
        if(trigger.player.num('h')<num){
            event.directfalse=true;
        }
        else{
            trigger.player.chooseToDiscard(num,'弃置'+get.cnNumber(num)+'张手牌，或令杀的伤害+X').set('ai',function(card){
                var player=_status.event.player;
                if(player.hp==1){
                    if(get.type(card)=='basic'){
                        return 8-ai.get.value(card);
                    }
                    else{
                        return 10-ai.get.value(card);
                    }
                }
                else{
                    if(num>2){
                        return 0;
                    }
                    return 8-ai.get.value(card);
                }
            });
        }
        'step 1'
        if(!event.directfalse&&result.bool){
            var e1=player.get('e','1');
            if(e1){
                player.discard(e1);
            }
        }
        else{
            trigger.num+=3;
        }
    },
            },
            "墨心":{
                audio:["墨心",2],
                trigger:{
                    player:"chooseToRespondBegin",
                },
                filter:function (event,player){
        if(event.responded) return false;
        if(!event.filterCard({name:'shan'})) return false;
        if(event.parent.name!='sha') return false;
        var hs=player.get('he',{color:'black'});
        for(var i=0;i<hs.length;i++){
            if(get.type(hs[i])!='basic'){
                break;
            }
        }
        if(i==hs.length) return false;
        return true;
    },
                direct:true,
                content:function (){
        "step 0"
        player.chooseCard(get.prompt('墨心'),'he',function(card){
            return get.type(card)!='basic'&&get.color(card)=='black';
        }).set('ai',function(card){
            if(!_status.event.player.num('h','shan')){
                return 8-ai.get.value(card);
            }
            return 6-ai.get.value(card);
        });
        "step 1"
        if(result.bool){
            trigger.untrigger();
            trigger.responded=true;
            trigger.result={bool:true,card:{name:'shan'}}
            player.lose(result.cards,ui.special);
            player.$throw(result.cards);
            event.card=result.cards[0];
            player.logSkill('墨心');
            player.draw(2);
        }
        else{
            event.finish();
        }
        'step 2'
        if(player==game.me&&event.card){
            game.delay();
        }
        'step 3'
        if(event.card){
            ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
        }
    },
                group:["moxin_count","moxin_count2","moxin_sha","moxin_jiu","moxin_tao"],
            },
            "moxin_count":{
                init:function (player){
        player.storage.墨心={};
    },
                trigger:{
                    global:"phaseBegin",
                },
                forced:true,
                popup:false,
                silent:true,
                content:function (){
        player.storage.墨心={};
    },
            },
            "moxin2":{
            },
            "moxin_count2":{
                trigger:{
                    player:"useCard",
                },
                forced:true,
                popup:false,
                silent:true,
                content:function (){
                if(!player.storage.墨心) player.storage.墨心={};
                switch(trigger.card.name){
                    case 'sha':player.storage.墨心.sha=true;break;
                    case 'tao':player.storage.墨心.tao=true;break;
                    case 'jiu':player.storage.墨心.jiu=true;break;
                }
            },
            },
            "moxin_sha":{
                enable:"chooseToUse",
                viewAs:{
                    name:"sha",
                    suit:"club",
                    number:5,
                },
                viewAsFilter:function (player){
                if(!player.storage.墨心) player.storage.墨心={};
                if(player.storage.墨心.sha) return false;
                var hs=player.get('he',{color:'black'});
                for(var i=0;i<hs.length;i++){
                    if(get.type(hs[i])!='basic'){
                        return true;
                    }
                }
                return false;
},
                precontent:function (){
                'step 0'
                var card=event.result.cards[0];
                event.card=card;
                player.$throw(card,1000);
                game.log(player,'将',card,'置于牌堆顶');
                event.result.cards.length=0;
                player.lose(card);
                'step 1'
                game.delay();
                'step 2'
                ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
            },
                filterCard:function (card){
                return get.type(card)!='basic'&&get.color(card)=='black';
            },
                ai:{
                    skillTagFilter:function (player,tag,arg){
                    if(arg!='use') return false;
                    if(!player.storage.墨心) player.storage.墨心={};
                    if(player.storage.墨心.sha) return false;
                    var hs=player.get('he',{color:'black'});
                    for(var i=0;i<hs.length;i++){
                        if(get.type(hs[i])!='basic'){
                            return true;
                        }
                    }
                    return false;
                },
                    order:2.9,
                    respondSha:true,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    result:{
                        target:function (player,target){
                    if(player.hasSkill('jiu')&&!target.num('e','baiyin')){
                        if(ai.get.attitude(player,target)>0){
                            return -6;
                        }
                        else{
                            return -3.05+(sgs.getDefenseSha(target,player))/30;
                        }
                    }
                    return -1.55+(sgs.getDefenseSha(target,player))/30;
                },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                        if(card.nature=='poison') return;
                        return 1;
                    },
                        natureDamage:function (card){
                        if(card.nature) return 1;
                    },
                        fireDamage:function (card,nature){
                        if(card.nature=='fire') return 1;
                    },
                        thunderDamage:function (card,nature){
                        if(card.nature=='thunder') return 1;
                    },
                        poisonDamage:function (card,nature){
                        if(card.nature=='poison') return 1;
                    },
                    },
                },
            },
            "moxin_tao":{
                enable:"chooseToUse",
                viewAs:{
                    name:"tao",
                    suit:"spade",
                    number:6,
                },
                viewAsFilter:function (player){
                if(!player.storage.墨心) player.storage.墨心={};
                if(player.storage.墨心.tao) return false;
                var hs=player.get('he',{color:'black'});
                for(var i=0;i<hs.length;i++){
                    if(get.type(hs[i])!='basic'){
                        return true;
                    }
                }
                return false;
            },
                precontent:function (){
                'step 0'
                var card=event.result.cards[0];
                event.card=card;
                player.$throw(card,1000);
                game.log(player,'将',card,'置于牌堆顶');
                event.result.cards.length=0;
                player.lose(card);
                'step 1'
                game.delay();
                'step 2'
                ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
            },
                filterCard:function (card){
                return get.type(card)!='basic'&&get.color(card)=='black';
            },
                ai:{
                    order:4,
                    skillTagFilter:function (player){
                    if(!player.storage.墨心) player.storage.墨心={};
                    if(player.storage.墨心.tao) return false;
                    var hs=player.get('he',{color:'black'});
                    for(var i=0;i<hs.length;i++){
                        if(get.type(hs[i])!='basic'){
                            return true;
                        }
                    }
                    return false;
                },
                    save:true,
                    basic:{
                        order:function (card,player){
                        if(player.hasSkillTag('pretao')) return 5;
                        return 2;
                    },
                        useful:[8,6.5],
                        value:[8,6.5],
                    },
                    result:{
                        target:function (player,target){
                        // if(player==target&&player.hp<=0) return 2;
                        var nh=target.num('h');
                        var keep=false;
                        if(nh<=target.hp){
                            keep=true;
                        }
                        else if(nh==target.hp+1&&target.hp>=2&&target.num('h','tao')<=1){
                            keep=true;
                        }
                        var mode=get.mode();
                        if(target.hp>=2&&keep&&target.hasFriend()){
                            if(target.hp>2) return 0;
                            if(target.hp==2){
                                for(var i=0;i<game.players.length;i++){
                                    if(target!=game.players[i]&&ai.get.attitude(target,game.players[i])>=3){
                                        if(game.players[i].hp<=1) return 0;
                                        if(mode=='identity'&&game.players[i].isZhu&&game.players[i].hp<=2) return 0;
                                    }
                                }
                            }
                        }
                        if(target.hp<0&&target!=player&&target.identity!='zhu') return 0;
                        var att=ai.get.attitude(player,target);
                        if(att<3&&att>=0&&player!=target) return 0;
                        var tri=_status.event.getTrigger();
                        if(mode=='identity'&&player.identity=='fan'&&target.identity=='fan'){
                            if(tri&&tri.name=='dying'&&tri.source&&tri.source.identity=='fan'&&tri.source!=target){
                                var num=0;
                                for(var i=0;i<game.players.length;i++){
                                    if(game.players[i].identity=='fan'){
                                        num+=game.players[i].num('h','tao');
                                        if(num>2) return 2;
                                    }
                                }
                                if(num>1&&player==target) return 2;
                                return 0;
                            }
                        }
                        if(mode=='identity'&&player.identity=='zhu'&&target.identity=='nei'){
                            if(tri&&tri.name=='dying'&&tri.source&&tri.source.identity=='zhong'){
                                return 0;
                            }
                        }
                        if(mode=='stone'&&target.isMin()&&
                        player!=target&&tri&&tri.name=='dying'&&player.side==target.side&&
                        tri.source!=target.getEnemy()){
                            return 0;
                        }
                        return 2;
                    },
                    },
                    tag:{
                        recover:1,
                        save:1,
                    },
                },
            },
            "moxin_jiu":{
                enable:"chooseToUse",
                viewAs:{
                    name:"jiu",
                    suit:"club",
                    number:5,
                },
                viewAsFilter:function (player){
                if(!player.storage.墨心) player.storage.墨心={};
                if(player.storage.墨心.jiu) return false;
                var hs=player.get('he',{color:'black'});
                for(var i=0;i<hs.length;i++){
                    if(get.type(hs[i])!='basic'){
                        return true;
                    }
                }
                return false;
            },
                precontent:function (){
                'step 0'
                var card=event.result.cards[0];
                event.card=card;
                player.$throw(card,1000);
                game.log(player,'将',card,'置于牌堆顶');
                event.result.cards.length=0;
                player.lose(card);
                'step 1'
                game.delay();
                'step 2'
                ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
            },
                filterCard:function (card){
                return get.type(card)!='basic'&&get.color(card)=='black';
            },
                ai:{
                    skillTagFilter:function (player){
                    if(!player.storage.墨心) player.storage.墨心={};
                    if(player.storage.墨心.jiu) return false;
                    if(player.hp>0) return false;
                    var hs=player.get('he',{color:'black'});
                    for(var i=0;i<hs.length;i++){
                        if(get.type(hs[i])!='basic'){
                            return true;
                        }
                    }
                    return false;
                },
                    save:true,
                    basic:{
                        useful:function (card,i){
                        if(_status.event.player.hp>1){
                            if(i==0) return 5;
                            return 1;
                        }
                        if(i==0) return 7.3;
                        return 3;
                    },
                        value:function (card,player){
                        if(player.hp>1){
                            if(i==0) return 5;
                            return 1;
                        }
                        if(i==0) return 7.3;
                        return 3;
                    },
                    },
                    order:function (){
                    return lib.card.sha.ai.order+0.2;
                },
                    result:{
                        target:function (player,target){
                        if(target&&target.hp<=0) return 2;
                        if(lib.config.mode=='stone'&&!player.isMin()){
                            if(player.getActCount()+1>=player.actcount) return 0;
                        }
                        var shas=player.get('h','sha');
                        if(shas.length>1){
                            if(player.num('e','zhuge')) return 0;
                            if(player.hasSkill('paoxiao')) return 0;
                            if(player.hasSkill('fengnu')) return 0;
                            if(!player.getStat().card.sha){
                                if(player.hasSkill('tanlin3')) return 0;
                                if(player.hasSkill('zhaxiang2')) return 0;
                            }
                        }
                        var card;
                        if(shas.length){
                            for(var i=0;i<shas.length;i++){
                                if(lib.filter.filterCard(shas[i],target)){
                                    card=shas[i];break;
                                }
                            }
                        }
                        if(card){
                            for(var i=0;i<game.players.length;i++){
                                if(ai.get.attitude(target,game.players[i])<0&&
                                    target.canUse(card,game.players[i],true,true)&&
                                    !game.players[i].num('e','baiyin')){
                                    if(ai.get.effect(game.players[i],card,target)>0) return 1;
                                }
                            }
                        }
                        return 0;
                    },
                    },
                    tag:{
                        save:1,
                    },
                },
            },
            "moxin_sha_old":{
                enable:"phaseUse",
                discard:false,
                prepare:"throw",
                filter:function (event,player){
                if(!player.storage.墨心) player.storage.墨心={};
                if(player.storage.墨心.sha) return false;
                if(!lib.filter.filterCard({name:'sha'},player,event)){
                    return false;
                }
                var hs=player.get('he',{color:'black'});
                for(var i=0;i<hs.length;i++){
                    if(get.type(hs[i])!='basic'){
                        break;
                    }
                }
                if(i==hs.length) return false;
                for(var i=0;i<game.players.length;i++){
                    if(player.canUse('sha',game.players[i])) return true;
                }
                return false;
            },
                position:"he",
                filterCard:function (card){
                return get.type(card)!='basic'&&get.color(card)=='black';
            },
                filterTarget:function (card,player,target){
                return player.canUse('sha',target);
            },
                check:function (card){
                return 6-ai.get.value(card);
            },
                content:function (){
                game.log(player,'将',cards,'置于牌堆顶');
                ui.cardPile.insertBefore(cards[0],ui.cardPile.firstChild);
                player.useCard({name:'sha'},targets);
            },
                ai:{
                    order:2,
                    result:{
                        target:function (player,target){
                        return ai.get.effect(target,{name:'sha'},player,target);
                    },
                    },
                },
            },
            "moxin_tao_old":{
                enable:"chooseToUse",
                discard:false,
                prepare:"throw",
                filter:function (event,player){
                if(!player.storage.墨心) player.storage.墨心={};
                if(player.storage.墨心.tao) return false;
                var hs=player.get('he',{color:'black'});
                for(var i=0;i<hs.length;i++){
                    if(get.type(hs[i])!='basic'){
                        break;
                    }
                }
                if(i==hs.length) return false;
                if(event.type=='dying'){
                    return event.filterCard({name:'tao'},player);
                }
                if(event.getParent().name!='phaseUse') return false;
                if(!lib.filter.filterCard({name:'tao'},player,event)){
                    return false;
                }
                return player.hp<player.maxHp;
            },
                position:"he",
                filterCard:function (card){
                return get.type(card)!='basic'&&get.color(card)=='black';
            },
                filterTarget:function (card,player,target){
                if(_status.event.type=='dying'){
                    return target==_status.event.dying;
                }
                return player==target;
            },
                selectTarget:-1,
                check:function (card){
                return 8-ai.get.value(card);
            },
                content:function (){
                game.log(player,'将',cards,'置于牌堆顶');
                ui.cardPile.insertBefore(cards[0],ui.cardPile.firstChild);
                player.useCard({name:'tao'},targets).delayx=false;
            },
                ai:{
                    skillTagFilter:function (player){
                    if(!player.storage.墨心) player.storage.墨心={};
                    if(player.storage.墨心.tao) return false;
                    var hs=player.get('he',{color:'black'});
                    for(var i=0;i<hs.length;i++){
                        if(get.type(hs[i])!='basic'){
                            return true;
                        }
                    }
                    return false;
                },
                    threaten:1.5,
                    save:true,
                    order:9,
                    result:{
                        target:function (player,target){
                        return ai.get.effect(target,{name:'tao'},player,target);
                    },
                    },
                },
            },
            "moxin_jiu_old":{
                enable:"chooseToUse",
                discard:false,
                prepare:"throw",
                filter:function (event,player){
                if(!lib.filter.filterCard({name:'jiu'},player,event)){
                    return false;
                }
                if(player.storage.墨心.jiu) return false;
                var hs=player.get('he',{color:'black'});
                for(var i=0;i<hs.length;i++){
                    if(get.type(hs[i])!='basic'){
                        break;
                    }
                }
                if(i==hs.length) return false;
                if(event.type=='dying'){
                    return event.filterCard({name:'jiu'},player);
                }
                if(event.getParent().name!='phaseUse') return false;
                return true;
            },
                position:"he",
                filterCard:function (card){
                return get.type(card)!='basic'&&get.color(card)=='black';
            },
                filterTarget:function (card,player,target){
                if(_status.event.type=='dying'){
                    return target==_status.event.dying;
                }
                return player==target;
            },
                selectTarget:-1,
                check:function (card){
                if(_status.event.type=='dying'){
                    return 8-ai.get.value(card);
                }
                return 6-ai.get.value(card);
            },
                content:function (){
                game.log(player,'将',cards,'置于牌堆顶');
                ui.cardPile.insertBefore(cards[0],ui.cardPile.firstChild);
                player.useCard({name:'jiu'},targets).delayx=false;
            },
                ai:{
                    save:true,
                    skillTagFilter:function (player){
                    if(!player.storage.墨心) player.storage.墨心={};
                    if(player.storage.墨心.jiu) return false;
                    if(player.hp>0) return false;
                    var hs=player.get('he',{color:'black'});
                    for(var i=0;i<hs.length;i++){
                        if(get.type(hs[i])!='basic'){
                            return true;
                        }
                    }
                    return false;
                },
                    order:function (){
                    return lib.card.sha.ai.order+0.2;
                },
                    result:{
                        target:function (player,target){
                        return ai.get.effect(target,{name:'jiu'},player,target);
                    },
                    },
                },
            },
            "辅佐":{
                audio:["辅佐",2],
                trigger:{
                    global:"useCardEnd",
                },
                filter:function (event){
        return get.color(event.card)=='black';
    },
                content:function (){        
        player.recover();
        player.draw();
        player.turnOver();
    },
                ai:{
                    expose:0.2,
                },
            },
            "诏书":{
                enable:"phaseUse",
                usable:5,
                audio:["诏书",2],
                check:function (card){
        return 8-ai.get.value(card);
    },
                filterCard:true,
                discard:false,
                lose:false,
                content:function (){
        'step 0'
        player.showCards(cards);
        'step 1'
        if(player.storage.zhaoshu2){
            event.target=player;
        }
        else{
            var targets=game.players.slice(0);
            targets.remove(player);
            targets.sort(function(a,b){
                return Math.max(1,get.distance(player,a))-Math.max(1,get.distance(player,b));
            });
            var distance=Math.max(1,get.distance(player,targets[0]));
            for(var i=1;i<targets.length;i++){
                if(Math.max(1,get.distance(player,targets[i]))>distance){
                    targets.splice(i);break;
                }
            }
            player.chooseTarget(true,function(card,player,target){
                return _status.event.targets.contains(target);
            }).set('ai',function(target){
                return ai.get.attitude(_status.event.player,target);
            }).set('targets',targets);
        }
        'step 2'
        if(!event.target){
            event.target=result.targets[0];
            player.line(result.targets,'green');
        }
        if(!event.target){
            event.finish();
            return;
        }
        var list=['sha','shan','tao','jiu','huosha','leisha'];
        if(player.storage.zhaoshu1){            list=list.concat(['taoyuan','wugu','juedou','huogong','jiedao','tiesuo','guohe','shunshou','wanjian','nanman','bingliang','lebu']);
        }
        for(var i=0;i<list.length;i++){
            if(i<=4){
                list[i]=['基本','',list[i]];
            }
            else{
                list[i]=['锦囊','',list[i]];
            }
        }
        var att=ai.get.attitude(event.target,player);
        event.target.chooseButton(['诏书',[list,'vcard']],true).set('ai',function(button){
            var att=_status.event.att;
            if(att<=0){
                return button.link=='shan'?1:0;
            }
            else{
                if(!_status.event.trick){
                    return button.link=='sha'?1:0;
                }
                var player=_status.event.player;
                var recover=0,lose=1;
                for(var i=0;i<game.players.length;i++){
                    if(!game.players[i].isOut()&&game.players[i]!=player){
                        if(game.players[i].hp<game.players[i].maxHp){
                            if(ai.get.attitude(player,game.players[i])>0){
                                if(game.players[i].hp<2){
                                    lose--;
                                    recover+=0.5;
                                }
                                lose--;
                                recover++;
                            }
                            else if(ai.get.attitude(player,game.players[i])<0){
                                if(game.players[i].hp<2){
                                    lose++;
                                    recover-=0.5;
                                }
                                lose++;
                                recover--;
                            }
                        }
                        else{
                            if(ai.get.attitude(player,game.players[i])>0){
                                lose--;
                            }
                            else if(ai.get.attitude(player,game.players[i])<0){
                                lose++;
                            }
                        }
                    }
                }
                if(lose>recover&&lose>0) return (button.link[2]=='nanman')?1:-1;
                if(lose<recover&&recover>0) return (button.link[2]=='taoyuan')?1:-1;
                return (button.link[2]=='shunshou')?1:-1;
            }
        }).set('att',att).set('trick',player.storage.zhaoshu1);
        'step 3'
        event.target.showCards(game.createCard(result.links[0]),get.translation(event.target)+'声明了'+get.translation(result.links[0][2]));
        player.storage.诏书=cards[0];
        player.storage.zhaoshu_card=result.links[0][2];
        game.broadcastAll(function(name){
            lib.skill.zhaoshu2.viewAs={name:name};
        },result.links[0][2]);
    },
                ai:{
                    order:9,
                    result:{
                        player:1,
                    },
                },
                intro:{
                    content:function (storage,player){
            if(player.storage.zhaoshu2){
                return '出牌阶段，你可以展示一张手牌，然后你声明一张基本牌或锦囊牌的牌名。在此出牌阶段内，你可以将此手牌当声明的牌使用且你不能被选择为目标';
            }
            else{
                return '出牌阶段，你可以展示一张手牌，然后选择距离最近的一名其他角色，该角色声明一张基本牌或锦囊牌的牌名。在此出牌阶段内，你可以将此手牌当声明的牌使用且你不能被选择为目标';
            }
        },
                },
                group:["zhaoshu2","zhaoshu3"],
            },
            "zhaoshu2":{
                enable:"phaseUse",
                usable:5,
                audio:["诏书",2],
                filter:function (event,player){
        if(!player.storage.诏书) return false;
        var name=player.storage.zhaoshu_card;
        if(name=='tao'||name=='shan'||name=='wuzhong'||name=='jiu'||name=='shandian') return false;
        return player.get('h').contains(player.storage.诏书);
    },
                filterCard:function (card,player){
        return card==player.storage.诏书;
    },
                selectCard:-1,
                popname:true,
                filterTarget:function (card,player,target){
        if(player==target) return false;
        return lib.filter.filterTarget({name:player.storage.zhaoshu_card},player,target);
    },
                check:function (card){
        return 8-ai.get.value(card);
    },
                ai:{
                    order:6,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                        order:9,
                    },
                    result:{
                        target:function (player,target){
                if(player.hasSkill('jiu')&&!target.num('e','baiyin')){
                    if(ai.get.attitude(player,target)>0){
                        return -6;
                    }
                    else{
                        return -3.05+(sgs.getDefenseSha(target,player))/30;
                    }
                }
                return -1.55+(sgs.getDefenseSha(target,player))/30;
            },
                        player:function (player,target){
                if(ai.get.damageEffect(target,player,target)>0&&ai.get.attitude(player,target)>0&&ai.get.attitude(target,player)>0){
                    return 0;
                }
                var hs1=target.get('h','sha');
                var hs2=player.get('h','sha');
                if(hs1.length>hs2.length+1){
                    return -2;
                }
                var hsx=target.get('h');
                if(hsx.length>2&&hs2.length==0&&hsx[0].number<6){
                    return -2;
                }
                if(hsx.length>3&&hs2.length==0){
                    return -2;
                }
                if(hs1.length>hs2.length&&(!hs2.length||hs1[0].number>hs2[0].number)){
                    return -2;
                }
                return -0.5;
            },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                if(card.nature=='poison') return;
                return 1;
            },
                        natureDamage:function (card){
                if(card.nature) return 1;
            },
                        fireDamage:function (card,nature){
                if(card.nature=='fire') return 1;
            },
                        thunderDamage:function (card,nature){
                if(card.nature=='thunder') return 1;
            },
                        poisonDamage:function (card,nature){
                if(card.nature=='poison') return 1;
            },
                        respondSha:1,
                        multitarget:1,
                        multineg:1,
                    },
                    wuxie:function (target,card,player,viewer){
            if(ai.get.attitude(viewer,target)>0&&target.num('h','sha')){
                if(!target.num('h')||target.hp==1||Math.random()<0.7) return 0;
            }
        },
                },
                viewAs:{
                    name:"nanman",
                    suit:"diamond",
                    number:9,
                    cards:[{"node":{"image":{},"info":{},"name":{},"name2":{},"background":{},"intro":{},"range":{}},"storage":{"uncheck":[]},"suit":"diamond","number":9,"name":"du","clone":{"name":"du","suit":"diamond","number":9,"node":{"name":{},"info":{},"intro":{},"background":{},"image":{}},"_transitionEnded":true,"timeout":885},"timeout":812,"original":"h"}],
                },
            },
            "zhaoshu3":{
                trigger:{
                    player:"phaseEnd",
                },
                forced:true,
                popup:false,
                content:function (){
        delete player.storage.诏书;
        delete player.storage.zhaoshu_card;
    },
            },
            "禅心":{
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                frequent:true,
                audio:["禅心",2],
                content:function (){
        'step 0'
        if(player.storage.zhaoshu1&&player.storage.zhaoshu2){
            player.draw();
            player.recover();
            event.finish();
        }
        else{
            var list=['draw_card','更改描述'];
            var prompt;
            if(player.storage.zhaoshu1){
                prompt='摸一张牌或更改矫诏的描述<br><br><div class="text">更改描述：将“选择距离最近的一名其他角色，该角色”改为“你”';
            }
            else{
                prompt='摸一张牌或更改矫诏的描述<br><br><div class="text">更改描述：将“基本牌”改为“基本牌或锦囊牌”';
            }
            player.chooseControl(list,function(){
                if(!_status.event.player.hasSkill('诏书')) return 'draw_card';
                return '更改描述';
            }).set('prompt',prompt);
        }
        'step 1'
        if(result.control=='draw_card'){
            player.draw();
            player.recover();
        }
        else{
            game.log(player,'更改了','【诏书】','的描述');
            player.popup('更改描述');
            player.markSkill('诏书');
            if(player.storage.zhaoshu1){
                player.storage.zhaoshu2=true;
            }
            else{
                player.storage.zhaoshu1=true;
            }
        }
    },
            },
            "pilang2":{
                audio:["劈浪",2],
                trigger:{
                    player:"damageEnd",
                },
                content:function (){
        player.draw();
        player.gainMaxHp();
    },
            },
            "劈浪":{
                audio:["劈浪",2],
                trigger:{
                    player:"phaseDrawBegin",
                },
                frequent:true,
                content:function (){
        trigger.num+=(player.maxHp-player.hp);
    },
                group:["pilang2"],
            },
            "雄才":{
                audio:["雄才",2],
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                priority:5,
                filter:function (event,player){
if(event.player==player&&!event.player.skills) return false;
return true;
},
                forced:true,
                direct:true,
                content:function (){
        "step 0"
        if(get.itemtype(trigger.cards)=='cards'&&get.position(trigger.cards[0])=='d'){
            player.chooseControl('摸一张牌回复2点体力','获得本次造成伤害的牌并增加1点体力上限','cancel2').ai=function(){
                var trigger=_status.event.getTrigger();
                if(trigger.cards.length==1&&trigger.cards[0].name=='sha') return 0;
                return 1;
            };
        }
        else{
            player.chooseControl('摸一张牌回复1点体力','cancel2');
        }
        "step 1"
        if(result.control=='获得本次造成伤害的牌并增加1点体力上限'){
            player.logSkill('雄才');
            player.gain(trigger.cards);
            player.$gain2(trigger.cards);
            player.gainMaxhp();
        }
        else if(result.control=='摸一张牌回复2点体力'){
            player.logSkill('雄才');
            player.draw();
            player.recover(2)._triggered=null;
        }
    },
                ai:{
                    maixie:true,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')&&player!=target) return [1,1];
            },
                    },
                },
            },
            "护主":{
                audio:["护主",2],
                unique:true,
                zhuSkill:true,
                trigger:{
                    player:"chooseToRespondBegin",
                },
                filter:function (event,player){
        if(event.responded) return false;
        if(player.storage.护主) return false;
        if(!player.hasZhuSkill('hujia')) return false;
        if(event.filterCard({name:'shan'})==false) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i]!=player&&game.players[i].group=='wei') return true;
        }
        return false;
    },
                check:function (event,player){
        if(ai.get.damageEffect(player,event.player,player)>=0) return false;
        return true;
    },
                content:function (){
        "step 0"
        if(event.current==undefined) event.current=player.next;
        if(event.current==player){
            event.finish();
        }
        else if(event.current.group=='wei'){
            if((event.current==game.me&&!_status.auto)||(
                ai.get.attitude(event.current,player)>2)||
                event.current.isOnline()){
                player.storage.护主=true;
                var next=event.current.chooseToRespond('是否替'+get.translation(player)+'打出一张闪？',{name:'shan'});
                next.set('ai',function(){
                    var event=_status.event;
                    return (ai.get.attitude(event.player,event.source)-2);
                });
                next.autochoose=lib.filter.autoRespondShan;
                next.set('source',player);
            }
        }
        "step 1"
        player.storage.护主=false;
        if(result.bool){
            event.finish();
            trigger.result=result;
            trigger.responded=true;
            trigger.animate=false;
            if(typeof event.current.ai.shown=='number'&&event.current.ai.shown<0.95){
                event.current.ai.shown+=0.3;
                if(event.current.ai.shown>0.95) event.current.ai.shown=0.95;
            }
        }
        else{
            event.current=event.current.next;
            event.goto(0);
        }
    },
            },
            "料敌":{
                audio:["料敌",2],
                trigger:{
                    player:["damageEnd","loseHpEnd","loseMaxHpEnd"],
                },
                direct:true,
                filter:function (event,player){
        return (event.source&&event.source.num('he'));
    },
                content:function (){
        "step 0"
        event.num=trigger.num;
        "step 1"
        if(num==0||trigger.source.num('he')==0){
            event.finish();
            return;
        }
        event.num--;
        player.choosePlayerCard(get.prompt('料敌',trigger.source),trigger.source,ai.get.buttonValue,'he');
        "step 2"
        if(result.bool){
            player.logSkill('料敌',trigger.source);
            player.gain(result.links[0],trigger.source);
            trigger.source.$give(player);
            trigger.source.damage(2)._triggered=null;
            event.goto(1);
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(player.num('he')>1&&get.tag(card,'damage')){
                    if(player.hasSkill('jueqing')) return [1,-1.5];
                    if(ai.get.attitude(target,player)<0) return [1,1];
                }
            },
                    },
                },
            },
            "谋士":{
                audio:["谋士",2],
                trigger:{
                    global:"judge",
                },
                direct:true,
                filter:function (event,player){
        return player.num('he')>0;
    },
                content:function (){
        "step 0"
        player.recover();
        player.chooseCard(get.translation(trigger.player)+'的'+(trigger.judgestr||'')+'判定为'+
        get.translation(trigger.player.judging[0])+'，'+get.prompt('谋士'),'he').set('ai',function(card){
            var trigger=_status.event.getTrigger();
            var player=_status.event.player;
            var judging=_status.event.judging;
            var result=trigger.judge(card)-trigger.judge(judging);
            var attitude=ai.get.attitude(player,trigger.player);
            if(attitude==0||result==0) return 0;
            if(attitude>0){
                return result-ai.get.value(card)/2;
            }
            else{
                return -result-ai.get.value(card)/2;
            }
        }).set('judging',trigger.player.judging[0]);
        "step 1"
        if(result.bool){
            player.respond(result.cards,'highlight');
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            player.logSkill('谋士');
            if(trigger.player.judging[0].clone){
                trigger.player.judging[0].clone.classList.remove('thrownhighlight');
                game.broadcast(function(card){
                    if(card.clone){
                        card.clone.classList.remove('thrownhighlight');
                    }
                },trigger.player.judging[0]);
                game.addVideo('deletenode',player,get.cardsInfo([trigger.player.judging[0].clone]));
            }
            ui.discardPile.appendChild(trigger.player.judging[0]);
            trigger.player.judging[0]=result.cards[0];
            if(!get.owner(result.cards[0],'judge')){
                trigger.position.appendChild(result.cards[0]);
            }
            game.log(trigger.player,'的判定牌改为',result.cards[0]);
            game.delay(2);
        }
    },
                ai:{
                    tag:{
                        rejudge:1,
                    },
                },
            },
            "獠牙":{
                audio:["獠牙",2],
                trigger:{
                    player:["phaseEnd","phaseBegin"],
                },
                direct:true,
                content:function (){
        "step 0"
        player.chooseTarget([1,5],get.prompt('獠牙'),[1,2,3,4,5],function(card,player,target){
            return target.num('he')>0&&player!=target&&target.num('he')!=player.num('he');
        },function(target){
            var att=ai.get.attitude(_status.event.player,target);
            if(target.hasSkill('tuntian')) return att/10;
            return 1-att;
        });
        "step 1"
        if(result.bool){
            player.logSkill('獠牙',result.targets);
            for(var i=0;i<result.targets.length;i++){
                player.gain([1,5],result.targets[i].get('he').randomGet(),result.targets[i]);
                result.targets[i].$give([1,5],player);
            }
            trigger.num-=result.targets.length
        }
    },
                ai:{
                    threaten:1.6,
                    expose:0.2,
                },
            },
            "偷营":{
                mod:{
                    targetEnabled:function (card,player,target,now){
            if(card.name=='bingliang'||card.name=='lebu'||card.name=='shandian') return false;
        },
                },
            },
            "虎痴":{
                audio:["虎痴",2],
                trigger:{
                    player:"phaseDrawBegin",
                },
                check:function (event,player){
        if(player.num('h','sha')) return true;
        return Math.random()<0.5;
    },
                content:function (){
        "step 0"
        player.addTempSkill('huchi2',{player:'phaseBefore'});
        trigger.untrigger();
        trigger.finish();
        "step 1"
        event.cards=get.cards(10);
        player.showCards(event.cards,'虎痴');
        "step 2"
        for(var i=0;i<cards.length;i++){
            if(get.type(cards[i],'trick')=='trick'&&cards[i].name!='juedou'){
                ui.discardPile.appendChild(cards[i]);
                cards.splice(i,1);i--;
            }
            else if(get.type(cards[i])=='equip'&&get.subtype(cards[i])!='equip1'){
                ui.discardPile.appendChild(cards[i]);
                cards.splice(i,1);i--;
            }
        }
        player.gain(cards,'gain2');
    },
            },
            "huchi2":{
                trigger:{
                    source:"damageBegin",
                },
                filter:function (event){
        return event.card&&(event.card.name=='sha'||event.card.name=='juedou')&&event.notLink();
    },
                forced:true,
                content:function (){
        trigger.num+=2;
    },
            },
            "狂拳":{
                mod:{
                    targetEnabled:function (card,player,target,now){
            if(card.name=='bingliang'||card.name=='lebu'||card.name=='shandian'||card.name=='guohe') return false;
        },
                },
            },
            "惊天":{
                audio:["惊天",2],
                trigger:{
                    player:"judgeEnd",
                },
                frequent:true,
                filter:function (event,player){
        if(get.owner(event.result.card)){
            return false;
        }
        if(event.nogain&&event.nogain(event.result.card)){
            return false;
        }
        return true;
    },
                content:function (){
        player.gain(trigger.result.card);
        player.$gain2(trigger.result.card);
        player.draw(get.cards(player.maxHp-player.hp));
        player.addTempSkill('jingtian2','phaseAfter');
        player.recover(999);
    },
            },
            "jingtian2":{
                trigger:{
                    player:"phaseDiscardBefore",
                },
                forced:true,
                content:function (){
    trigger.untrigger();
    trigger.finish();
},
            },
            "遗策":{
                audio:["遗策",2],
                group:"yice3",
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                frequent:true,
                filter:function (event){
        return (event.num>0)
    },
                content:function (){
        "step 0"
        event.num=1;
        event.count=1;
        "step 1"
        player.gain(get.cards(player.maxHp-player.hp));
        player.$draw(player.MaxHp-player.Hp);
        "step 2"
        player.chooseCardTarget({
            filterCard:true,
            selectCard:[1,2],
            filterTarget:function(card,player,target){
                return player!=target&&target!=event.temp;
            },
            ai1:function(card){
                if(ui.selected.cards.length>0) return -1;
                if(card.name=='du') return 20;
                return (_status.event.player.num('h')-_status.event.player.hp);
            },
            ai2:function(target){
                var att=ai.get.attitude(_status.event.player,target);
                if(ui.selected.cards.length&&ui.selected.cards[0].name=='du'){
                    return 1-att;
                }
                return att-4;
            },
            prompt:'请选择要送人的卡牌'
        });
        "step 3"
        if(result.bool){
            player.lose(result.cards,ui.special);
            if(result.targets[0].hasSkill('yice2')){
                result.targets[0].storage.yice2=result.targets[0].storage.yice2.concat(result.cards);
            }
            else{
                result.targets[0].addSkill('yice2');
                result.targets[0].storage.yice2=result.cards;
            }
            player.$give(result.cards.length,result.targets[0]);
            player.line(result.targets,'green');
            game.addVideo('storage',result.targets[0],['yice2',get.cardsInfo(result.targets[0].storage.yice2),'cards']);
            if(num==1){
                event.temp=result.targets[0];
                event.num++;
                event.goto(2);
            }
            else if(event.count<trigger.num){
                delete event.temp;
                event.num=1;
                event.count++;
                event.goto(1);
            }
        }
        else if(event.count<trigger.num){
            delete event.temp;
            event.num=1;
            event.count++;
            event.goto(1);
        }
    },
                ai:{
                    maixie:true,
                    result:{
                        effect:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(player.hasSkill('jueqing')) return [1,-2];
                    if(player.hp>=4) return [1,get.tag(card,'damage')*2];
                    if(target.hp==3) return [1,get.tag(card,'damage')*1.5];
                    if(target.hp==2) return [1,get.tag(card,'damage')*0.5];
                }
            },
                    },
                    threaten:0.6,
                },
            },
            "yice2":{
                trigger:{
                    player:"phaseDrawBegin",
                },
                forced:true,
                mark:true,
                popup:"遗策拿牌",
                content:function (){
        player.$draw(player.storage.yice2.length);
        player.gain(player.storage.yice2);
        delete player.storage.yice2;
        player.removeSkill('yice2');
        game.delay();
    },
                intro:{
                    content:"cardCount",
                },
            },
            "yice3":{
                trigger:{
                    player:"damageBegin",
                },
                forced:true,
                priority:-500,
                content:function (){
    if(trigger.num>1) trigger.num=1
},
            },
            "厚兵":{
                audio:["厚兵",2],
                trigger:{
                    player:"phaseDrawBefore",
                },
                direct:true,
                content:function (){
        "step 0"
        event.cards=get.cards(5);
        player.chooseCardButton(event.cards,3,'选择获得三张牌').set('ai',ai.get.buttonValue);
        "step 1"
        if(result.bool){
            player.logSkill('厚兵');
            trigger.untrigger();
            trigger.finish();
            var choice=[];
            for(var i=0;i<result.links.length;i++){
                choice.push(result.links[i]);
                cards.remove(result.links[i]);
            }
            for(var i=0;i<cards.length;i++){
                ui.cardPile.appendChild(cards[i]);
            }
            player.gain(choice,'draw');
            game.log(player,'获得了三张牌')
        }
    },
            },
            "破虏":{
                audio:["破虏",2],
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                    source:"damageEnd",
                },
                filter:function (event){
        return event.num&&event.source&&event.player&&
        event.player.isAlive()&&event.source.isAlive()&&event.source!=event.player;
    },
                check:function (event,player){
        if(event.player==player) return ai.get.attitude(player,event.source)>-3;
        return ai.get.attitude(player,event.player)>-3;
    },
                content:function (){
        "step 0"
        game.asyncDraw([trigger.player,trigger.source],trigger.num);
        player.recover(trigger.num);
        player.addTempSkill(trigger.source.skills.randomGet())
        player.addTempSkill(trigger.player.skills.randomGet())
        "step 1"
        game.delay();
    },
            },
            "gui1":{
                audio:["鬼雄",2],
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                content:function (){
        player.draw();
        player.recover();
        player.gainMaxHp();
    },
                ai:{
                    maixie:true,
                    effect:{
                        target:function (card,player){
                if(player.hasSkill('jueqing')) return [1,-1];
                if(get.tag(card,'damage')) return [1,0.5];
            },
                    },
                },
                check:function (event,player){
        return !sgs.needKongcheng(player,true);
    },
            },
            "护驾":{
                audio:["护驾",2],
                unique:true,
                zhuSkill:true,
                trigger:{
                    player:"chooseToRespondBegin",
                },
                filter:function (event,player){
        if(event.responded) return false;
        if(player.storage.护驾) return false;
        if(!player.hasZhuSkill('hujia')) return false;
        if(event.filterCard({name:'shan'})==false) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i]!=player&&game.players[i].group=='wei') return true;
        }
        return false;
    },
                check:function (event,player){
        if(ai.get.damageEffect(player,event.player,player)>=0) return false;
        return true;
    },
                content:function (){
        "step 0"
        if(event.current==undefined) event.current=player.next;
        if(event.current==player){
            event.finish();
        }
        else if(event.current.group=='wei'){
            if((event.current==game.me&&!_status.auto)||(
                ai.get.attitude(event.current,player)>2)||
                event.current.isOnline()){
                player.storage.护驾=true;
                var next=event.current.chooseToRespond('是否替'+get.translation(player)+'打出一张闪？',{name:'shan'});
                next.set('ai',function(){
                    var event=_status.event;
                    return (ai.get.attitude(event.player,event.source)-2);
                });
                next.autochoose=lib.filter.autoRespondShan;
                next.set('source',player);
            }
        }
        "step 1"
        player.storage.护驾=false;
        if(result.bool){
            event.finish();
            trigger.result=result;
            trigger.responded=true;
            trigger.animate=false;
            if(typeof event.current.ai.shown=='number'&&event.current.ai.shown<0.95){
                event.current.ai.shown+=0.3;
                if(event.current.ai.shown>0.95) event.current.ai.shown=0.95;
            }
        }
        else{
            event.current=event.current.next;
            event.goto(0);
        }
    },
            },
            fangu:{
                audio:["反骨",2],
                group:"fangu2",
                trigger:{
                    source:"damageEnd",
                },
                forced:true,
                content:function (){
        player.recover(trigger.num);
        player.draw(trigger.num);
    },
            },
            "善谋":{
                audio:["善谋",2],
                unique:true,
                enable:"phaseUse",
                filter:function (event,player){
        return !player.storage.善谋;
    },
                init:function (player){
        player.storage.善谋=false;
    },
                mark:true,
                intro:{
                    content:"limited",
                },
                skillAnimation:"legend",
                animationColor:"metal",
                content:function (){
        'step 0'
        var shas=player.get('h','sha');
        var num;
        if(player.hp>=4&&shas.length>=3){
            num=3;
        }
        else if(player.hp>=3&&shas.length>=2){
            num=2;
        }
        else{
            num=1
        }
        player.awakenSkill('善谋');
        player.storage.善谋=true;
        player.chooseControl('一','二','三','四','五','六','七','八','九',function(){
            return get.cnNumber(_status.event.goon,true);
        }).set('prompt','失去任意点体力').set('goon',num);
        'step 1'
        var num;
        switch(result.control){
            case '一':num=1;break;
            case '二':num=2;break;
            case '三':num=3;break;
            case '四':num=4;break;
            case '五':num=5;break;
            case '六':num=6;break;
            case '七':num=7;break;
            case '八':num=8;break;
            case '九':num=9;break;
        }
        player.storage.shanmou2=num;
        player.loseHp(num);
        player.addTempSkill('shanmou2','phaseAfter');
    },
                ai:{
                    order:2,
                    result:{
                        player:function (player){
                if(player.hp==1) return 0;
                var shas=player.get('h','sha');
                if(!shas.length) return 0;
                var card=shas[0];
                if(!lib.filter.cardEnabled(card,player)) return 0;
                if(lib.filter.cardUsable(card,player)) return 0;
                var mindist;
                if(player.hp>=4&&shas.length>=3){
                    mindist=4;
                }
                else if(player.hp>=3&&shas.length>=2){
                    mindist=3;
                }
                else{
                    mindist=2;
                }
                for(var i=0;i<game.players.length;i++){
                    if(game.players[i].hp<=mindist-1&&
                    get.distance(player,game.players[i],'attack')<=mindist&&
                    player.canUse(card,game.players[i],false)&&
                    ai.get.effect(game.players[i],card,player,player)>0){
                        return 1;
                    }
                }
                return 0;
            },
                    },
                },
            },
            "shanmou2":{
                onremove:function (player){
                delete player.storage.shanmou2;
            },
                mod:{
                    cardUsable:function (card,player,num){
                    if(typeof player.storage.shanmou2=='number'&&card.name=='sha'){
                        return num+player.storage.shanmou2;
                    }
                },
                    globalFrom:function (from,to,distance){
                    if(typeof from.storage.shanmou2=='number'){
                        return distance-from.storage.shanmou2;
                    }
                },
                },
            },
            "fangu2":{
                trigger:{
                    source:"recoverBefore",
                },
                forced:true,
                content:function (){
trigger.num++
},
            },
            "xingchen7":{
                trigger:{
                    player:"loseEnd",
                },
                frequent:true,
                filter:function (event,player){
        if(player.num('h')) return false;
        for(var i=0;i<event.cards.length;i++){
            if(event.cards[i].original=='h') return true;
        }
        return false;
    },
                content:function (){
        var num=player.maxHp;
        if(num>0){
            player.draw(num);
        }
    },
                ai:{
                    threaten:0.8,
                    effect:{
                        target:function (card){
                if(card.name=='guohe'||card.name=='liuxinghuoyu') return 0.5;
            },
                    },
                    noh:true,
                    skillTagFilter:function (player,tag){
            if(tag=='noh'){
                if(player.num('h')!=1) return false;
            }
        },
                },
            },
            "病疾":{
                audio:["病疾",2],
                enable:"phaseUse",
                usable:1,
                position:"he",
                filterCard:true,
                selectCard:function (){
        var player=_status.event.player;
        var num=0;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].hp<game.players[i].maxHp){
                num++;
            }
        }
        return [1,Math.min(num,player.maxHp-player.hp)];
    },
                filterTarget:function (card,player,target){
        return target.hp<target.maxHp;
    },
                filter:function (event,player){
        return player.hp<player.maxHp;
    },
                selectTarget:function (){
        return ui.selected.cards.length;
    },
                check:function (card){
        if(get.color(card)=='black') return -1;
        return 9-ai.get.value(card);
    },
                content:function (){
        "step 0"
        target.recover();
        target.draw();
        "step 1"
        if(target==player){
            for(var i=0;i<cards.length;i++){
                if(get.color(cards[i])=='black'){
                    player.gainMaxHp();
                    player.draw(2);
                    break;
                }
            }
        }
    },
                ai:{
                    result:{
                        target:1,
                    },
                    order:6,
                },
            },
            "兵谋":{
                audio:["兵谋",2],
                trigger:{
                    global:"discardAfter",
                },
                filter:function (event){
        if(_status.currentPhase!=event.player){
            for(var i=0;i<event.cards.length;i++){
                if(event.cards[i].original=='h') return true;
            }
        }
        return false;
    },
                check:function (event,player){
        return ai.get.attitude(player,event.player)>2;
    },
                content:function (){
        "step 0"
        player.line(trigger.player,'green');
        "step 1"
        trigger.player.draw(2);
        trigger.player.gainMaxHp();
    },
            },
            "烈帝":{
                audio:["烈帝",2],
                group:["liedi1"],
                enable:"phaseUse",
                usable:10,
                filterCard:true,
                selectCard:[1,null],
                discard:false,
                prepare:"give",
                filterTarget:function (card,player,target){
        return player!=target;
    },
                check:function (card){
        if(ui.selected.cards.length>1) return 0;
        if(ui.selected.cards.length&&ui.selected.cards[0].name=='du') return 0;
        if(!ui.selected.cards.length&&card.name=='du') return 20;
        var player=get.owner(card);
        if(player.hp==player.maxHp||player.storage.rende<0||player.num('h')<=1){
            if(ui.selected.cards.length){
                return -1;
            }
            for(var i=0;i<game.players.length;i++){
                if(game.players[i].get('s').contains('haoshi')&&
                    !game.players[i].isTurnedOver()&&
                    !game.players[i].num('j','lebu')&&
                    ai.get.attitude(player,game.players[i])>=3&&
                    ai.get.attitude(game.players[i],player)>=3){
                    return 11-ai.get.value(card);
                }
            }
            if(player.num('h')>player.hp) return 10-ai.get.value(card);
            if(player.num('h')>2) return 6-ai.get.value(card);
            return -1;
        }
        return 10-ai.get.value(card);
    },
                content:function (){
        target.gain(cards,player);
        if(typeof player.storage.烈帝!='number'){
            player.storage.烈帝=0;
        }
        if(player.storage.烈帝>=0){
            player.storage.烈帝+=cards.length;
            if(player.storage.烈帝>=2){
                player.recover();
                player.draw();
            }
        }
    },
                ai:{
                    order:function (skill,player){
            if(player.hp<player.maxHp&&player.storage.rende<2&&player.num('h')>1){
                return 10;
            }
            return 1;
        },
                    result:{
                        target:function (player,target){
                if(ui.selected.cards.length&&ui.selected.cards[0].name=='du'){
                    return -10;
                }
                if(target.num('j','lebu')) return 0;
                var nh=target.num('h');
                var np=player.num('h');
                if(player.hp==player.maxHp||player.storage.rende<0||player.num('h')<=1){
                    if(nh>=np-1&&np<=player.hp&&!target.get('s').contains('haoshi')) return 0;
                }
                return Math.max(1,5-nh);
            },
                    },
                    effect:{
                        target:function (card,player,target){
                if(player==target&&get.type(card)=='equip'){
                    if(player.num('e',{subtype:get.subtype(card)})){
                        for(var i=0;i<game.players.length;i++){
                            if(game.players[i]!=player&&ai.get.attitude(player,game.players[i])>0){
                                return 0;
                            }
                        }
                    }
                }
            },
                    },
                    threaten:0.8,
                },
            },
            "liedi1":{
                trigger:{
                    player:"phaseUseBegin",
                },
                forced:true,
                popup:false,
                silent:true,
                content:function (){
                player.storage.烈帝=0;
            },
            },
            "亲征":{
                unique:true,
                group:["qinzheng1","qinzheng2"],
                zhuSkill:true,
            },
            "qinzheng1":{
                audio:["亲征",2],
                audioname:["liushan"],
                trigger:{
                    player:"chooseToRespondBegin",
                },
                filter:function (event,player){
                if(event.responded) return false;
                if(player.storage.亲征ing) return false;
                if(!player.hasZhuSkill('亲征')) return false;
                if(event.filterCard({name:'sha'},player,event)==false) return false;
                for(var i=0;i<game.players.length;i++){
                    if(game.players[i]!=player&&game.players[i].group=='shu') return true;
                }
                return false;
            },
                content:function (){
                "step 0"
                if(event.current==undefined) event.current=player.next;
                if(event.current==player){
                    event.finish();
                }
                else if(event.current.group=='shu'){
                    player.storage.亲征ing=true;
                    var next=event.current.chooseToRespond('是否替'+get.translation(player)+'打出一张杀？',{name:'sha'});
                    next.set('ai',function(){
                        var event=_status.event;
                        return (ai.get.attitude(event.player,event.source)-2);
                    });
                    next.set('source',player);
                    next.autochoose=lib.filter.autoRespondSha;
                }
                else{
                    event.current=event.current.next;
                    event.redo();
                }
                "step 1"
                player.storage.亲征ing=false;
                if(result.bool){
                    event.finish();
                    trigger.result=result;
                    trigger.responded=true;
                    trigger.animate=false;
                    if(typeof event.current.ai.shown=='number'&&event.current.ai.shown<0.95){
                        event.current.ai.shown+=0.3;
                        if(event.current.ai.shown>0.95) event.current.ai.shown=0.95;
                    }
                }
                else{
                    event.current=event.current.next;
                    event.goto(0);
                }
            },
            },
            "qinzheng2":{
                audio:["亲征",2],
                audioname:["liushan"],
                enable:"chooseToUse",
                filter:function (event,player){
                if(event.filterCard&&!event.filterCard({name:'sha'},player,event)) return false;
                if(!player.hasZhuSkill('亲征')) return false;
                if(player.hasSkill('qinzheng3')) return false;
                for(var i=0;i<game.players.length;i++){
                    if(game.players[i].group=='shu'&&game.players[i]!=player){
                        return lib.filter.cardUsable({name:'sha'},player);
                    }
                }
                return false;
            },
                filterTarget:function (card,player,target){
                if(_status.event._backup&&
                    typeof _status.event._backup.filterTarget=='function'&&
                    !_status.event._backup.filterTarget({name:'sha'},player,target)){
                    return false;
                }
                return player.canUse({name:'sha'},target);
            },
                content:function (){
                "step 0"
                if(event.current==undefined) event.current=player.next;
                if(event.current==player){
                    player.addSkill('qinzheng3');
                    event.getParent(2).step=0;
                    event.finish();
                }
                else if(event.current.group=='shu'){
                    var next=event.current.chooseToRespond('是否替'+get.translation(player)+'对'+get.translation(target)+'使用一张杀',
                    function(card,player,event){
                        event=event||_status.event;
                        return card.name=='sha'&&event.source.canUse(card,event.target);
                    });
                    next.set('ai',function(card){
                        var event=_status.event;
                        return ai.get.effect(event.target,card,event.source,event.player);
                    });
                    next.set('source',player);
                    next.set('target',target);
                    next.autochoose=lib.filter.autoRespondSha;
                }
                else{
                    event.current=event.current.next;
                    event.redo();
                }
                "step 1"
                if(result.bool){
                    event.finish();
                    if(result.cards&&result.cards.length==1&&result.cards[0].name=='sha'){
                        player.useCard(result.cards[0],target).animate=false;
                    }
                    else{
                        player.useCard({name:'sha'},target).animate=false;
                    }
                    if(typeof event.current.ai.shown=='number'&&event.current.ai.shown<0.95){
                        event.current.ai.shown+=0.3;
                        if(event.current.ai.shown>0.95) event.current.ai.shown=0.95;
                    }
                }
                else{
                    event.current=event.current.next;
                    event.goto(0);
                }
            },
                ai:{
                    result:{
                        target:function (player,target){
                        if(player.hasSkill('qinzheng3')) return 0;
                        return ai.get.effect(target,{name:'sha'},player,target);
                    },
                    },
                    order:function (){
                    return lib.card.sha.ai.order-0.1;
                },
                },
            },
            "qinzheng3":{
                trigger:{
                    global:["useCardAfter","useSkillAfter","phaseAfter"],
                },
                forced:true,
                popup:false,
                silent:true,
                filter:function (event){
        return event.skill!='qinzheng2'&&event.skill!='qinwang2'&&event.skill!='beidi2';
    },
                content:function (){
        player.removeSkill('qinzheng3');
    },
            },
            "险计":{
                mod:{
                    targetEnabled:function (card,player,target,now){
            if(target.num('h')==0){
                if(card.name=='sha'||card.name=='juedou'||card.name=='nanman'||card.name=='wanjian') return false;
            }
        },
                },
                group:"xianji1",
                ai:{
                    noh:true,
                    skillTagFilter:function (player,tag){
            if(tag=='noh'){
                if(player.num('h')!=1) return false;
            }
        },
                },
            },
            "xianji1":{
                audio:["险计",2],
                trigger:{
                    player:"loseEnd",
                },
                forced:true,
                filter:function (event,player){
                if(player.num('h')) return false;
                for(var i=0;i<event.cards.length;i++){
                    if(event.cards[i].original=='h') return true;
                }
                return false;
            },
                content:function (){},
            },
            "星象":{
                audio:["星象",2],
                trigger:{
                    player:["phaseBegin","phaseEnd"],
                },
                frequent:true,
                content:function (){
        "step 0"
        if(player.isUnderControl()){
            game.modeSwapPlayer(player);
        }
        var cards=get.cards(Math.min(5,game.players.length));
        event.cards=cards;
        var switchToAuto=function(){
            _status.imchoosing=false;
            if(event.dialog) event.dialog.close();
            if(event.control) event.control.close();
            var top=[];
            var judges=player.node.judges.childNodes;
            var stopped=false;
            if(!player.num('h','wuxie')){
                for(var i=0;i<judges.length;i++){
                    var judge=get.judge(judges[i]);
                    cards.sort(function(a,b){
                        return judge(b)-judge(a);
                    });
                    if(judge(cards[0])<0){
                        stopped=true;break;
                    }
                    else{
                        top.unshift(cards.shift());
                    }
                }
            }
            var bottom;
            if(!stopped){
                cards.sort(function(a,b){
                    return ai.get.value(b,player)-ai.get.value(a,player);
                });
                while(cards.length){
                    if(ai.get.value(cards[0],player)<=5) break;
                    top.unshift(cards.shift());
                }
            }
            bottom=cards;
            for(var i=0;i<top.length;i++){
                ui.cardPile.insertBefore(top[i],ui.cardPile.firstChild);
            }
            for(i=0;i<bottom.length;i++){
                ui.cardPile.appendChild(bottom[i]);
            }
            player.popup(get.cnNumber(top.length)+'上'+get.cnNumber(bottom.length)+'下');
            game.log(player,'将'+get.cnNumber(top.length)+'张牌置于牌堆顶');
            game.delay(2);
        };
        var chooseButton=function(online,player,cards){
            var event=_status.event;
            player=player||event.player;
            cards=cards||event.cards;
            event.top=[];
            event.bottom=[];
            event.status=true;
            event.dialog=ui.create.dialog('按顺序选择置于牌堆顶的牌（先选择的在上）',cards);
            event.switchToAuto=function(){
                event._result='ai';
                event.dialog.close();
                event.control.close();
                _status.imchoosing=false;
            },
            event.control=ui.create.control('ok','pileTop','pileBottom',function(link){
                var event=_status.event;
                if(link=='ok'){
                    if(online){
                        event._result={
                            top:[],
                            bottom:[]
                        }
                        for(var i=0;i<event.top.length;i++){
                            event._result.top.push(event.top[i].link);
                        }
                        for(var i=0;i<event.bottom.length;i++){
                            event._result.bottom.push(event.bottom[i].link);
                        }
                    }
                    else{
                        var i;
                        for(i=0;i<event.top.length;i++){
                            ui.cardPile.insertBefore(event.top[i].link,ui.cardPile.firstChild);
                        }
                        for(i=0;i<event.bottom.length;i++){
                            ui.cardPile.appendChild(event.bottom[i].link);
                        }
                        for(i=0;i<event.dialog.buttons.length;i++){
                            if(event.dialog.buttons[i].classList.contains('glow')==false&&
                                event.dialog.buttons[i].classList.contains('target')==false)
                            ui.cardPile.appendChild(event.dialog.buttons[i].link);
                        }
                        player.popup(get.cnNumber(event.top.length)+'上'+get.cnNumber(event.cards.length-event.top.length)+'下');
                        game.log(player,'将'+get.cnNumber(event.top.length)+'张牌置于牌堆顶');
                    }
                    event.dialog.close();
                    event.control.close();
                    game.resume();
                    _status.imchoosing=false;
                }
                else if(link=='pileTop'){
                    event.status=true;
                    event.dialog.content.childNodes[0].innerHTML='按顺序选择置于牌堆顶的牌';
                }
                else{
                    event.status=false;
                    event.dialog.content.childNodes[0].innerHTML='按顺序选择置于牌堆底的牌';
                }
            })
            for(var i=0;i<event.dialog.buttons.length;i++){
                event.dialog.buttons[i].classList.add('selectable');
            }
            event.custom.replace.button=function(link){
                var event=_status.event;
                if(link.classList.contains('target')){
                    link.classList.remove('target');
                    event.top.remove(link);
                }
                else if(link.classList.contains('glow')){
                    link.classList.remove('glow');
                    event.bottom.remove(link);
                }
                else if(event.status){
                    link.classList.add('target');
                    event.top.unshift(link);
                }
                else{
                    link.classList.add('glow');
                    event.bottom.push(link);
                }
            }
            event.custom.replace.window=function(){
                for(var i=0;i<_status.event.dialog.buttons.length;i++){
                    _status.event.dialog.buttons[i].classList.remove('target');
                    _status.event.dialog.buttons[i].classList.remove('glow');
                    _status.event.top.length=0;
                    _status.event.bottom.length=0;
                }
            }
            game.pause();
            game.countChoose();
        };
        event.switchToAuto=switchToAuto;

        if(event.isMine()){
            chooseButton();
            event.finish();
        }
        else if(event.isOnline()){
            event.player.send(chooseButton,true,event.player,event.cards);
            event.player.wait();
            game.pause();
        }
        else{
            event.switchToAuto();
            event.finish();
        }
        "step 1"
        if(event.result=='ai'||!event.result){
            event.switchToAuto();
        }
        else{
            var top=event.result.top||[];
            var bottom=event.result.bottom||[];
            for(var i=0;i<top.length;i++){
                ui.cardPile.insertBefore(top[i],ui.cardPile.firstChild);
            }
            for(i=0;i<bottom.length;i++){
                ui.cardPile.appendChild(bottom[i]);
            }
            for(i=0;i<event.cards.length;i++){
                if(!top.contains(event.cards[i])&&!bottom.contains(event.cards[i])){
                    ui.cardPile.appendChild(event.cards[i]);
                }
            }
            player.popup(get.cnNumber(top.length)+'上'+get.cnNumber(event.cards.length-top.length)+'下');
            game.log(player,'将'+get.cnNumber(top.length)+'张牌置于牌堆顶');
            game.delay(2);
        }
    },
                ai:{
                    threaten:1.2,
                },
            },
            "铁索":{
                group:["tiesuo1","tiesuo2"],
            },
            "tiesuo1":{
                audio:["铁索",2],
                enable:"phaseUse",
                filter:function (event,player){
        return player.num('h',{color:'black'})>0;
    },
                filterCard:function (card){
        return get.color(card)=='black';
    },
                viewAs:{
                    name:"tiesuo",
                },
                prompt:"将一张黑色牌当铁锁连环使用",
                check:function (card){return 4-ai.get.value(card)},
                ai:{
                    wuxie:function (){
            if(Math.random()<0.5) return 0;
        },
                    basic:{
                        useful:4,
                        value:4,
                        order:7,
                    },
                    result:{
                        target:function (player,target){
                if(target.isLinked()) return 1;
                if(ai.get.attitude(player,target)>=0) return -1;
                // if(player.isMin()) return -1;
                if(ui.selected.targets.length) return -1;
                for(var i=0;i<game.players.length;i++){
                    if(ai.get.attitude(player,game.players[i])<=-1&&
                        game.players[i]!=target&&!game.players[i].isLinked()){
                        return -1;
                    }
                }
                return 0;
            },
                    },
                    tag:{
                        multitarget:1,
                        multineg:1,
                        norepeat:1,
                    },
                },
            },
            "tiesuo2":{
                audio:["铁索",2],
                enable:"phaseUse",
                filter:function (event,player){
        return player.num('h',{color:'black'})>0;
    },
                filterCard:function (card){
        return get.color(card)=='black';
    },
                check:function (card){
        return 5-ai.get.useful(card);
    },
                content:function (){
        player.draw();
        player.recover();
    },
                discard:false,
                prompt:"将一张黑色牌置于弃牌堆并摸一张牌回复1点体力",
                delay:0.5,
                prepare:function (cards,player){
        player.$throw(cards,1000);
    },
                ai:{
                    basic:{
                        order:1,
                    },
                    result:{
                        player:1,
                    },
                },
            },
            "落凤":{
                audio:["落凤",2],
                unique:true,
                enable:"chooseToUse",
                mark:true,
                skillAnimation:true,
                animationStr:"落凤",
                animationColor:"fire",
                init:function (player){
        player.storage.落凤=false;
    },
                filter:function (event,player){
        if(player.storage.落凤) return false;
        if(event.type=='dying'){
            if(player!=event.dying) return false;
            return true;
        }
        else if(event.parent.name=='phaseUse'){
            return true;
        }
        return false;
    },
                content:function (){
        'step 0'
        player.hp=Math.min(player.maxHp);
        player.discard(player.get('hej'));
        player.awakenSkill('落凤');
        player.storage.落凤=true;
        'step 1'
        if(player.isLinked()) player.link();
        'step 2'
        if(player.isTurnedOver()) player.turnOver();
    },
                ai:{
                    order:1,
                    skillTagFilter:function (player){
            if(player.storage.落凤) return false;
            if(player.hp>0) return false;
        },
                    save:true,
                    result:{
                        player:function (player){
                if(player.hp==0) return 10;
                if(player.hp<=2&&player.num('he')<=1) return 10;
                return 0;
            },
                    },
                    threaten:function (player,target){
            if(!target.storage.落凤) return 0.6;
        },
                },
                intro:{
                    content:"limited",
                },
            },
            "燃火":{
                audio:["燃火",2],
                group:"ranhuo2",
                enable:"chooseToUse",
                filterCard:function (card){
        return get.color(card)=='red';
    },
                viewAs:{
                    name:"huogong",
                    nature:"fire",
                    suit:"heart",
                    number:13,
                    cards:[{"node":{"image":{},"info":{},"name":{},"name2":{},"background":{},"intro":{},"range":{}},"storage":{"uncheck":[]},"suit":"heart","number":13,"name":"shan","_transform":"translateX(224px)","_mouseentercreated":false,"clone":{"name":"shan","suit":"heart","number":13,"node":{"name":{},"info":{},"intro":{},"background":{},"image":{}},"_transitionEnded":true,"timeout":2663},"timeout":2641,"original":"h"}],
                },
                viewAsFilter:function (player){
        if(!player.num('h',{color:'red'})) return false;
    },
                prompt:"将一张红色牌当火攻使用",
                check:function (card){
        var player=_status.currentPhase;
        if(player.num('h')>player.hp){
            return 6-ai.get.value(card);
        }
        return 4-ai.get.value(card)
    },
                ai:{
                    basic:{
                        order:4,
                        value:[3,1],
                        useful:1,
                    },
                    wuxie:function (target,card,player,current,state){
            if(ai.get.attitude(current,player)>=0&&state>0) return false;
        },
                    result:{
                        player:function (player){
                var nh=player.num('h');
                if(nh<=player.hp&&nh<=4&&_status.event.name=='chooseToUse'){
                    if(typeof _status.event.filterCard=='function'&&
                        _status.event.filterCard({name:'huogong'})){
                        return -10;
                    }
                    if(_status.event.skill){
                        var viewAs=get.info(_status.event.skill).viewAs;
                        if(viewAs=='huogong') return -10;
                        if(viewAs&&viewAs.name=='huogong') return -10;
                    }
                }
                return 0;
            },
                        target:function (player,target){
                if(target.hasSkill('huogong2')||target.num('h')==0) return 0;
                if(player.num('h')<=1) return 0;
                if(target==player){
                    if(typeof _status.event.filterCard=='function'&&
                        _status.event.filterCard({name:'huogong'})){
                        return -1.5;
                    }
                    if(_status.event.skill){
                        var viewAs=get.info(_status.event.skill).viewAs;
                        if(viewAs=='huogong') return -1.5;
                        if(viewAs&&viewAs.name=='huogong') return -1.5;
                    }
                    return 0;
                }
                return -1.5;
            },
                    },
                    tag:{
                        damage:1,
                        fireDamage:1,
                        natureDamage:1,
                        norepeat:1,
                    },
                },
            },
            "ranhuo2":{
                audio:["燃火",2],
                trigger:{
                    player:"damageBefore",
                },
                forced:true,
                unique:true,
                filter:function (event){
        return event.nature=='fire';
    },
                content:function (){
        trigger.untrigger();
        trigger.finish();
        player.gainMaxHp();
    },
                ai:{
                    effect:{
                        target:function (card){
                if(get.tag(card,'fireDamage')){
                    return [0,2];
                }
            },
                    },
                },
            },
            "八卦":{
                audio:["八卦",2],
                group:"yiqunbagua2",
                inherit:"bagua_skill",
                filter:function (event,player){
        if(!event.filterCard({name:'shan'})) return false;
        if(event.getParent().player.num('s','unequip')) return false;
        if(player.get('e','2')) return false;
        return true;
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(player==target&&get.subtype(card)=='equip2'){
                    if(ai.get.equipValue(card)<=8) return 0;
                }
                if(target.get('e','2')) return;
                if(player.hasSkill('unequip')) return;
                if(get.tag(card,'respondShan')) return [0.5,0];
            },
                    },
                },
                trigger:{
                    player:"chooseToRespondBegin",
                },
                check:function (event,player){
        if(ai.get.damageEffect(player,event.player,player)>=0) return false;
        return true;
    },
                content:function (){
        "step 0"
        player.judge('bagua',function(card){return (get.color(card)=='red')?1.5:-0.5});
        "step 1"
        if(result.judge>0){
            trigger.untrigger();
            trigger.responded=true;
            trigger.result={bool:true,card:{name:'shan'}}
        }
    },
            },
            "yiqunbagua2":{
                audio:["八卦",2],
                trigger:{
                    player:"damageBefore",
                },
                forced:true,
                filter:function (event){
        return event.nature=='thunder';
    },
                content:function (){
        trigger.untrigger();
        trigger.finish();
        player.recover(2);
        player.draw();
    },
                ai:{
                    effect:{
                        target:function (card){
                if(get.tag(card,'thunderDamage')){
                    return [0,2];
                }
            },
                    },
                },
            },
            "看穿":{
                audio:["看穿",2],
                group:"kanchuan2",
                enable:"chooseToUse",
                filterCard:function (card){
        return get.color(card)=='black';
    },
                viewAsFilter:function (player){
        return player.num('h',{color:'black'})>0;
    },
                viewAs:{
                    name:"wuxie",
                    suit:"spade",
                    number:12,
                    cards:[{"node":{"image":{},"info":{},"name":{},"name2":{},"background":{},"intro":{},"range":{}},"storage":{"uncheck":[]},"suit":"spade","number":12,"name":"guohe","_transform":"translateX(0px)","_mouseentercreated":false,"clone":{"name":"guohe","suit":"spade","number":12,"node":{"name":{},"info":{},"intro":{},"background":{},"image":{}},"_transitionEnded":true,"timeout":2303},"timeout":2289,"original":"h"}],
                },
                prompt:"将一张黑色手牌当无懈可击使用",
                check:function (card){return 8-ai.get.value(card)},
                threaten:1.2,
                ai:{
                    basic:{
                        useful:[6,4],
                        value:[6,4],
                    },
                    result:{
                        player:1,
                    },
                    expose:0.2,
                },
            },
            "kanchuan2":{
                mod:{
                    targetEnabled:function (card,player,target){
            if(get.type(card)=='delay'&&player!=target){
                return false;
            }
        },
                },
                ai:{
                    playernowuxie:true,
                },
            },
            "胆略":{
                audio:["胆略",2],
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        return target.canUse({name:'sha'},player)&&target.num('he');
    },
                content:function (){
        "step 0"
        target.chooseToUse({name:'sha'},player,-1,'胆略：对'+get.translation(player)+'使用一张杀，或令其弃置你的两张牌，并失去1点体力上限').set('targetRequired',true);
        "step 1"
        if(result.bool==false&&target.num('he')>0){
            player.discardPlayerCard(2,target,'he',true);
            target.loseMaxHp();
        }
        else{
            event.finish();
        }
    },
                ai:{
                    order:4,
                    expose:0.2,
                    result:{
                        target:-1,
                        player:function (player,target){
                if(target.num('h')==0) return 0;
                if(target.num('h')==1) return -0.1;
                if(player.hp<=2) return -2;
                if(player.num('h','shan')==0) return -1;
                return -0.5;
            },
                    },
                    threaten:1.1,
                },
            },
            "承志":{
                skillAnimation:true,
                audio:["承志",2],
                unique:true,
                priority:-10,
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                filter:function (event,player){
        if(player.storage.承志) return false;
        return player.num('h')>=4;
    },
                content:function (){
        "step 0"
        player.awakenSkill('承志');
        player.chooseControl('承志_回血','承志_摸牌',function(event,player){
            if(player.hp>=2) return '承志_摸牌';
            return '承志_回血';
        });
        "step 1"
        if(result.control=='承志_摸牌'){
            player.draw(9);
        }
        else{
            player.recover(99);
        }
        "step 2"
        player.loseMaxHp();
        player.storage.承志=true;
        if(player.hp>player.maxHp) player.hp=player.maxHp;
        player.update();
        player.addSkill('麒麟');
    },
            },
            "麒麟":{
                audio:["麒麟",2],
                group:["qilin2","qilin3"],
                enable:["chooseToRespond","chooseToUse"],
                filterCard:function (card){
        return get.color(card)=='red';
    },
                position:"he",
                viewAs:{
                    name:"juedou",
                    suit:"heart",
                    number:13,
                },
                viewAsFilter:function (player){
        if(!player.num('he',{color:'red'})) return false;
    },
                prompt:"将一张红色牌当决斗使用或打出",
                check:function (card){return 4-ai.get.value(card)},
                ai:{
                    basic:{
                        order:5,
                        useful:1,
                        value:4.5,
                    },
                    result:{
                        target:-1.5,
                        player:function (player,target){
                        if(ai.get.damageEffect(target,player,target)>0&&ai.get.attitude(player,target)>0&&ai.get.attitude(target,player)>0){
                            return 0;
                        }
                        var hs1=target.get('h','sha');
                        var hs2=player.get('h','sha');
                        if(hs1.length>hs2.length+1){
                            return -2;
                        }
                        var hsx=target.get('h');
                        if(hsx.length>2&&hs2.length==0&&hsx[0].number<6){
                            return -2;
                        }
                        if(hsx.length>3&&hs2.length==0){
                            return -2;
                        }
                        if(hs1.length>hs2.length&&(!hs2.length||hs1[0].number>hs2[0].number)){
                            return -2;
                        }
                        return -0.5;
                    },
                    },
                    tag:{
                        respond:2,
                        respondSha:2,
                        damage:1,
                    },
                },
            },
            "qilin2":{
                audio:["麒麟",2],
                enable:"chooseToUse",
                filterCard:function (card){
        return get.color(card)=='black';
    },
                viewAsFilter:function (player){
        return player.num('he',{color:'black'})>0;
    },
                viewAs:{
                    name:"wuxie",
                },
                prompt:"将一张黑色牌当无懈可击使用",
                check:function (card){return 8-ai.get.value(card)},
                threaten:1.2,
                ai:{
                    basic:{
                        useful:[6,4],
                        value:[6,4],
                    },
                    result:{
                        player:1,
                    },
                    expose:0.2,
                },
            },
            "qilin3":{
                mod:{
                    targetEnabled:function (card,player,target,now){
            if(card.name=='bingliang'||card.name=='lebu'||card.name=='shandian') return false;
        },
                },
            },
            "后主":{
                audio:["后主",2],
                trigger:{
                    target:"useCardToBefore",
                },
                forced:true,
                filter:function (event,player){
        return event.card.name=='sha';
    },
                content:function (){
        "step 0"
        var eff=ai.get.effect(player,trigger.card,trigger.player,trigger.player);
        trigger.player.chooseToDiscard(function(card){
            return get.type(card)=='basic';
        }).set('ai',function(card){
            if(_status.event.eff>0){
                return 10-ai.get.value(card);
            }
            return 0;
        }).set('eff',eff);
        "step 1"
        if(result.bool==false){
            trigger.finish();
            trigger.untrigger();
            player.draw();
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(card.name=='sha'){
                    if(_status.event.name=='xiangle') return;
                    var bs=player.get('h',{type:'basic'});
                    if(bs.length<2) return 0;
                    if(player.hasSkill('jiu')||player.hasSkill('tianxianjiu')) return;
                    if(bs.length<=3&&player.num('h','sha')<=1){
                        for(var i=0;i<bs.length;i++){
                            if(bs[i].name!='sha'&&ai.get.value(bs[i])<7){
                                return [1,0,1,-0.5];
                            }
                        }
                        return 0;
                    }
                    return [1,0,1,-0.5];
                }
            },
                    },
                },
            },
            "简政":{
                audio:["简政",2],
                trigger:{
                    player:"phaseUseBefore",
                },
                filter:function (event,player){
        return player.num('h')>0&&!player.hasSkill('jianzheng3');
    },
                direct:true,
                content:function (){
        "step 0"
        var fang=player.hp>=2&&player.num('h')<=player.hp+1;
        player.chooseTarget(get.prompt('简政'),function(card,player,target){
            return target!=player;
        }).set('ai',function(target){
            if(!_status.event.fang) return -1;
            if(target.num('j','lebu')) return -1;
            return ai.get.attitude(player,target)-4;
        }).set('fang',fang);
        "step 1"
        if(result.bool){
            player.draw();
            player.logSkill('简政',result.targets);
            trigger.untrigger();
            trigger.finish();
            player.addSkill('jianzheng2');
            player.storage.简政=result.targets[0];
        }
    },
            },
            "jianzheng2":{
                rigger:{
                    player:"phaseAfter",
                },
                forced:true,
                popup:false,
                audio:["简政",2],
                priority:-50,
                content:function (){
        "step 0"
        player.chooseToDiscard(true);
        "step 1"
        var target=player.storage.简政;
        target.markSkillCharacter('fangquan',player,'简政','进行一个额外回合');
        target.phase();
        target.addSkill('jianzheng3');
        player.removeSkill('jianzheng2');
        delete player.storage.简政;
    },
            },
            "jianzheng3":{
                trigger:{
                    player:"phaseAfter",
                },
                forced:true,
                popup:false,
                audio:["简政",2],
                content:function (){
        player.unmarkSkill('简政');
        player.removeSkill('jianzheng3');
    },
            },
            "愚智":{
                skillAnimation:true,
                audio:["愚智",2],
                unique:true,
                zhuSkill:true,
                keepSkill:true,
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                filter:function (event,player){
        if(!player.hasZhuSkill('愚智'))return false;
        if(player.storage.愚智) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].hp<player.hp) return false;
        }
        return true;
    },
                content:function (){
        player.storage.愚智=true;
        player.maxHp++;
        player.update();
        player.recover();
        if(player.hasSkill('愚智')){
            player.addSkill('栋梁');
        }
        else{
            player.addAdditionalSkill('愚智','栋梁');
        }
        if(!player.isZhu){
            player.storage.zhuSkill_愚智=['栋梁'];
        }
        else{
            event.trigger('zhuUpdate');
        }
        player.awakenSkill('愚智');
    },
            },
            "栋梁":{
                unique:true,
                trigger:{
                    player:"phaseAfter",
                },
                audio:["栋梁",2],
                direct:true,
                init:function (player){
        player.storage.栋梁=[];
        // player.storage.栋梁2=0;
    },
                intro:{
                    content:"characters",
                },
                content:function (){
        'step 0'
        // if(player.storage.栋梁2<1){
        //     player.storage.栋梁2++;
        //     event.finish();
        // }
        // else{
        //     player.storage.栋梁2=0;
        // }
        'step 1'
        player.logSkill('栋梁');
        var list=[];
        var list2=[];
        var players=game.players.concat(game.dead);
        for(var i=0;i<players.length;i++){
            list2.add(players[i].name);
            list2.add(players[i].name1);
            list2.add(players[i].name2);
        }
        for(var i in lib.character){
            if(lib.character[i][1]!='shu') continue;
            if(lib.character[i][4].contains('boss')) continue;
            if(lib.character[i][4].contains('minskin')) continue;
            if(player.storage.xiongcai.contains(i)) continue;
            if(list2.contains(i)) continue;
            list.push(i);
        }
        var name=list.randomGet();
        player.storage.栋梁.push(name);
        player.markSkill('栋梁');
        var skills=lib.character[name][3];
        for(var i=0;i<skills.length;i++){
            player.addSkill(skills[i]);
        }
        event.dialog=ui.create.dialog('<div class="text center">'+get.translation(player)+'发动了【栋梁】',[[name],'character']);
        game.delay(2);
        'step 2'
        event.dialog.close();
    },
            },
            "助威":{
                audio:["助威",2],
                trigger:{
                    global:"recoverAfter",
                },
                direct:true,
                filter:function (event,player){
        return _status.currentPhase==event.player;
    },
                content:function (){
        'step 0'
        if(player==trigger.player){
            player.chooseControl('摸两张','摸两张回复体力','cancel2',function(){
                return '摸两张';
            }).set('prompt',get.prompt('助威'));
            event.single=true;
        }
        else{
            player.chooseTarget(get.prompt('助威'),function(card,player,target){
                return target==_status.event.player||target==_status.event.target;
            }).set('target',trigger.player).set('ai',function(target){
                var player=_status.event.player;
                if(player==target) return 1;
                return ai.get.attitude(player,target)-1.5;
            });
        }
        'step 1'
        if(event.single){
            if(result.control!='cancel2'){
                player.logSkill('助威',player);
                if(result.control=='摸两张'){
                    player.draw(2);
                }
                else{
                    player.draw(2);
                    player.recover();
                    player.storage.助威=player;
                }
            }
        }
        else if(result.bool){
            var target=result.targets[0];
            player.logSkill('助威',target);
            if(target==player){
                target.draw(2);
            }
            else{
                target.draw(2);
                target.recover();
                target.storage.助威=player;
            }
        }
    },
                ai:{
                    expose:0.1,
                },
            },
            "归吴":{
                skillAnimation:true,
                animationColor:"fire",
                audio:["归吴",2],
                unique:true,
                forceunique:true,
                trigger:{
                    player:"phaseBegin",
                },
                filter:function (event,player){
        if(player.storage.归吴) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].storage.助威==player&&game.players[i].isDamaged()){
                return true;
            }
        }
        return false;
    },
                forced:true,
                content:function (){
        player.storage.归吴=true;
        player.loseHp(3);
        player.recover();
        player.addSkill('观武');
        player.awakenSkill('归吴');
    },
            },
            "观武":{
                audio:["观武",2],
                trigger:{
                    player:"loseEnd",
                },
                usable:3,
                frequent:true,
                filter:function (event,player){
        for(var i=0;i<event.cards.length;i++){
            if(event.cards[i].original=='e') return true;
        }
        return false;
    },
                content:function (){
         var list=["zhuge"];
        player.gain(game.createCard(list.randomGet()));
        player.$draw();
        player.recover();
    },
                ai:{
                    noe:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.type(card)=='equip') return [1,3];
            },
                    },
                },
            },
            "虎将":{
                trigger:{
                    player:["phaseBefore","changeHp"],
                },
                forced:true,
                popup:false,
                unique:true,
                content:function (){
        if(!player.storage.虎将){
            player.storage.虎将=[];
            if(player.hasSkill('叫阵')){
                player.storage.虎将.push('叫阵');
            }
            if(player.hasSkill('横扫')){
                player.storage.虎将.push('横扫');
            }
            if(player.hasSkill('清兵')){
                player.storage.虎将.push('清兵');
            }
        }
        if(player.storage.虎将.contains('叫阵')==false){
            player.removeSkill('叫阵');
        }
        if(player.storage.虎将.contains('横扫')==false){
            player.removeSkill('横扫');
        }
        if(player.storage.虎将.contains('清兵')==false){
            player.removeSkill('清兵');
        }
        if(player.hp<=7){
            player.addSkill('叫阵');
        }
        if(player.hp<=5){
            player.addSkill('横扫');
        }
        if(player.hp<=3){
            player.addSkill('清兵');
        }
    },
                ai:{
                    maixie:true,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(!target.hasFriend()) return;
                    if(target.hp>=4) return [0,1];
                }
                if(get.tag(card,'recover')&&player.hp>=player.maxHp-1) return [0,0];
            },
                    },
                },
            },
            "叫阵":{
                audio:["叫阵",2],
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        return target.canUse({name:'sha'},player)&&target.num('he');
    },
                content:function (){
        "step 0"
        target.chooseToUse({name:'sha'},player,-1,'叫阵：对'+get.translation(player)+'使用一张杀，或令其弃置你的一张牌并使你翻面').set('targetRequired',true);
        "step 1"
        if(result.bool==false&&target.num('he')>0){
            player.discardPlayerCard(target,'he',true);
            target.turnOver();
        }
        else{
            event.finish();
        }
    },
                ai:{
                    order:4,
                    expose:0.2,
                    result:{
                        target:-1,
                        player:function (player,target){
                if(target.num('h')==0) return 0;
                if(target.num('h')==1) return -0.1;
                if(player.hp<=2) return -2;
                if(player.num('h','shan')==0) return -1;
                return -0.5;
            },
                    },
                    threaten:1.1,
                },
            },
            "横扫":{
                trigger:{
                    source:"damageEnd",
                },
                forced:true,
                priority:55,
                filter:function (event){
        return event.player.num('he')>0;
    },
                content:function (){
        trigger.player.chooseToDiscard(true,'he');
    },
                mod:{
                    selectTarget:function (card,player,range){
            if(card.name!='sha') return;
            if(range[1]==-1) return;
            var cards=player.get('h');
            for(var i=0;i<cards.length;i++){
                if(cards[i].classList.contains('selected')==false)
                    return;
            }
            range[1]+=3;
        },
                    cardUsable:function (card,player,num){
            if(card.name=='sha') return Infinity;
        },
                },
            },
            "清兵":{
                group:["qingbing1","qingbing2","qingbing4"],
            },
            "qingbing1":{
                audio:["清兵",2],
                trigger:{
                    player:"phaseBegin",
                },
                direct:true,
                content:function (){
        "step 0"
        var check= player.num('h')>2;
        player.chooseTarget(get.prompt('清兵'),function(card,player,target){
            if(player==target) return false;
            return player.canUse({name:'sha'},target,false);
        }).set('check',check).set('ai',function(target){
            if(!_status.event.check) return 0;
            return ai.get.effect(target,{name:'sha'},_status.event.player);
        });
        "step 1"
        if(result.bool){
            player.logSkill('qingbing1',result.targets);
            player.useCard({name:'sha'},result.targets[0],false);
            player.skip('phaseJudge');
            player.skip('phaseDraw');
        }
    },
            },
            "qingbing2":{
                audio:["清兵",2],
                trigger:{
                    player:"phaseUseBefore",
                },
                direct:true,
                filter:function (event,player){
                return player.num('he',{type:'equip'})>0;
            },
                content:function (){
                "step 0"
                var check=player.needsToDiscard();
                player.chooseCardTarget({
                    prompt:get.prompt('清兵'),
                    filterCard:function(card,player){
                        return get.type(card)=='equip'&&lib.filter.cardDiscardable(card,player)
                    },
                    position:'he',
                    filterTarget:function(card,player,target){
                        if(player==target) return false;
                        return player.canUse({name:'sha'},target,false);
                    },
                    ai1:function(card){
                        if(_status.event.check) return 0;
                        return 6-ai.get.value(card);
                    },
                    ai2:function(target){
                        if(_status.event.check) return 0;
                        return ai.get.effect(target,{name:'sha'},_status.event.player);
                    },
                    check:check
                });
                "step 1"
                if(result.bool){
                    player.logSkill('qingbing2',result.targets);
                    player.discard(result.cards[0]);
                    player.useCard({name:'sha'},result.targets[0]);
                    trigger.untrigger();
                    trigger.finish();
                }
            },
            },
            "qingbing4":{
                audio:["清兵",2],
                trigger:{
                    player:"phaseDiscardBefore",
                },
                direct:true,
                content:function (){
                "step 0"
                var check=player.needsToDiscard()||player.isTurnedOver();
                player.chooseTarget(get.prompt('清兵'),function(card,player,target){
                    if(player==target) return false;
                    return player.canUse({name:'sha'},target,false);
                }).set('check',check).set('ai',function(target){
                    if(!_status.event.check) return 0;
                    return ai.get.effect(target,{name:'sha'},_status.event.player);
                });
                "step 1"
                if(result.bool){
                    player.logSkill('qingbing4',result.targets);
                    player.useCard({name:'sha'},result.targets[0],false);
                    trigger.untrigger();
                    trigger.finish();
                }
            },
            },
            "协睦":{
                audio:["协睦",2],
                group:"zhishixiemu2",
                trigger:{
                    target:"useCardToBegin",
                },
                filter:function (event,player){
        if(get.color(event.card)!='black') return false;
        if(!event.player) return false;
        if(event.player==player) return false;
        return player.num('h','sha')>0;
    },
                direct:true,
                content:function (){
        "step 0"
        var next=player.chooseToDiscard('协睦：是否弃置一张杀并摸两张牌增加1点体力上限？',{name:'sha'});
        next.set('ai',function(card){
            return 9-ai.get.value(card);
        });
        next.logSkill='协睦';
        "step 1"
        if(result.bool){
            player.draw(3);
            player.gianMaxHp();
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(get.color(card)=='black'&&target.num('h')>0){
                    return [1,0.5];
                }
            },
                    },
                },
            },
            "zhishixiemu2":{
                mod:{
                    targetEnabled:function (card,player,target,now){
            if(card.name=='nanman'||card.name=='wanjian') return false;
        },
                },
            },
            "蛮兵":{
                audio:["蛮兵",2],
                group:"manbing2",
                trigger:{
                    global:"respondEnd",
                },
                filter:function (event,player){
        if(event.card.name!='sha') return false;
        if(event.player==player) return false;
        if(event.cards){
            for(var i=0;i<event.cards.length;i++){
                if(get.position(event.cards[i])=='d') return true;
            }
        }
        return false;
    },
                frequent:true,
                content:function (){
        var cards=trigger.cards.slice(0);
        for(var i=0;i<cards.length;i++){
            if(get.position(cards[i])!='d'){
                cards.splice(i--,1);
            }
        }
        game.delay(0.5);
        player.gain(cards,'gain2');
    },
            },
            "manbing2":{
                mod:{
                    cardUsable:function (card,player,num){
            if(card.name=='sha') return Infinity;
        },
                },
            },
            "恩仇":{
                audio:["恩仇",2],
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                check:function (event,player){
        var att=ai.get.attitude(player,event.source);
        var num=event.source.num('h');
        if(att<=0) return true;
        if(num>2) return true;
        if(num) return att<4;
        return false;
    },
                filter:function (event,player){
        return event.source&&event.source!=player&&event.num>0&&event.source.isAlive();
    },
                content:function (){
        "step 0"
        event.num=trigger.num;
        "step 1"
        trigger.source.chooseCard('交给'+get.translation(player)+'两张手牌或失去一点体力上限流失一点体力').set('ai',function(card){
            if(ai.get.attitude(_status.event.player,_status.event.getParent().player)>0){
                return 11-ai.get.value(card);
            }
            else{
                return 7-ai.get.value(card);
            }
        });
        "step 2"
        if(result.bool){
            player.gain(result.cards[0],trigger.source);
            trigger.source.$give(2,player);
        }
        else{
            trigger.source.loseMaxHp();
            trigger.source.loseHp();            
        }
        if(event.num>1){
            event.num--;
            event.goto(1);
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(player.hasSkill('jueqing')) return [1,-1.5];
                var hasfriend=false;
                for(var i=0;i<game.players.length;i++){
                    if(game.players[i]!=target&&ai.get.attitude(game.players[i],target)>=0){
                        hasfriend=true;break;
                    }
                }
                if(!hasfriend) return;
                if(get.tag(card,'damage')) return [1,0,0,-0.7];
            },
                    },
                },
                group:"enchou2",
            },
            "enchou2":{
                audio:["恩仇",2],
                trigger:{
                    player:"gainEnd",
                },
                filter:function (event,player){
        return event.source&&event.source.isAlive()&&event.source!=player&&event.cards.length>=2;
    },
                logTarget:"source",
                check:function (event,player){
        return ai.get.attitude(player,event.source)>0;
    },
                content:function (){
        trigger.source.draw();
   trigger.source.recover();
    },
            },
            "辅翼":{
                audio:["辅翼",2],
                trigger:{
                    player:"phaseDrawBegin",
                },
                direct:true,
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('辅翼'),function(card,player,target){
            return player!=target;
        }).set('ai',function(target){
            var att=ai.get.attitude(_status.event.player,target);
            if(att>0){
                if(target.num('h')<target.hp) att+=2;
                return att-target.num('h')/3;
            }
            else{
                return -1;
            }
        });
        "step 1"
        if(result.bool){
            trigger.untrigger();
            trigger.finish();
            player.logSkill('辅翼',result.targets);
            event.target=result.targets[0];
            event.target.draw(3);
            player.chooseTarget('选择出杀的目标',true,function(card,player,target){
                return _status.event.target.canUse('sha',target)&&player!=target;
            }).set('ai',function(target){
                return ai.get.effect(target,{name:'sha'},_status.event.target,_status.event.player);
            }).set('target',event.target);
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool&&result.targets.length){
            game.log(player,'指定的出杀目标为',result.targets);
            event.target.line(result.targets);
            event.target.chooseToUse('对'+get.translation(result.targets)+'使用一张杀，或令'+get.translation(player)+'获得你的两张牌',{name:'sha'},result.targets[0],-1);
        }
        else{
            event.bool=true;
        }
        "step 3"
        if(event.bool||result.bool==false){
            player.gainPlayerCard('he',event.target,Math.min(2,event.target.num('he')),true);
        }
    },
                ai:{
                    expose:0.2,
                },
            },
            "不言":{
                audio:["不言",2],
                trigger:{
                    player:"damageBefore",
                },
                forced:true,
                priority:15,
                check:function (event,player){
        if(player==event.player) return true;
        return false;
    },
                filter:function (event,player){
        return get.type(event.card,'trick')=='trick';
    },
                content:function (){
        trigger.untrigger();
        trigger.finish();
        player.gainMaxHp();
        player.draw();
    },
                ai:{
                    notrick:true,
                    notricksource:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.type(card)=='trick'&&get.tag(card,'damage')){
                    return 'zeroplayertarget';
                }
            },
                        player:function (card,player,target,current){
                if(get.type(card)=='trick'&&get.tag(card,'damage')){
                    return 'zeroplayertarget';
                }
            },
                    },
                },
            },
            "洞察":{
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                audio:["洞察",2],
                filter:function (event,player){
        return player.num('he')>=0;
    },
                content:function (){
        "step 0"
        player.chooseCardTarget({
            filterTarget:function(card,player,target){
                return player!=target;
            },
            filterCard:function(card,player){
                return lib.filter.cardDiscardable(card,player);
            },
            ai1:function(card){
                if(get.tag(card,'damage')){
                    return 20;
                }
                return 9-ai.get.value(card);
            },
            ai2:function(target){
                var att=ai.get.attitude(_status.event.player,target);
                if(att>0){
                    if(target.isTurnedOver()) att+=3;
                    if(target.hp==1) att+=3;
                }
                return att;
            },
            position:'he',
            prompt:get.prompt('洞察')
        });
        "step 1"
        if(result.bool){
            var target=result.targets[0];
            event.target=target;
            player.logSkill('洞察',target);
            player.discard(result.cards);
            if(target.hp==target.maxHp&&
                !target.isTurnedOver()&&
                !target.isLinked()){
                target.draw(2);
                event.finish();
            }
            else{
                var controls=['摸牌'];
                if(target.hp<target.maxHp){
                    controls.push('回复体力');
                }
                if(target.isLinked()|target.isTurnedOver()){
                    controls.push('重置武将牌');
                }
                target.chooseControl(controls).ai=function(){
                    if(target.isTurnedOver()){
                        return '重置武将牌';
                    }
                    else if(target.hp==1&&target.maxHp>2){
                        return '回复体力';
                    }
                    else if(target.hp==2&&target.maxHp>2&&target.num('h')>1){
                        return '回复体力';
                    }
                    else{
                        return '摸牌';
                    }
                }
            }
        }
        else{
            event.finish();
        }
        "step 2"
        event.control=result.control;
        switch(event.control){
            case '回复体力':event.target.recover(5);event.finish();break;
            case '摸牌':event.target.draw(5);event.finish();break;
            case '重置武将牌':if(event.target.isTurnedOver()) event.target.turnOver();break;
        }
        "step 3"
        if(event.control=='重置武将牌'&&event.target.isLinked()){
            event.target.link();
        }
    },
                ai:{
                    expose:0.2,
                    threaten:1.4,
                },
            },
            "先锋":{
                audio:["先锋",2],
                group:"xianfeng2",
                trigger:{
                    player:"phaseEnd",
                },
                forced:true,
                content:function (){
        'step 0'
        player.draw(3);
        player.phaseUse();
        'step 1'
        player.getStat().card={};
    },
            },
            "迟暮":{
                skillAnimation:true,
                audio:["迟暮",2],
                unique:true,
                enable:"chooseToUse",
                init:function (player){
        player.storage.迟暮=false;
    },
                mark:true,
                filter:function (event,player){
        if(event.type!='dying') return false;
        if(player!=event.dying) return false;
        if(player.storage.迟暮) return false;
        return true;
    },
                content:function (){
        "step 0"
        player.awakenSkill('迟暮');
        player.recover(player.maxHp);
        "step 1"
        player.drwa(5);
        player.storage.迟暮=true;
    },
                ai:{
                    save:true,
                    result:{
                        player:10,
                    },
                    threaten:function (player,target){
            if(!target.storage.fuli) return 0.9;
        },
                },
                intro:{
                    content:"limited",
                },
            },
            "xianfeng2":{
                audio:["先锋",2],
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                content:function (){
        'step 0'
        player.draw(3);
        player.phaseUse();
        'step 1'
        player.getStat().card={};
    },
            },
            "青龙":{
                audio:["青龙",2],
                group:"qinglong3",
                trigger:{
                    global:"shaBegin",
                },
                direct:true,
                filter:function (event,player){
        return event.target==event.targets[0]&&player.num('he')>0&&event.card.name=='sha'&&
        _status.currentPhase==event.player&&event.parent.parent.parent.name=='phaseUse';
    },
                content:function (){
        'step 0'
        var go=false;
        if(ai.get.attitude(player,trigger.player)>0){
            if(get.color(trigger.card)=='red'){
                go=true;
            }
            else if(!trigger.player.hasSkill('paoxiao')&&
                !trigger.player.hasSkill('tanlin3')&&
                !trigger.player.hasSkill('zhaxiang2')&&
                !trigger.player.hasSkill('fengnu')&&
                !trigger.player.num('e','zhuge')){
                var nh=trigger.player.num('h');
                if(player==trigger.player){
                    go=(player.num('h','sha')>0);
                }
                else if(nh>=4){
                    go=true;
                }
                else if(player.num('h','sha')){
                    if(nh==3){
                        go=Math.random()<0.8;
                    }
                    else if(nh==2){
                        go=Math.random()<0.5;
                    }
                }
                else if(nh>=3){
                    if(nh==3){
                        go=Math.random()<0.5;
                    }
                    else if(nh==2){
                        go=Math.random()<0.2;
                    }
                }
            }
        }
        var next=player.chooseToDiscard(get.prompt('青龙'),'he');
        next.logSkill=['青龙',trigger.player];
        next.set('ai',function(card){
            if(_status.event.go){
                return 6-ai.get.value(card);
            }
            return 0;
        });
        next.set('go',go);
        'step 1'
        if(result.bool){
            trigger.player.getStat().card.sha--;
            if(get.color(trigger.card)=='red'){
                player.draw(2);
            }
            player.logSkill('青龙',trigger.player);
        }
    },
                ai:{
                    expose:0.2,
                },
            },
            "qinglong3":{
                enable:["chooseToRespond","chooseToUse"],
                filterCard:function (card){
        return get.color(card)=='red';
    },
                position:"he",
                viewAs:{
                    name:"sha",
                },
                viewAsFilter:function (player){
        if(!player.num('he',{color:'red'})) return false;
    },
                prompt:"将一张红色牌当杀使用或打出",
                check:function (card){return 4-ai.get.value(card)},
                ai:{
                    skillTagFilter:function (player){
            if(!player.num('he',{color:'red'})) return false;
        },
                    respondSha:true,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    order:3,
                    result:{
                        target:function (player,target){
                if(player.hasSkill('jiu')&&!target.num('e','baiyin')){
                    if(ai.get.attitude(player,target)>0){
                        return -6;
                    }
                    else{
                        return -3.05+(sgs.getDefenseSha(target,player))/30;
                    }
                }
                return -1.55+(sgs.getDefenseSha(target,player))/30;
            },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                if(card.nature=='poison') return;
                return 1;
            },
                        natureDamage:function (card){
                if(card.nature) return 1;
            },
                        fireDamage:function (card,nature){
                if(card.nature=='fire') return 1;
            },
                        thunderDamage:function (card,nature){
                if(card.nature=='thunder') return 1;
            },
                        poisonDamage:function (card,nature){
                if(card.nature=='poison') return 1;
            },
                    },
                },
            },
            "潜行":{
                audio:["潜行",2],
                group:"qianxing2",
                trigger:{
                    source:"damageBefore",
                },
                check:function (event,player){
        var att=ai.get.attitude(player,event.player);
        if(event.player.hp==event.player.maxHp) return att<0;
        if(event.player.hp==event.player.maxHp-1&&
            (event.player.maxHp<=3||event.player.hasSkillTag('潜行'))) return att<0;
        return att>0;
    },
                filter:function (event,player){
        return event.card&&event.card.name=='sha'&&get.distance(player,event.player)<=1;
    },
                logTarget:"player",
                content:function (){
        'step 0'
        player.judge(function(card){
            return get.suit(card)!='heart'?1:-1;
        });
        'step 1'
        if(result.bool){
            trigger.untrigger();
            trigger.finish();
            trigger.player.loseMaxHp(true);
        }
    },
            },
            "qianxing2":{
                audio:["潜行",2],
                trigger:{
                    player:"phaseBegin",
                },
                content:function (){
        "step 0"
        player.draw(3);
        player.chooseToDiscard('he',true);
        "step 1"
        if(!result.bool){
            event.finish();
            return;
        }
        event.color=get.color(result.cards[0]);
        player.chooseTarget(function(card,player,target){
            return player!=target&&get.distance(player,target)<=1;
        },true).set('ai',function(target){
            return -ai.get.attitude(_status.event.player,target);
        });
        "step 2"
        if(result.bool&&result.targets.length){
            result.targets[0].storage.qianxing3=event.color;
            result.targets[0].addSkill('qianxing3');
            player.line(result.targets,'green');
            game.addVideo('storage',result.targets[0],['qianxing3',event.color]);
        }
    },
            },
            "qianxing3":{
                trigger:{
                    global:"phaseAfter",
                },
                forced:true,
                mark:true,
                audio:"ext:一统江山:false",
                content:function (){
                player.removeSkill('qianxing3');
                delete player.storage.qianxing3;
            },
                mod:{
                    cardEnabled:function (card,player){
                    if(get.color(card)==player.storage.qianxing3) return false;
                },
                    cardUsable:function (card,player){
                    if(get.color(card)==player.storage.qianxing3) return false;
                },
                    cardRespondable:function (card,player){
                    if(get.color(card)==player.storage.qianxing3) return false;
                },
                    cardSavable:function (card,player){
                    if(get.color(card)==player.storage.qianxing3) return false;
                },
                },
                intro:{
                    content:function (color){
                    return '不能使用或打出'+get.translation(color)+'的牌';
                },
                },
            },
            "危嗣":{
                audio:["危嗣",2],
                trigger:{
                    player:"phaseBegin",
                },
                direct:true,
                init:function (player){
        player.storage.危嗣=[];
    },
                unique:true,
                forceunique:true,
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('危嗣'),[1,2],function(card,player,target){
            return target.num('he')>0;
        },function(target){
            return -ai.get.attitude(_status.event.player,target);
        });
        "step 1"
        if(result.bool){
            player.logSkill('危嗣',result.targets);
            event.targets=result.targets;
        }
        else{
            event.finish();
        }
        "step 2"
        if(event.targets.length){
            var target=event.targets.shift();
            event.current=target;
            player.choosePlayerCard(3,target,true);
        }
        else{
            event.finish();
        }
        "step 3"
        if(result.bool){
            player.storage.危嗣=player.storage.危嗣.concat(result.links);
            player.markSkill('危嗣');
            player.syncStorage('危嗣');
            event.current.lose(result.links,ui.special);
            event.current.$give(result.links,player);
            event.goto(2);
        }
    },
                intro:{
                    content:"cards",
                    onunmark:function (storage,player){
            if(storage&&storage.length){
                for(var i=0;i<storage.length;i++){
                    ui.discardPile.appendChild(storage[i]);
                }
                player.$throw(storage);
                player.storage.危嗣.length=0;
            }
        },
                },
                ai:{
                    threaten:2,
                },
                global:"weisi2",
            },
            "weisi2":{
                enable:"phaseUse",
                audio:["危嗣",2],
                forceaudio:true,
                filter:function (event,player){
        for(var i=0;i<game.players.length;i++){
            if(game.players[i].storage.危嗣){
                return game.players[i].storage.危嗣.length>1&&player.canUse('sha',game.players[i],true,true);
            }
        }
        return false;
    },
                content:function (){
                "step 0"
                for(var i=0;i<game.players.length;i++){
                    if(game.players[i].storage.危嗣){
                        event.target=game.players[i];
                        break;
                    }
                }
                if(event.target){
                    player.chooseCardButton(2,event.target.storage.危嗣).set('ai',function(){
                        return 1;
                    });
                }
                else{
                    event.finish();
                }
                "step 1"
                if(result.bool){
                    for(var i=0;i<result.links.length;i++){
                        event.target.storage.危嗣.remove(result.links[i]);
                    }
                    event.target.syncStorage('危嗣');
                    if(!event.target.storage.危嗣.length){
                        event.target.unmarkSkill('危嗣');
                    }
                    else{
                        event.target.markSkill('危嗣');
                    }
                    event.target.$throw(result.links);
                    for(var i=0;i<result.links.length;i++){
                        ui.discardPile.appendChild(result.links[i]);
                    }
                    player.useCard({name:'sha'},event.target);
                }
},
            },
            "过目":{
                audio:["过目",2],
                trigger:{
                    player:"phaseUseBegin",
                },
                direct:true,
                filterTarget:function (card,player,target){
        return target!=player&&target.num('h')>0;
    },
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('过目'),function(card,player,target){
            return target!=player&&target.num('h')>0;
        }).set('ai',function(){
            return Math.random();
        });
        'step 1'
        if(result.bool){
            var target=result.targets[0];
            player.logSkill('过目',target);
            var card=target.get('h').randomGet();
            player.showCards(card);
            player.storage.过目=get.type(card,'trick');
            game.addVideo('storage',player,['过目',player.storage.过目]);
            player.markSkill('过目');
        }
    },
                intro:{
                    content:function (type){
            return get.translation(type)+'牌';
        },
                },
                group:["guomu2","guomu3"],
                ai:{
                    order:11,
                    result:{
                        player:1,
                    },
                },
            },
            "guomu2":{
                audio:["过目",2],
                trigger:{
                    player:"useCard",
                },
                frequent:true,
                filter:function (event,player){
        // return (get.type(event.card,'trick')==player.storage.过目&&event.cards[0]&&event.cards[0]==event.card);
        return get.type(event.card,'trick')==player.storage.过目;
    },
                content:function (){
        player.draw(2);
        player.recover();
    },
                ai:{
                    threaten:1.4,
                },
            },
            "guomu3":{
                trigger:{
                    player:"phaseUseEnd",
                },
                forced:true,
                popup:false,
                silent:true,
                content:function (){
                delete player.storage.过目;
                player.unmarkSkill('过目');
            },
            },
            "展图":{
                unique:true,
                audio:["展图",2],
                group:"zhantu5",
                gainnable:true,
                forceunique:true,
                trigger:{
                    global:"phaseUseBegin",
                },
                filter:function (event,player){
        return event.player!=player;
    },
                logTarget:"player",
                check:function (event,player){
        if(ai.get.attitude(player,event.player)<5) return false;
        if(player.maxHp-player.hp>=2) return false;
        if(player.hp==1) return false;
        if(player.hp==2&&player.num('h')<2) return false;
        if(event.player.num('h')>=event.player.hp) return false;
        return true;
    },
                content:function (){
        "step 0"
        player.draw(5);
        "step 1"
        player.chooseCard(3,'he',true,'交给'+get.translation(trigger.player)+'三张牌').set('ai',function(card){
            if(ui.selected.cards.length&&card.name==ui.selected.cards[0].name) return -1;
            if(get.tag(card,'damage')) return 1;
            if(get.type(card)=='equip') return 1;
            return 0;
        });
        "step 2"
        trigger.player.gain(result.cards,player);
        if(player==game.me||trigger.player==game.me)
        player.$give(result.cards,trigger.player);
        else
        player.$give(2,trigger.player);
        game.delay();
        trigger.player.addSkill('zhantu2');
        trigger.player.storage.展图=player;
    },
                ai:{
                    threaten:1.1,
                    expose:0.3,
                },
            },
            "zhantu5":{
                audio:["展图",2],
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        return player.num('h')>0;
    },
                content:function (){
        'step 0'
        player.chooseCardTarget({
            filterTarget:true,
            filterCard:lib.filter.cardDiscardable,
            ai1:function(card){
                return 8-ai.get.useful(card);
            },
            ai2:function(target){
                return -ai.get.attitude(player,target);
            },
            prompt:get.prompt('zhantu5')
        });
        'step 1'
        if(result.bool){
            player.logSkill('zhantu5',result.targets);
            player.discard(result.cards);
            event.target=result.targets[0];
        }
        else{
            event.finish();
        }
        'step 2'
        var target=event.target;
        var list=[];
        for(var i=0;i<lib.inpile.length;i++){
            var info=lib.card[lib.inpile[i]];
            if(info.type=='delay'&&!info.cancel&&!target.hasJudge(lib.inpile[i])){
                list.push(lib.inpile[i]);
            }
        }
        if(list.length){
            var card=game.createCard(list.randomGet());
            target.addJudge(card);
            target.$draw(card);
            game.delay();
        }
    },
            },
            "zhantu2":{
                trigger:{
                    player:"phaseUseEnd",
                },
                forced:true,
                audio:["展图",2],
                content:function (){
                if(player.storage.展图){
                    player.storage.展图.loseHp();
                    delete player.storage.展图;
                }
                player.removeSkill('zhantu2');
            },
                group:"zhantu3",
            },
            "zhantu3":{
                trigger:{
                    source:"dieAfter",
                },
                forced:true,
                audio:"ext:一统江山:false",
                content:function (){
                delete player.storage.展图;
                player.removeSkill('zhantu2');
            },
            },
            "忠胆":{
                audio:["忠胆",2],
                group:"zhongdan2",
                trigger:{
                    player:"shaMiss",
                },
                direct:true,
                filter:function (event,player){
        return event.responded&&get.itemtype(event.cards)=='cards'&&get.itemtype(event.responded.cards)=='cards';
    },
                content:function (){
        "step 0"
        event.cards1=trigger.cards.slice(0);
        event.cards2=trigger.responded.cards.slice(0);
        player.draw(2);
        player.addTempSkill('paoxiao','phaseAfter');
        player.chooseTarget('忠胆：将杀或闪交给一名其他角色',function(card,player,target){
            return target!=_status.event.getTrigger().target&&target!=player;
        }).set('ai',function(target){
            return ai.get.attitude(_status.event.player,target);
        });
        "step 1"
        if(result.bool){
            var sha=false;
            if(event.cards1.length==1&&get.color(event.cards1[0])=='red'){
                sha=true;
            }
            player.chooseControl('杀','闪',function(event,player){
                if(_status.event.choosesha) return '杀';
                return '闪';
            }).set('prompt','选择交给'+get.translation(result.targets)+'的牌').set('choosesha',sha);
            event.target=result.targets[0];
        }
        else{
            event.finish();
        }
        "step 2"
        player.logSkill('忠胆',event.target);
        event.sha=false;
        if(result.control=='杀'){
            event.target.gain(event.cards1,'gain2');
            if(event.cards1.length==1&&get.color(event.cards1[0])=='red'){
                event.sha=true;
            }
        }
        else{
            event.target.gain(event.cards2,'gain2');
            if(event.cards2.length==1&&get.color(event.cards2[0])=='red'){
                event.sha=true;
            }
        }
        "step 3"
        if(event.sha){
            event.target.chooseToUse('是否使用一张杀？',{name:'sha'}).set('filterTarget',function(card,player,target){
                return target!=_status.event.source&&get.distance(_status.event.source,target,'attack')<=1&&player.canUse('sha',target,false);
            }).set('source',player);
        }
    },
            },
            "zhongdan2":{
                audio:["忠胆",2],
                trigger:{
                    source:"damageBegin",
                },
                filter:function (event){
        return event.card&&(event.card.name=='sha')&&
        event.parent.name!='_lianhuan'&&event.parent.name!='_lianhuan2';
    },
                forced:true,
                content:function (){
        trigger.num+=2;
    },
            },
            "采樵":{
                audio:["采樵",2],
                trigger:{
                    global:"phaseEnd",
                },
                filter:function (event,player){
        return event.player!=player&&event.player.num('h')==player.num('h')&&event.player.isAlive();
    },
                check:function (event,player){
        return ai.get.attitude(player,event.player)>=0;
    },
                priority:-5,
                logTarget:"player",
                content:function (){
        game.asyncDraw([trigger.player,player],2);
        player.recover();
    },
                ai:{
                    expose:0.1,
                },
            },
            "呢喃":{
                audio:["呢喃",2],
                enable:"phaseUse",
                filter:function (event,player){
        return player.num('h','sha')>0;
    },
                filterCard:{
                    name:"sha",
                },
                prepare:function (cards,player){
        player.$throw(cards,1000);
    },
                discard:false,
                delay:0.5,
                content:function (){
        "step 0"
        player.draw();
        player.gainMaxHp();
        "step 1"
        for(var i=0;i<cards.length;i++){
            ui.discardPile.appendChild(cards[i]);
        }
    },
                ai:{
                    basic:{
                        order:1,
                    },
                    result:{
                        player:1,
                    },
                },
                group:"ninan2",
            },
            "ninan2":{
                trigger:{
                    player:"phaseUseEnd",
                },
                direct:true,
                filter:function (event,player){
        return player.getStat().skill.呢喃>=4;
    },
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('呢喃'),function(card,player,target){
            return target.sex=='male'&&target!=player;
        }).set('ai',function(target){
            return ai.get.attitude(_status.event.player,target);
        });
        'step 1'
        if(result.bool){
            player.logSkill('呢喃',result.targets);
            result.targets[0].draw(3);
            result.targets[0].gainMaxHp(2);
            player.recover(2);
        }
    },
            },
            "祸乱":{
                mode:["identity"],
                audio:["祸乱",2],
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        if(!game.zhu||!game.zhu.isZhu) return false;
        for(var i=0;i<game.players.length;i++){
            if(game.players[i]==game.zhu||game.players[i]==player) continue;
            if(get.distance(game.players[i],game.zhu,'attack')<=1&&game.players[i].num('he')){
                return true;
            }
        }
        return false;
    },
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('祸乱'),function(card,player,target){
            if(target==player||target==game.zhu) return false;
            return get.distance(target,game.zhu,'attack')<=1&&target.num('he')>0;
        }).set('ai',function(target){
            var player=_status.event.player;
            var zhu=_status.event.zhu;
            if(ai.get.attitude(player,target)>0) return 0;
            var nh=target.num('h');
            var nh2=zhu.num('h');
            if(nh>nh2) return 2;
            if(nh==nh2&&target.num('e')) return 1.5;
            return 1;
        }).set('zhu',game.zhu);
        'step 1'
        if(result.bool){
            event.target=result.targets[0];
            player.logSkill('祸乱',event.target);
            player.discardPlayerCard(event.target,'he',true);
        }
        else{
            event.finish();
        }
        'step 2'
        event.target.draw(2);
        'step 3'
        if(event.target.num('h')>game.zhu.num('h')){
            player.draw(2);
            player.gainMaxHp();
        }
    },
                ai:{
                    threaten:1.2,
                },
            },
            "贿赂":{
                audio:["贿赂",2],
                group:["huilu2","huilu3"],
                trigger:{
                    player:"damageBefore",
                },
                direct:true,
                filter:function (event,player){
        if(!player.num('he')) return false;
        if(!event.source||event.source.isDead()) return false;
        if(event.source.storage.贿赂&&event.source.storage.贿赂.contains(player)) return false;
        return true;
    },
                content:function (){
        'step 0'
        var att=(ai.get.attitude(player,trigger.source)>0);
        var goon=false;
        if(player.hp==1){
            goon=true;
        }
        else{
            var he=player.get('he');
            var num=0;
            for(var i=0;i<he.length;i++){
                if(ai.get.value(he[i])<8){
                    num++;
                    if(num>=2){
                        goon=true;break;
                    }
                }
            }
        }
        player.chooseCard('he',[1,player.num('he')],get.prompt('贿赂',trigger.source)).set('ai',function(card){
            if(_status.event.att){
                return 10-ai.get.value(card);
            }
            if(_status.event.goon){
                return 8-ai.get.value(card);
            }
            return 0;
        }).set('goon',goon).set('att',att);
        'step 1'
        if(result.bool){
            player.logSkill('贿赂');
            event.num=result.cards.length;
            var goon=false;
            if(event.num>2||ai.get.attitude(trigger.source,player)>=0){
                goon=true;
            }
            var forced=false;
            var str='获得其中一张牌并防止伤害';
            if(trigger.source.num('he')<event.num){
                forced=true;
            }
            else{
                str+='，或取消并弃置'+get.cnNumber(result.cards.length)+'张牌';
            }
            if(!trigger.source.storage.贿赂){
                trigger.source.storage.贿赂=[];
            }
            trigger.source.storage.贿赂.push(player);
            trigger.source.chooseButton([str,result.cards],forced).set('ai',function(button){
                if(_status.event.goon){
                    return ai.get.value(button.link);
                }
                return ai.get.value(button.link)-8;
            }).set('goon',goon);
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.bool){
            var card=result.links[0];
            trigger.source.gain(card,player);
            if(get.position(card)=='e'){
                player.$give(card,trigger.source);
            }
            else{
                player.$give(1,trigger.source);
            }
            trigger.untrigger();
            trigger.finish();
        }
        else{
            trigger.source.chooseToDiscard(event.num,true,'he');
        }
    },
            },
            "huilu2":{
                trigger:{
                    player:"damageBegin",
                },
                forced:true,
                priority:-500,
                content:function (){
    if(trigger.num>1) trigger.num=1
},
                group:"huilu3",
            },
            "huilu3":{
                trigger:{
                    player:"loseHpBefore",
                },
                forced:true,
                popup:false,
                filter:function (event,player){
return Math.random()<=1;
},
                content:function (){
player.logSkill('huilu3')
trigger.untrigger();
trigger.finish();   
},
            },
            "昭烈":{
                audio:["昭烈",2],
                trigger:{
                    player:["recoverAfter","loseHpAfter"],
                },
                direct:true,
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('昭烈'),function(card,player,target){
            return target!=player;
        }).set('ai',function(target){
            return ai.get.attitude(_status.event.player,target);
        });
        "step 1"
        if(result.bool){
            player.logSkill('昭烈',result.targets);
            event.target=result.targets[0];
            if(event.target.hp==event.target.maxHp){
                event.target.draw(3);
                event.finish();
            }
            else{
                event.target.chooseControl('draw_card','recover_hp',function(event,target){
                    if(target.hp>=2||target.hp>=target.maxHp-1) return 'draw_card';
                    if(target.hp==2&&target.num('h')==0) return 'draw_card';
                    return 'recover_hp';
                });
            }
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.control=='draw_card'){
            target.draw(3);
        }
        else{
            target.recover(2);
        }
    },
                ai:{
                    threaten:0.8,
                    expose:0.1,
                },
            },
            "智心":{
                audio:["智心",2],
                trigger:{
                    player:"phaseBegin",
                },
                check:function (event,player){
        if(player.hp>2) return false;
        var cards=player.get('h');
        if(cards.length>3) return false;
        for(var i=0;i<cards.length;i++){
            if(ai.get.value(cards[i])>7||get.tag(cards[i],'recover')>=1) return false;
        }
        return true;
    },
                filter:function (event,player){
        return player.num('h')>0;
    },
                content:function (){
        "step 0"
        var cards=player.get('h');
        event.bool=cards.length!=player.hp;
        player.discard(cards);
        "step 1"
        if(event.bool){
            player.recover(2);
            player.draw(player.maxHp-player.num('h'));
        }
    },
            },
            "仁王":{
                audio:["仁王",2],
                trigger:{
                    player:["gainEnd","loseEnd"],
                },
                direct:true,
                filter:function (event,player){
        return event.cards&&event.cards.length>1;
    },
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('仁王'),function(card,player,target){
            return target!=player;
        }).set('ai',function(target){
            return ai.get.attitude(player,target);
        });
        'step 1'
        if(result.bool){
            player.logSkill('仁王',result.targets);
            result.targets[0].draw(3);
            result.targets[0].gainMaxHp();
        }
    },
            },
            "御驾":{
                audio:["御驾",2],
                trigger:{
                    player:"phaseDiscardAfter",
                },
                forced:true,
                filter:function (event,player){
        return player.getStat('damage')>0;
    },
                check:function (event,player){
        return player.hp==player.maxHp;
    },
                content:function (){
        "step 0"
        player.recover(2);
        "step 1"
        player.draw(2);
    },
            },
            "烈武":{
                audio:["烈武",2],
                group:["liewu2","liewu3","liewu4"],
                enable:["chooseToRespond","chooseToUse"],
                filterCard:function (card){
        return get.color(card)=='red';
    },
                position:"he",
                viewAs:{
                    name:"sha",
                    suit:"diamond",
                    number:11,
                },
                viewAsFilter:function (player){
        if(!player.num('he',{color:'red'})) return false;
    },
                prompt:"将一张红色牌当杀使用或打出",
                check:function (card){return 4-ai.get.value(card)},
                ai:{
                    skillTagFilter:function (player){
            if(!player.num('he',{color:'red'})) return false;
        },
                    respondSha:true,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    order:3,
                    result:{
                        target:function (player,target){
                if(player.hasSkill('jiu')&&!target.num('e','baiyin')){
                    if(ai.get.attitude(player,target)>0){
                        return -6;
                    }
                    else{
                        return -3.05+(sgs.getDefenseSha(target,player))/30;
                    }
                }
                return -1.55+(sgs.getDefenseSha(target,player))/30;
            },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                if(card.nature=='poison') return;
                return 1;
            },
                        natureDamage:function (card){
                if(card.nature) return 1;
            },
                        fireDamage:function (card,nature){
                if(card.nature=='fire') return 1;
            },
                        thunderDamage:function (card,nature){
                if(card.nature=='thunder') return 1;
            },
                        poisonDamage:function (card,nature){
                if(card.nature=='poison') return 1;
            },
                    },
                },
            },
            "liewu2":{
                mod:{
                    targetEnabled:function (card,player,target){
            if(card.name=='sha'||card.name=='huogong'){
                return false;
            }
        },
                },
            },
            "liewu3":{
                trigger:{
                    target:"shaBefore",
                },
                forced:true,
                priority:6,
                audio:["烈武",2],
                filter:function (event){
        if(event.player.num('s','unequip')) return false;
        return (event.card.name=='sha'&&get.color(event.card)=='black')
    },
                content:function (){
        trigger.untrigger();
        trigger.finish();
    },
                ai:{
                    effect:{
                        target:function (card,player){
                var equip1=player.get('e','1');
                if(equip1&&equip1.name=='qinggang') return 1;
                if(player.num('s','unequip')) return;
                if(card.name=='sha'&&get.color(card)=='black') return 'zerotarget';
            },
                    },
                },
            },
            "liewu4":{
                trigger:{
                    source:"damageBegin",
                },
                filter:function (event){
        return event.card&&(event.card.name=='sha'||event.card.name=='juedou')&&
        event.parent.name!='_lianhuan'&&event.parent.name!='_lianhuan2';
    },
                forced:true,
                content:function (){
        trigger.num+=3;
    },
            },
            "恩断":{
                audio:["恩断",2],
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        return player!=target&&target.num('h');
    },
                filter:function (event,player){
        return player.num('h')>0;
    },
                content:function (){
        "step 0"
        player.chooseToCompare(target).set('small',true);
        "step 1"
        if(result.bool){
            if(!target.hasSkill('fengyin')){
                target.addTempSkill('fengyin','phaseAfter');
            }
            target.addTempSkill('enduan2','phaseAfter');
            player.addTempSkill('paoxiao','phaseAfter');
            event.finish();
        }
        else if(target.hp<target.maxHp){
            player.chooseBool('是否让目标回复三点体力？').ai=function(event,player){
                return ai.get.recoverEffect(target,player,player)>0;
            };
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            target.recover(3);
        }
    },
                ai:{
                    result:{
                        target:function (player,target){
                var hs=player.get('h');
                if(hs.length<3) return 0;
                var bool=false;
                for(var i=0;i<hs.length;i++){
                    if(hs[i].number>=9&&ai.get.value(hs[i])<7){
                        bool=true;
                        break;
                    }
                }
                if(!bool) return 0;
                if(target.num('h')>target.hp+1&&ai.get.recoverEffect(target)>0){
                    return 1;
                }
                if(player.canUse('sha',target)&&(player.num('h','sha')||player.num('he',{color:'red'}))){
                    return -2;
                }
                return -0.5;
            },
                    },
                    order:9,
                },
            },
            "enduan2":{
                mark:true,
                mod:{
                    cardEnabled:function (){
                    return false;
                },
                    cardUsable:function (){
                    return false;
                },
                    cardRespondable:function (){
                    return false;
                },
                    cardSavable:function (){
                    return false;
                },
                },
                intro:{
                    content:"不能使用或打出卡牌",
                },
            },
            "豪气":{
                group:["haoqi2","haoqi3","haoqi4","haoqi5","haoqi6","haoqi7"],
                mod:{
                    cardUsable:function (card,player,num){
            if(card.name=='sha') return Infinity;
        },
                },
            },
            "haoqi2":{
                mod:{
                    targetEnabled:function (card,player,target){
            if(get.type(card)=='trick'||get.type(card)=='delay'){
                return false;
            }
        },
                },
            },
            "haoqi3":{
                audio:["豪气",2],
                trigger:{
                    player:"equipBegin",
                },
                frequent:true,
                filter:function (event,player){
        return player.num('e',{subtype:'equip1'})&&get.subtype(event.card)== 'equip1';
    },
                content:function (){
        "step 0"
        trigger.untrigger();
        trigger.finish();
        player.$equip(trigger.card);
        game.addVideo('equip',player,get.cardInfo(trigger.card));
        game.log(player,'装备了',trigger.card);
        "step 1"
        var info=get.info(trigger.card);
        if(info.onEquip&&(!info.filterEquip||info.filterEquip(trigger.card,player))){
            var next=game.createEvent('equip_'+trigger.card.name);
            next.setContent(info.onEquip);
            next.player=player;
            next.trigger.card=trigger.card;
            game.delayx();
        }
        delete player.equiping;
    },
                ai:{
                    effect:{
                        player:function (card,player,target){
                if(get.subtype(card)=='equip1') return[1,10];
            },
                    },
                },
            },
            "haoqi4":{
                audio:["豪气",2],
                trigger:{
                    player:"loseHpBefore",
                },
                forced:true,
                popup:false,
                filter:function (event,player){
return Math.random()<=1;
},
                content:function (){
player.logSkill('haoqi4')
trigger.untrigger();
trigger.finish();    
},
            },
            "haoqi5":{
                audio:["豪气",2],
                trigger:{
                    player:"damageBefore",
                },
                forced:true,
                filter:function (event,player){
return player!=event.player&&Math.random()<=0.2;
},
                content:function (){
trigger.untrigger();
trigger.finish();
},
            },
            "真假":{
                audio:["真假",2],
                unique:true,
                mark:true,
                skillAnimation:true,
                trigger:{
                    player:"phaseBegin",
                },
                init:function (player){
        player.storage.真假=false;
    },
                filter:function (event,player){
        if(player.storage.真假) return false;
        if(typeof player.storage.zhenjia2=='number'){
            return player.hp<player.storage.zhenjia2;
        }
        return false;
    },
                check:function (event,player){
        if(player.hp<=1) return true;
        return player.hp<player.storage.zhenjia2-1;
    },
                content:function (){
        player.awakenSkill('真假');
        player.recover(player.storage.zhenjia2-player.hp);
        player.draw(player.storage.zhenjia2-player.hp);
        player.storage.真假=true;
    },
                intro:{
                    mark:function (dialog,content,player){
            if(player.storage.真假) return;
            if(typeof player.storage.zhenjia2!='number'){
                return '上回合体力：无';
            }
            return '上回合体力：'+player.storage.zhenjia2;
        },
                    content:"limited",
                },
                group:["zhenjia2"],
            },
            "zhenjia2":{
                audio:["真假",2],
                trigger:{
                    player:"phaseEnd",
                },
                priority:-10,
                forced:true,
                popup:false,
                silent:true,
                content:function (){
                player.storage.zhenjia2=player.hp;
                game.broadcast(function(player){
                    player.storage.zhenjia2=player.hp;
                },player);
                game.addVideo('storage',player,['zhenjia2',player.storage.zhenjia2]);
            },
                intro:{
                    content:function (storage,player){
                    if(player.storage.真假) return;
                    return '上回合体力：'+storage;
                },
                },
            },
            "haoqi6":{
                trigger:{
                    target:"shaBefore",
                },
                forced:true,
                priority:6,
                audio:["豪气",2],
                filter:function (event){
        if(event.player.num('s','unequip')) return false;
        return (event.card.name=='sha'&&get.color(event.card)=='black')
    },
                content:function (){
        trigger.untrigger();
        trigger.finish();
    },
                ai:{
                    effect:{
                        target:function (card,player){
                var equip1=player.get('e','1');
                if(equip1&&equip1.name=='qinggang') return 1;
                if(player.num('s','unequip')) return;
                if(card.name=='sha'&&get.color(card)=='black') return 'zerotarget';
            },
                    },
                },
            },
            "haoqi7":{
                audio:["豪气",2],
                trigger:{
                    source:"damageBegin",
                },
                filter:function (event){
        return event.card&&(event.card.name=='sha')&&
        event.parent.name!='_lianhuan'&&event.parent.name!='_lianhuan2';
    },
                forced:true,
                content:function (){
        trigger.num+=5;
    },
            },
            "绝尘":{
                group:["绝尘_sha","绝尘_shan"],
                subSkill:{
                    sha:{
                        audio:["绝尘"],
                        enable:["chooseToUse","chooseToRespond"],
                        filterCard:{
                            name:"shan",
                        },
                        viewAs:{
                            name:"sha",
                            suit:"diamond",
                            number:2,
                        },
                        viewAsFilter:function (player){
                if(!player.num('h','shan')) return false;
            },
                        prompt:"将一张闪当杀使用或打出",
                        check:function (){return 1},
                        ai:{
                            effect:{
                                target:function (card,player,target,current){
                        if(get.tag(card,'绝尘Sha')&&current<0) return 0.6
                    },
                            },
                            respondSha:true,
                            skillTagFilter:function (player){
                    if(!player.num('h','shan')) return false;
                },
                            order:3.1,
                            useful:-1,
                            value:-1,
                            basic:{
                                useful:[5,1],
                                value:[5,1],
                            },
                            result:{
                                target:function (player,target){
                        if(player.hasSkill('jiu')&&!target.num('e','baiyin')){
                            if(ai.get.attitude(player,target)>0){
                                return -6;
                            }
                            else{
                                return -3;
                            }
                        }
                        return -1.5;
                    },
                            },
                            tag:{
                                respond:1,
                                respondShan:1,
                                damage:function (card){
                        if(card.nature=='poison') return;
                        return 1;
                    },
                                natureDamage:function (card){
                        if(card.nature) return 1;
                    },
                                fireDamage:function (card,nature){
                        if(card.nature=='fire') return 1;
                    },
                                thunderDamage:function (card,nature){
                        if(card.nature=='thunder') return 1;
                    },
                                poisonDamage:function (card,nature){
                        if(card.nature=='poison') return 1;
                    },
                            },
                        },
                    },
                    shan:{
                        audio:["绝尘",2],
                        enable:["chooseToRespond"],
                        filterCard:{
                            name:"sha",
                        },
                        viewAs:{
                            name:"shan",
                            suit:"diamond",
                            number:10,
                        },
                        prompt:"将一张杀当闪打出",
                        check:function (){return 1},
                        ai:{
                            respondShan:true,
                            skillTagFilter:function (player){
                    if(!player.num('h','sha')) return false;
                },
                            effect:{
                                target:function (card,player,target,current){
                        if(get.tag(card,'绝尘Shan')&&current<0) return 0.6
                    },
                            },
                            order:4,
                            useful:-1,
                            value:-1,
                            basic:{
                                useful:[7,2],
                                value:[7,2],
                            },
                        },
                    },
                },
            },
            "横枪":{
                audio:["横枪",2],
                trigger:{
                    player:["respond","useCard"],
                },
                frequent:true,
                filter:function (event,player){
        return player!=_status.currentPhase&&get.itemtype(event.cards)=='cards';
    },
                content:function (){
        "step 0"
        event.card=get.cards()[0];
        game.broadcast(function(card){
            ui.arena.classList.add('thrownhighlight');
            card.copy('thrown','center','thrownhighlight',ui.arena).animate('start');
        },event.card);
        event.node=event.card.copy('thrown','center','thrownhighlight',ui.arena).animate('start');
        ui.arena.classList.add('thrownhighlight');
        game.addVideo('thrownhighlight1');
        game.addVideo('centernode',null,get.cardInfo(event.card));
        if(get.type(event.card,'trick')==get.type(trigger.card,'trick')){
            player.chooseTarget('选择获得此牌的角色').set('ai',function(target){
                var att=ai.get.attitude(_status.event.player,target);
                if(_status.event.du){
                    return -att;
                }
                if(att>0){
                    return att+Math.max(0,5-target.num('h'));
                }
                return att;
            }).set('du',event.card.name=='du');
        }
        else{
            player.chooseBool('是否弃置'+get.translation(event.card)+'？');
            event.disbool=true;
        }
        game.delay(2);
        "step 1"
        if(event.disbool){
            if(!result.bool){
                game.log(player,'展示了',event.card);
                ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
            }
            else{
                game.log(player,'展示并弃掉了',event.card);
                ui.discardPile.appendChild(event.card);
            }
            game.addVideo('deletenode',player,[get.cardInfo(event.node)]);
            event.node.delete();
            game.broadcast(function(card){
                ui.arena.classList.remove('thrownhighlight');
                if(card.clone){
                    card.clone.delete();
                }
            },event.card);
        }
        else if(result.targets){
            player.line(result.targets,'green');
            result.targets[0].gain(event.card);
            event.node.moveDelete(result.targets[0]);
            game.log(result.targets[0],'获得了',event.card);
            game.addVideo('gain2',result.targets[0],[get.cardInfo(event.node)]);
            game.broadcast(function(card,target){
                ui.arena.classList.remove('thrownhighlight');
                if(card.clone){
                    card.clone.moveDelete(target);
                }
            },event.card,result.targets[0]);
        }
        else{
            game.log(player,'展示并弃掉了',event.card);
            ui.discardPile.appendChild(event.card);
            game.addVideo('deletenode',player,[get.cardInfo(event.node)]);
            event.node.delete();
            game.broadcast(function(card){
                ui.arena.classList.remove('thrownhighlight');
                if(card.clone){
                    card.clone.delete();
                }
            },event.card);
        }
        game.addVideo('thrownhighlight2');
        ui.arena.classList.remove('thrownhighlight');
    },
                ai:{
                    effect:{
                        target:function (card,player){
                if(get.tag(card,'respond')&&player.num('h')>1) return [1,0.2];
            },
                    },
                },
            },
            "咫尺":{
                group:["longzhichi2","longzhichi3"],
                ai:{
                    mingzhi:false,
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'respondShan')||get.tag(card,'respondSha')){
                    if(ai.get.attitude(target,player)<=0){
                        if(current>0) return;
                        if(target.num('h')==0) return 1.6;
                        if(target.num('h')==1) return 1.2;
                        if(target.num('h')==2) return [0.8,0.2,0,-0.2];
                        return [0.4,0.7,0,-0.7];
                    }
                }
            },
                    },
                },
            },
            "longzhichi2":{
                audio:["咫尺",2],
                trigger:{
                    player:"shaBefore",
                },
                filter:function (event,player){
        if(event.skill!='绝尘_sha') return false;
        return event.target.num('h')>0;
    },
                content:function (){
        player.draw();
        player.gainMaxHp();
        player.gain(2,trigger.target.get('h').randomGet(),trigger.target);
        trigger.target.$give(2,player);
        game.delay();
    },
            },
            "longzhichi3":{
                audio:["咫尺",2],
                trigger:{
                    player:"respond",
                },
                filter:function (event,player){
        if(event.skill!='绝尘_shan'&&event.skill!='绝尘_sha') return false;
        return event.source&&event.source.num('h')>0;
    },
                content:function (){
   player.draw();
   player.gainMaxHp();
        player.gain(2,trigger.source.get('h').randomGet(),trigger.source);
        trigger.source.$give(2,player);
        game.delay();
    },
            },
            "沧海":{
                audio:["沧海",2],
                trigger:{
                    player:["damageEnd","loseHpEnd"],
                },
                content:function (){
        var list=["sha","huosha","leisha"];
        player.gain(game.createCard(list.randomGet()));
        player.$draw();
        player.gain(game.createCard(list.randomGet()));      
        player.$draw();
        player.recover(2);
    },
            },
            "西凉":{
                audio:["西凉",2],
                group:"xiliang2",
                trigger:{
                    player:"shaBegin",
                },
                check:function (event,player){
        return ai.get.attitude(player,event.target)<0;
    },
                content:function (){
        "step 0"
        player.draw(2);
        player.recover(2);
        player.judge(function(){return 0});
        if(!trigger.target.hasSkill('fengyin')){
            trigger.target.addTempSkill('fengyin','phaseAfter');
        }
        "step 1"
        var suit=get.suit(result.card);
        var target=trigger.target;
        var num=target.num('h','shan');
        target.chooseToDiscard('请弃置一张'+get.translation(suit)+'牌，否则不能使用闪抵消此杀','he',function(card){
            return get.suit(card)==_status.event.suit;
        }).set('ai',function(card){
            var num=_status.event.num;
            if(num==0) return 0;
            if(card.name=='shan') return num>1;
            return 8-ai.get.value(card);
        }).set('num',num).set('suit',suit);
        "step 2"
        if(!result.bool){
            trigger.directHit=true;
        }
    },
                mod:{
                    cardUsable:function (card,player,num){
                    if(card.name=='sha') return num+2;
                },
                },
            },
            "xiliang2":{
                audio:["西凉",2],
                trigger:{
                    source:["damageEnd"],
                },
                content:function (){
        var list=["sha","leisha","huosha"];
        player.gain(game.createCard(list.randomGet()));
        player.$draw();
        player.gain(game.createCard(list.randomGet()));      
        player.$draw();
    },
            },
            "谋杀":{
                audio:["谋杀",2],
                trigger:{
                    global:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        return event.player.isAlive()&&event.player.getStat('damage')&&
        lib.filter.targetEnabled({name:'sha'},player,event.player)&&player.hasSha();
    },
                content:function (){
        player.draw(2);
        player.chooseToUse({name:'sha'},'谋杀：是否对'+get.translation(trigger.player)+'使用一张杀？',
            trigger.player,-1).set('logSkill','谋杀');
    },
            },
            "弃武":{
                skillAnimation:true,
                audio:["弃武",2],
                unique:true,
                trigger:{
                    source:"damageAfter",
                },
                forced:true,
                filter:function (event,player){
        return player.hp<player.maxHp;
    },
                content:function (){
        player.awakenSkill('弃武');
        player.addSkill('从文');
        player.loseMaxHp();
        player.draw(2);
    },
            },
            "从文":{
                audio:["从文",2],
                enable:"phaseUse",
                usable:5,
                filter:function (event,player){
                for(var i=0;i<game.players.length;i++){
                    if(game.players[i].sex=='male') return true;
                }
                return false;
            },
                content:function (){
                "step 0"
                player.chooseControl(['red','black','basic','trick','equip']).set('ai',function(){
                    var player=_status.event.player;
                    if(player.num('shan')==0) return 'basic';
                    if(player.num('e')<=1) return 'equip';
                    if(player.num('h')>2) return 'trick';
                    return 'red';
                });
                "step 1"
                var num=20;
                var card;
                event.cards=[];
                while(num--){
                    card=get.cards(0);
                    event.cards.push(card);
                    if(get.color(card)==result.control) break;
                    else if(get.type(card,'trick')==result.control) break;
                }
                event.card=card;
                player.showCards(event.cards);
                player.chooseTarget(true,'选择一名男性角色送出'+get.translation(event.card),function(card,player,target){
                    return target.sex=='male';
                });
                "step 2"
                result.targets[0].$gain(event.card);
                for(var i=0;i<cards.length-1;i++){
                    ui.discardPile.appendChild(cards[i]);
                }
                game.delay(0,1000);
                "step 3"
                result.targets[0].gain(event.card);

            },
                ai:{
                    order:9,
                    result:{
                        player:2,
                    },
                    threaten:1.2,
                },
            },
            "玉碎":{
                audio:["玉碎",2],
                filter:function (event,player){
        return event.player!=player&&event.card&&(event.card.name=='sha'||get.type(event.card)=='trick');
    },
                check:function (event,player){
        if(ai.get.attitude(player,event.player)>0){
            return false;
        }
        if(get.tag(event.card,'respondSha')){
            if(player.num('h',{name:'sha'})==0){
                return true;
            }
        }
        else if(get.tag(event.card,'respondShan')){
            if(player.num('h',{name:'shan'})==0){
                return true;
            }
        }
        else if(get.tag(event.card,'damage')){
            if(player.num('h')<2) return true;
        }
        else if(event.card.name=='shunshou'&&player.hp>2){
            return true;
        }
        return false;
    },
                priority:10,
                trigger:{
                    target:"useCardToBefore",
                },
                content:function (){
        "step 0"
        player.loseMaxHp();
        player.recover();
        player.draw();
        "step 1"
        trigger.untrigger();
        trigger.finish();
        "step 2"
        if(trigger.player.num('he')){
          player.discardPlayerCard(2,trigger.player,'he',true);
        }
    },
                ai:{
                    expose:0.3,
                },
            },
            "孤险":{
                audio:["孤险",2],
                trigger:{
                    player:"phaseEnd",
                },
                filter:function (event,player){
        return player.hp<player.maxHp;
    },
                content:function (){
        "step 0"
        event.num=player.maxHp-player.hp;
        player.gainMaxHp(3);
        player.draw(event.num);
        "step 1"
        var check=player.num('h')-event.num;
        player.chooseCardTarget({
            selectCard:event.num,
            filterTarget:function(card,player,target){
                return player!=target;
            },
            ai1:function(card){
                var player=_status.event.player;
                if(player.maxHp-player.hp==1&&card.name=='du') return 30;
                var check=_status.event.check;
                if(check<1) return 0;
                if(player.hp>1&&check<2) return 0;
                return ai.get.unuseful(card)+9;
            },
            ai2:function(target){
                var att=ai.get.attitude(_status.event.player,target);
                if(ui.selected.cards.length==1&&ui.selected.cards[0].name=='du') return 1-att;
                return att-2;
            },
            prompt:'将'+get.cnNumber(event.num)+'张手牌交给一名其他角色',
        }).set('check',check);
        "step 2"
        if(result.bool){
            result.targets[0].gain(result.cards,event.player);
            event.player.$give(result.cards.length,result.targets[0]);
        }
    },
                ai:{
                    threaten:function (player,target){
            if(target.hp==1) return 3;
            if(target.hp==2) return 1.5;
            return 0.5;
        },
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'recover')&&player.hp>=player.maxHp-1) return [0,0];
            },
                    },
                },
            },
            "匡汉":{
                audio:["匡汉",2],
                trigger:{
                    player:"damageEnd",
                },
                content:function (){
        "step 0"
        trigger.source.damage(1,'fire')._triggered=null;
        "step 1"
        for(var i=0;i<game.players.length;i++){
if(game.players[i].group=='shu') game.players[i].recover()._triggered=null;
}
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                    effect:{
                        target:function (card,player){
                if(player.hasSkillTag('jueqing')) return [1,-1];
                if(get.tag(card,'damage')) return [1,0.5];
            },
                    },
                },
            },
            "文昭":{
                audio:["倾国",2],
                trigger:{
                    global:"dieAfter",
                },
                frequent:true,
                content:function (){
        player.draw(3);
        player.uninit;
        player.init(player.name,'魏王称帝');
        player.removeSkill('文昭');
    },
            },
            "横冲":{
                audio:["横冲",2],
                trigger:{
                    player:"damageBegin",
                },
                content:function (){
        player.gainMaxHp(2);
        player.recover(2);
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                    effect:{
                        target:function (card,player){
                if(player.hasSkillTag('jueqing')) return [1,-1];
                if(get.tag(card,'damage')) return [1,0.5];
            },
                    },
                },
            },
            "镇守2":{
                audio:["镇守",2],
                mark:true,
                intro:{
                    content:"cards",
                },
                trigger:{
                    global:"phaseAfter",
                },
                forced:true,
                content:function (){
        player.gain(player.storage.镇守2,'gain2');
        delete player.storage.镇守2;
        player.removeSkill('镇守2');
    },
            },
            "白衣2":{
                trigger:{
                    player:"phaseDiscardBefore",
                },
                audio:["白衣",2],
                forced:true,
                content:function (){
    trigger.untrigger();
    trigger.finish();
},
                mod:{
                    targetEnabled:function (card,player,target){
            if(card.name=='sha'){
                return false;
            }
        },
                },
            },
            "悟法":{
                trigger:{
                    player:"damageBefore",
                },
                group:"悟法2",
                audio:["悟法",2],
                forced:true,
                unique:true,
                filter:function (event){
return event.nature;
},
                content:function (){
trigger.untrigger();
trigger.finish();
player.gainMaxHp();
player.loseHp();
},
            },
            "悟法2":{
                audio:["悟法",2],
                trigger:{
                    player:"useCard",
                },
                frequent:true,
                filter:function (event){
        return (get.type(event.card)=='trick'&&event.cards[0]&&event.cards[0]==event.card);
    },
                content:function (){
        player.recover()._triggered=null;
    },
                ai:{
                    threaten:1.4,
                    noautowuxie:true,
                },
            },
            "锦计":{
                trigger:{
                    player:"dying",
                },
                group:"锦计2",
                audio:["锦计",2],
                priority:7,
                unique:true,
                forced:true,
                filter:function (event,player){
        return player.hp<=0;
    },
                content:function (){
        'step 0'
        player.judge(function(card){
            return get.suit(card)=='heart'?-1:1;
        });
        'step 1'
        if(result.bool){
            player.recover(1-player.hp);
        }
    },
                ai:{
                    threaten:0.8,
                },
            },
            "锦计2":{
                trigger:{
                    player:"damageBegin",
                },
                audio:["锦计",2],
                forced:true,
                priority:-500,
                content:function (){
if(trigger.num>2) trigger.num=2
},
            },
            shenmou:{
                audio:["深谋",2],
                trigger:{
                    source:"damageEnd",
                },
                forced:true,
                unique:true,
                group:"shenmou2",
                mark:true,
                filter:function (event){
        return event.num>0;
    },
                init:function (player){
        player.storage.shenmou=0;
        game.addVideo('storage',player,['shenmou',player.storage.shenmou]);
    },
                content:function (){
        player.storage.shenmou++;
        game.addVideo('storage',player,['shenmou',player.storage.shenmou]);
    },
                intro:{
                    content:"mark",
                },
            },
            "shenmou2":{
                audio:["深谋",2],
                trigger:{
                    player:"phaseDiscardEnd",
                },
                forced:true,
                filter:function (event){
                return event.cards&&event.cards.length>0;
            },
                content:function (){
                player.storage.shenmou+=trigger.cards.length;
                game.addVideo('storage',player,['shenmou',player.storage.shenmou]);
            },
            },
            "伟略":{
                audio:["伟略",2],
                enable:"phaseUse",
                filter:function (event,player){
        return player.storage.shenmou>=15;
    },
                filterTarget:function (card,player,target){
         return player!=target;
},
                content:function (){
        player.storage.shenmou-=15;
        target.clearSkills()._triggered=null;
        target.die()._triggered=null;
    },
                ai:{
                    threaten:1.5,
                    result:{
                        target:function (player,target){
                return -target.num('h');
            },
                    },
                    order:10,
                    expose:0.4,
                },
            },
            "辩论":{
                audio:["辩论",2],
                trigger:{
                    player:"phaseUseBegin",
                },
                direct:true,
                filter:function (event,player){
        return player.countCards('h')>0;
    },
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('辩论'),function(card,player,target){
            return player!=target&&target.countCards('h')>0;
        }).set('ai',function(target){
            return -get.attitude(_status.event.player,target)/target.countCards('h');
        });
        "step 1"
        if(result.bool){
            player.logSkill('辩论',result.targets[0]);
            player.chooseToCompare(result.targets[0]);
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            player.addTempSkill('辩论2','phaseAfter');
        }
        else{
            player.addTempSkill('辩论3','phaseAfter');
        }
    },
                ai:{
                    expose:0.1,
                },
            },
            "辩论2":{
                trigger:{
                    player:"useCard",
                },
                audio:["辩论",2],
                direct:true,
                filter:function (event,player){
        var type=get.type(event.card);
        return type=='basic'||type=='trick';
    },
                content:function (){
        'step 0'
        player.removeSkill('辩论2');
        var goon=false;
        var info=get.info(trigger.card);
        if(trigger.targets&&!info.multitarget){
            var players=game.filterPlayer();
            for(var i=0;i<players.length;i++){
                if(lib.filter.targetEnabled2(trigger.card,player,players[i])&&!trigger.targets.contains(players[i])){
                    goon=true;break;
                }
            }
        }
        if(goon){
            player.chooseTarget('辩论：是否额外指定一名'+get.translation(trigger.card)+'的目标？',function(card,player,target){
                var trigger=_status.event.getTrigger();
                if(trigger.targets.contains(target)) return false;
                return lib.filter.targetEnabled2(trigger.card,_status.event.player,target);
            }).set('ai',function(target){
                var trigger=_status.event.getTrigger();
                var player=_status.event.player;
                return ai.get.effect(target,trigger.card,player,player);
            });
        }
        else{
            if(!info.multitarget&&trigger.targets&&trigger.targets.length>1){
                event.goto(3);
            }
        }
        'step 1'
        if(result.bool){
            game.delay(0.5);
            event.target=result.targets[0];
        }
        else{
            event.finish();
        }
        'step 2'
        if(event.target){
            player.logSkill('辩论',event.target);
            trigger.targets.add(event.target);
        }
        event.finish();
        'step 3'
        player.chooseTarget('辩论：是否减少一名'+get.translation(trigger.card)+'的目标？',function(card,player,target){
            return _status.event.getTrigger().targets.contains(target);
        }).set('ai',function(target){
            var trigger=_status.event.getTrigger();
            return -ai.get.effect(target,trigger.card,trigger.player,_status.event.player);
        });
        'step 4'
        if(result.bool){
            event.targets=result.targets;
            if(event.isMine()){
                player.logSkill('辩论',event.targets);
                event.finish();
            }
            for(var i=0;i<result.targets.length;i++){
                trigger.targets.remove(result.targets[i]);
            }
            game.delay();
        }
        else{
            event.finish();
        }
        'step 5'
        player.logSkill('辩论',event.targets);
    },
            },
            "辩论3":{
                audio:["辩论",2],
                trigger:{
                    player:"useCard",
                },
                frequent:true,
                filter:function (event){
        return (get.type(event.card)=='trick'&&event.cards[0]&&event.cards[0]==event.card);
    },
                content:function (){
        player.draw(2);
        player.recover();
    },
                ai:{
                    threaten:1.4,
                    noautowuxie:true,
                },
            },
            "使臣":{
                audio:["使臣",2],
                trigger:{
                    player:["chooseToCompareAfter","compareMultipleAfter"],
                    target:["chooseToCompareAfter","compareMultipleAfter"],
                },
                filter:function (event,player){
        if(event.preserve) return false;
        if(player==event.player){
            if(event.card1.number>event.card2.number){
                return !get.owner(event.card2);
            }
            else{
                return !get.owner(event.card1);
            }
        }
        else{
            if(event.card1.number<event.card2.number){
                return !get.owner(event.card1);
            }
            else{
                return !get.owner(event.card2);
            }
        }
    },
                check:function (event,player){
        if(player==event.player){
            if(event.card1.number>event.card2.number){
                return event.card2.name!='du';
            }
            else{
                return event.card1.name!='du';
            }
        }
        else{
            if(event.card1.number<event.card2.number){
                return event.card1.name!='du';
            }
            else{
                return event.card2.name!='du';
            }
        }
    },
                content:function (){
        if(player==trigger.player){
            if(trigger.card1.number>trigger.card2.number){
                player.gain(trigger.card2,'gain2');
            }
            else{
                player.gain(trigger.card1,'gain2');
            }
        }
        else{
            if(trigger.card1.number<trigger.card2.number){
                player.gain(trigger.card1,'gain2');
            }
            else{
                player.gain(trigger.card2,'gain2');
            }
        }
    },
                mod:{
                    targetEnabled:function (card,player,target){
            if(get.type(card)=='delay'){
                return false;
            }
        },
                },
            },
        },
        translate:{
            "慷慨":"慷慨",
            "慷慨_info":"每当一名角色成为杀的目标后，你可以摸2张牌回复1点体力。若如此做，你交给其一张牌并展示之，若该牌为装备牌，该角色可以使用此牌。",
            "天火":"天火",
            "天火_info":"限定技，出牌阶段，你可以对一至三名角色造成至多共6点火焰伤害（你可以任意分配每名目标角色受到的伤害点数），若你将对一名角色分配2点或更多的火焰伤害，你须先弃置四张不同花色的手牌再回复1点体力。",
            "琴音":"琴音",
            "琴音_info":"弃牌阶段结束时，若你于此阶段内弃置过你的至少两张手牌，则你可以选择一项：1. 所有角色各回复2点体力然后你摸3张牌；2. 所有角色各失去2点体力然后你增加1点体力上限。",
            "白衣":"白衣",
            "白衣_info":"摸牌阶段，你可以放弃摸牌，改为从牌堆顶亮出10张牌，你获得不同花色的牌各一张，将其余的牌置入弃牌堆。你不能成为杀的指定目标，你始终跳过弃牌阶段",
            "圣光":"圣光",
            "圣光_info":"出牌阶段，你可以观看其的手牌，并可以展示其中一张红桃牌，然后选择弃置与牌堆顶,你摸2张牌或弃置之你回复1点体力，每阶段限3次。",
            "归心":"归心",
            "归心_info":"每当你受到1次伤害或体力流失后，若至少一名其他角色的区域里有牌，你可以选择所有其他角色，获得这些角色区域里的2张牌，然后将你的武将牌翻面。",
            "千影":"千影",
            "千影_info":"回合外，你可以将一张牌当[桃]使用，其他角色与你计算距离始终+2",
            "星辰":"星辰",
            "星辰_info":"准备阶段开始时，多发你20张牌，选择10张面朝下置于一旁（移出游戏），称之为“星”。每当你失去最后1张手牌时，你将手牌摸至体力上限",
            "晨雾":"晨雾",
            "晨雾_info":"结束阶段开始时，你可以将至少一张“星”置入弃牌堆并选择等量的角色，若如此做，其于你的下回合开始之前受到的非雷电伤害结算开始时，你防止此伤害。同时免疫体力流失伤害",
            "暴风":"暴风",
            "暴风_info":"结束阶段开始时，你可以将一张“星”置入弃牌堆并选择一名角色，若如此做，其受到的火焰伤害结算开始时，你令伤害值+2。",
            "暴走":"暴走",
            "暴走_info":"锁定技，游戏开始时，你获得四枚“暴走”标记，；锁定技，每当你造成/受到1点伤害后，你获得1枚\"暴走\"标记。（失去体力不会发动暴走）",
            "神怒":"神怒",
            "神怒_info":"出牌阶段,你可弃枚6“暴走”标记并选择所有其他角色，对这些角色各造成2点伤害，然后这些角色先各弃置装备区里的所有牌再各弃置6张手牌，你翻面。",
            "无前":"无前",
            "无前_info":"出牌阶段，你可以弃2枚\"暴走\"标记并选择一名其他角色，你视为拥有技能“无双”并令其防具无效，直到回合结束。",
            "邪神":"邪神",
            "邪神_info":"你拥有邪神面具的效果",
            "放生":"放生",
            "放生_info":"每当你受到伤害时，你可令伤害来源进行判定，若为黑色其失去2点体力上限，若为红色，你摸2张牌并增加1点体力上限",
            "送葬":"送葬",
            "送葬_info":"当其他角色死亡后，你可以摸5张牌并回复全部体力",
            "颂威":"颂威",
            "颂威_info":"其他魏国角色判定若结果为黑桃或梅花，可让你摸一张牌",
            "魔神":"魔神",
            "魔神_info":"",
            "chenwu3":"晨雾",
            "chenwu3_info":"",
            "chenwu2":"晨雾",
            "chenwu2_info":"",
            "baofeng2":"暴风",
            "baofeng2_info":"",
            "宏图":"宏图",
            "宏图_info":"每当你受到伤害或流失体力后，你可以令一名角色进行一次判定，若结果为红色，该角色回复1点体力；若结果为黑色，该角色增加X点体力上限并摸x张牌（X为此次伤害的伤害数）",
            "明主":"明主",
            "明主_info":"出牌阶段限一次，你可以将所有手牌交给一名其他角色，若如此做，该角色于其下个回合的手牌上限+2,并与其他角色计算距离-2，然后你回复1点体力",
            "mingzhu2":"明主",
            "mingzhu2_info":"",
            "兴衰":"兴衰",
            "兴衰_info":"主公技，限定技，当你进入濒死状态时，其他魏势力角色可依次令你回复1点体力，然后这些角色依次受到1点伤害",
            "情逝":"情逝",
            "情逝_info":"锁定技，当你的手牌数小于X时，你立即将手牌补至X张（X为你已损失的体力值），每次触发此效果都会增加1点体力上限并回复1点体力",
            "无情":"无情",
            "无情_info":"锁定技，你即将造成的伤害均视为失去体力.",
            "songwei5":"颂威",
            "songwei5_info":"",
            "死战":"死战",
            "死战_info":"出牌阶段，你可以将所有手牌当【决斗】使用，结算后你和以此法受到伤害的角色各摸一张牌。若你在同一阶段内以此法摸了五张或更多的牌，则此技能失效直到回合结束",
            "sizhan2":"死战",
            "sizhan2_info":"",
            "sizhan3":"死战",
            "sizhan3_info":"",
            "sizhan4":"死战",
            "sizhan4_info":"",
            "北地王":"北地王",
            "北地王_info":"主公技，你可以弃置一张牌，然后视为你发动“激将”。若有角色响应，则该角色打出【杀】时摸一张牌",
            "beidi1":"北地王",
            "beidi1_info":"",
            "beidi2":"北地王",
            "beidi2_info":"",
            "血舞":"血舞",
            "血舞_info":"出牌阶段，你可弃置一张红色牌并选择你攻击范围内的至多X名其他角色，对这些角色各造成2点神圣火焰（X为你已损失的体力值），然后这些角色各弃置2张牌,.每阶段限2次。",
            "龙啸":"龙啸",
            "龙啸_info":"锁定技，你于出牌阶段内每使用一张【杀】被【闪】抵消，你于此阶段内可以摸一张牌，获得武圣，无双，咆哮直到回合结束",
            "继武":"继武",
            "继武_info":"觉醒技，回合结束阶段开始时，若你于此回合内已造成3点或更多伤害，你加1点体力上限，回复1点体力摸3张牌，然后失去技能“龙啸”,获得技能'武圣'",
            "惊鸿":"惊鸿",
            "惊鸿_info":"准备阶段和回合结束阶段，你可以进行一定判定，若为红色则可以继续判定，直到出现红色。然后你获得所有红色的判定牌",
            "qing2":"倾国",
            "qing2_info":"",
            "qing1":"倾国",
            "qing1_info":"你计算与其他角色距离时-x,x=在此存活的男性角色数量;你使用黑色杀不可以被闪响应",
            "qing4":"倾国",
            "qing4_info":"",
            "狼顾":"狼顾",
            "狼顾_info":"当你受到伤害时，可以获得伤害来源的一张牌并摸1张牌然后回复1点体力，你的手牌上限加4",
            "改命":"改命",
            "改命_info":"在任意角色的判定牌生效前，你可以打出一张牌代替之并摸1张牌回复1点体力",
            "变阵":"变阵",
            "变阵_info":"你可以弃一张手牌来跳过自己的一个阶段(回合开始和回合结束阶段除外);若以此法跳过摸牌阶段,你可以从其他至多两名角色手里各抽取一张牌并回复1点体力;若以此法跳过出牌阶段,你可以将场上的一张牌移动到另一个合理的位置并摸1张牌。若跳过弃牌阶段则增加1点体力上限，若跳过判定阶段则回复1点体力",
            "bianzhen1":"变阵",
            "bianzhen1_info":"",
            "bianzhen2":"变阵",
            "bianzhen2_info":"",
            "bianzhen3":"变阵",
            "bianzhen3_info":"",
            "bianzhen4":"变阵",
            "bianzhen4_info":"",
            songwen:"颂文",
            "songwen_info":"出牌阶段，你可以选择一项：令一名手牌数小于其体力值的角色摸两张牌；或令一名手牌数大于其体力值的角色弃置两张牌。出牌阶段限5次",
            "口诛":"口诛",
            "口诛_info":"回合结束阶段开始时，你可以将一张手牌移出游戏并指定一名其他角色。该角色的回合开始时，其观看你移出游戏的牌并选择一项：交给你一张与此牌同类型的手牌并获得此牌；或将此牌置入弃牌堆，然后失去1点体力失去1点体力上限，摸两张牌。",
            "kouzhu2":"口诛",
            "kouzhu2_info":"",
            "突进":"突进",
            "突进_info":"其他角色的结束阶段开始时，你可以弃置一张牌，令该角色选择一项：1.弃置一张装备牌并令你摸2张牌并回复1点体力；2.受到你对其造成的1点伤害并失去1点体力上限。",
            "赤魂":"赤魂",
            "赤魂_info":"你可以将一张红色牌当[杀]使用或打出，回合结束你可以摸2张牌，你无视其防具",
            "chi2":"赤魂",
            "chi2_info":"",
            "chi3":"赤魂",
            "chi3_info":"",
            "淑德":"淑德",
            "淑德_info":"每名角色的回合，你的回合外，每当有其他角色因弃置而失去牌时，若其中有基本牌，你可以摸一张牌。",
            "枪魂":"枪魂",
            "枪魂_info":"出牌阶段你可以进行判定，若为黑色则摸3张杀并获得技能咆哮直到回合结束;若为红色则摸3张牌，并将体力恢复至体力上限.",
            "谣言":"谣言",
            "谣言_info":"出牌阶段限一次，你可以弃置一张牌并指定一名角色，你对其造成2点伤害。",
            "控蛮":"控蛮",
            "控蛮_info":"当你对一名其他角色造成伤害时，你可以防止此伤害，然后获得其2张牌。",
            "象阵":"象阵",
            "象阵_info":"【南蛮入侵】对你无效；若其他角色使用的【南蛮入侵】在结算完时进入弃牌堆，你立即获得之并回复1点体力。你使用南蛮入侵造成的伤害+2",
            "xiangzhen1":"象阵",
            "xiangzhen1_info":"",
            "xiangzhen2":"象阵",
            "xiangzhen2_info":"",
            "xiangzhen3":"象阵",
            "xiangzhen3_info":"你使用杀伤害加1",
            "巨刃":"巨刃",
            "巨刃_info":"你每使用【杀】造成一次伤害，可与受到该伤害的角色拼点；无论输赢其受到2点火焰伤害.",
            "抛戟":"抛戟",
            "抛戟_info":"出牌阶段，你可以自减一点体力增加1点体力上限并摸一张牌或弃一张装备牌，然后你对你攻击范围内的一名角色造成2点体力流失伤害并减少1点体力上限，每回合限一次。你每失去装备区里的牌时回复1点体力",
            "pao1":"抛戟",
            "pao1_info":"每当你失去一张装备牌，可以摸两张牌",
            "王佐":"王佐",
            "王佐_info":"你每受到1点伤害，可令任意2名角色将手牌补至其体力上限的张数。",
            "驱虎吞狼":"驱虎吞狼",
            "驱虎吞狼_info":"出牌阶段，你可以与一名体力不等于你的角色拼点，若你赢，则该角色对其攻击范围内另一名由你指定的角色造成1点伤害。若你没赢，他/她对你造成一点伤害。每回合限用3次。",
            qibing:"奇兵",
            "qibing_info":"每当有顺手牵羊进入弃牌堆时，你获得之并回复1点体力摸一张牌，你计算与全场角色距离为1",
            "qibing2":"奇兵",
            "qibing2_info":"当计算你与其它角色的距离时，始终-1",
            "天险":"天险",
            "天险_info":"当你成为决斗的目标时，可以让对方失去1点体力，其他角色与你计算距离始终+5",
            "积粮":"积粮",
            "积粮_info":"你的回合外，你每失去1张牌，可以摸一张牌",
            "抬棺":"抬棺",
            "抬棺_info":"出牌阶段，你可以弃置一张黑色牌并选择一名有牌的其他角色，该角色弃置2张牌且你摸一张牌，然后你视为对其使用决斗并回复1点体力",
            "鬼武":"鬼武",
            "鬼武_info":"你可以将一张黑色牌当[杀]使用",
            "护行":"护行",
            "护行_info":"觉醒技，准备阶段开始时，若你的手牌数大于你的体力值，你减1点体力上限，然后获得“马术”和“过关斩将”",
            "过关斩将":"过关斩将",
            "过关斩将_info":"你使用锦囊牌转化的杀不计入次数且摸一张牌;你是用装备牌转化的杀造成的伤害+2,且回复2点体力",
            "guoguanzhanjiang2":"过关斩将",
            "guoguanzhanjiang2_info":"",
            "怂乱":"怂乱",
            "怂乱_info":"限定技，出牌阶段，你可以将一张黑色手牌交给一名其他角色，并选择一名攻击范围内含有其的另一名其他角色，然后令这两名角色拼点，赢的角色弃置两张牌，没赢的角色失去一点体力",
            "千虑":"千虑",
            "千虑_info":"限定技，当你受到伤害后，你可令一名其他男性角色增加一点体力上限摸4张牌，然后若该角色的武将牌上有主公技且其不为主公，其获得此主公技",
            "旧情":"旧情",
            "旧情_info":"当一名角色处于濒死状态时，你可以令另一名其他角色摸8张牌，然后弃置四张牌。若其以此法弃置的四张牌花色各不相同，则视为该角色对濒死的角色使用一张【桃】",
            "默书":"默书",
            "默书_info":"结束阶段开始时，你可以将一张手牌当你本回合出牌阶段使用的第一张基本或非延时类锦囊牌使用。然后，你可以将一张手牌当你本回合出牌阶段使用的第二张基本或非延时类锦囊牌使用，然后，你可以将一张手牌当你本回合出牌阶段使用的第3张基本或非延时类锦囊牌使用，然后，你可以将一张手牌当你本回合出牌阶段使用的第4张基本或非延时类锦囊牌使用",
            "moshu2":"默书",
            "moshu2_info":"",
            "moshu3":"默书",
            "moshu3_info":"",
            "战勋":"战勋",
            "战勋_info":"锁定技，每当一名角色死亡后，你增加2点体力上限，回复一点体力，摸3张牌。",
            "举兵":"举兵",
            "举兵_info":"觉醒技，准备阶段开始时，若你已受伤且体力上限大于存活角色数，你须将手牌摸至体力上限，然后获得技能“内乱”和“危重”。",
            "危重":"危重",
            "危重_info":"当你的体力值或体力上限发生变化时，你摸一张牌",
            "内乱":"内乱",
            "内乱_info":"回合结束阶段，你可以弃置2张牌并回复1点体力，若不足2则全弃，若没有手牌直接回复1点体力",
            "伏兵":"伏兵",
            "伏兵_info":"每名角色结束和回合阶段开始时，你先摸2张牌，然后将1张手牌移出游戏，称为\"陷阱\"。然后为\"陷阱\"记录一个基本牌或锦囊牌名称（须与其他\"陷阱\"记录的名称均不同）。你的回合外，当有其他角色使用与你记录的\"陷阱\"牌名相同的牌时，你可以令此牌无效且你增加1点体力上限，然后将该\"陷阱\"置入弃牌堆",
            "fubing2":"伏兵",
            "fubing2_info":"",
            "刚直":"刚直",
            "刚直_info":"每当你受到伤害后，若你的手牌数不大于伤害来源手牌数，你可以将手牌摸至与伤害来源手牌数相同；否则你可以弃置伤害来源手牌数的手牌，然后对其造成2点伤害且你回复1点体力",
            "镇守":"镇守",
            "镇守_info":"当一名其他角色成为【杀】或锦囊牌的目标时（使用者不是你），若该角色的体力值小于你且此牌的目标角色数为1，你可以弃置一张牌。若如此做，你选择一项：1、摸2张牌，然后将此【杀】或锦囊牌转移给你；2、令此【杀】或锦囊牌无效，然后将此【杀】或锦囊牌置于使用者的武将牌旁，若如此做，当前回合结束后，使用者获得使用者武将牌旁的这些牌",
            "仁爱":"仁爱",
            "仁爱_info":"每当体力值为1的一名其他角色受到伤害时，你可以弃置一张装备牌，然后防止此伤害。然后你增加1点体力上限，回复1点体力",
            "神童":"神童",
            "神童_info":"每当你受到一次伤害或体力流失后，你可以亮出牌堆顶的8张牌。然后获得其中任意数量点数之和小于16的牌，将其余的牌置入弃牌堆。",
            "精算":"精算",
            "精算_info":"出牌阶段结束时，若你本回合使用的牌数量小于或等于你当前体力值，你可以摸本回合你使用过的数量的牌。",
            "can2":"迂回",
            "can2_info":"",
            "迂回":"迂回",
            "迂回_info":"当你于回合内使用基本牌或锦囊牌或装备牌指定目标后，你可以弃置一名角色的一张牌。若如此做，你摸一张牌",
            "趋向":"趋向",
            "趋向_info":"结束阶段开始时，你可以摸X张牌，若如此做，你将手牌弃置至X张；你可以再次发动趋向，增加1点体力上限，回复x点体力（X为你于此回合发动过“迂回”的次数）",
            "quxiang2":"趋向",
            "quxiang2_info":"结束阶段开始时，你可以摸两张牌，若如此做，你将手牌弃置至X张（X为你于此回合发动过“奇制”的次数）",
            "落梅":"落梅",
            "落梅_info":"当其他角色的牌，因弃牌或判定而进入弃牌堆时，你可以获得之。每获得一张你回复1点体力",
            "luomei1":"落梅",
            "luomei1_info":"",
            "luomei2":"落梅",
            "luomei2_info":"",
            "妙笔":"妙笔",
            "妙笔_info":"若你的武将牌正面朝上，你可以(在合理的时机)将你的武将牌翻面来视为使用一张【桃】并回复1点体力;当你的武将牌背面朝上时你受到伤害，你可在伤害结算后将之翻回正面并增加1点体力上限摸两张牌。",
            "miaobi1":"妙笔",
            "miaobi1_info":"",
            "miaobi2":"妙笔",
            "miaobi2_info":"",
            "miaobi3":"妙笔",
            "miaobi3_info":"",
            "严整":"严整",
            "严整_info":"结束阶段开始时，你可以弃置一张手牌，然后令一名其他角色选择一项：将一张牌置于你的武将牌上并让你回复3点体力；或令你弃置其一张牌并让你摸3张牌。你武将牌上有牌时，你可以将红色手牌当【桃】、黑色的手牌当【南蛮入侵】使用或打出。准备阶段开始时，你获得你武将牌上的牌。",
            "yanzheng1":"严整",
            "yanzheng1_info":"",
            "yanzheng2":"严整",
            "yanzheng2_info":"",
            "yanzheng3":"严整",
            "yanzheng3_info":"",
            "yanzheng4":"严整",
            "yanzheng4_info":"",
            "外愚":"外愚",
            "外愚_info":"每当你受到一次伤害后，你可以摸一张牌，然后展示所有手牌，若颜色均不同，伤害来源弃置一张手牌，你回复1点体力，摸一张牌。",
            "妙策":"妙策",
            "妙策_info":"出牌阶段，你可以将所有的手牌（至少一张）当做任意一张非延时性锦囊牌使用。",
            "起兵":"起兵",
            "起兵_info":"觉醒技，准备阶段开始时，若“权”的数量不小于9，你减1点体力上限，选择一项：1、摸4张牌增加4点体力上限；2、增加1点体力上限回复3点体力。然后你获得“族裔”。",
            "权宜":"权宜",
            "权宜_info":"每当你受到1点伤害或体力流失后，你可以可摸2张牌回复1点体力，然后将y张手牌置于武将牌上，称为“权”；你的手牌上限+X（X为“权”的数量x2）y为本次受到的伤害。",
            "族裔":"族裔",
            "族裔_info":"出牌阶段限1次，你可以移去一张权，选择一名角色，让其增加1点体力上限摸2张牌",
            "酷法":"酷法",
            "酷法_info":"出牌阶段限一次，你可以弃置至少一张手牌并选择一名其他角色，该角色需弃置一张与你弃置的牌类别均不同的手牌，否则其先将其武将牌翻面再失去x体力，减少1点体力上限（X为你以此法弃置的手牌数量）。",
            "御敌":"御敌",
            "御敌_info":"每当你受到一次伤害，可以弃置一张手牌，并令伤害来源选择一项：弃置一张相同类型的手牌并令你摸一张牌并让你增加1点体力上限，或令你回复一点体力摸一张牌",
            "制敌":"制敌",
            "制敌_info":"其他角色出牌阶段开始时，你可以弃置一张与你装备区里的牌颜色相同的非基本牌，然后该角色于此阶段内不能使用和打出与此牌颜色相同的牌。此阶段结束时，若其此阶段没有使用【杀】，视为你对其使用了【杀】，若你没有装备防具，则杀对你无效",
            "zhidi2":"制敌",
            "zhidi2_info":"",
            "zhidi6":"制敌",
            "zhidi6_info":"锁定技，当你没有防具时，黑色的杀对你无效",
            "中正":"中正",
            "中正_info":"出牌阶段限5次，你可以弃置一张手牌，然后令一名已受伤的角色进行一次判定，若结果为黑色，该角色摸X张牌(X为该角色已损失的体力值)，然后你本回合不能再对其发动“定品”；若结果为红色，将你的武将牌翻面并流失1点体力。",
            "zhongzheng2":"中正",
            "zhongzheng2_info":"",
            "法定":"法定",
            "法定_info":"每当一名角色的武将牌翻面或流失体力时，你可以令其将手牌补至体力上限，然后回复1点体力。",
            "驹骑":"驹骑",
            "驹骑_info":"锁定技，若你已受伤，你计算与其他角色距离时-X，其他角色与你计算距离+x（X为你已损失体力值）",
            "虎豹":"虎豹",
            "虎豹_info":"当你使用【杀】对目标角色造成伤害时，若你的装备区里有武器牌，你可以令其选择一项：1、弃置X张手牌（X为此武器牌的攻击范围），若如此做，其弃置你的此武器牌；2、令此伤害+3",
            "墨心":"墨心",
            "墨心_info":"每当你需要使用一张本回合内未使用过的牌时，你可以将一张黑色非基本牌置于牌堆顶，然后视为你使用了此牌，若你在回合外触发此技能打出闪则你可以摸2张牌",
            "moxin_count":"墨心",
            "moxin_count_info":"",
            "moxin2":"墨心",
            "moxin2_info":"",
            "moxin_count2":"墨心",
            "moxin_count2_info":"",
            "moxin_sha":"墨心",
            "moxin_sha_info":"",
            "moxin_tao":"墨心",
            "moxin_tao_info":"",
            "moxin_jiu":"墨心",
            "moxin_jiu_info":"",
            "moxin_sha_old":"墨心",
            "moxin_sha_old_info":"",
            "moxin_tao_old":"墨心",
            "moxin_tao_old_info":"",
            "moxin_jiu_old":"墨心",
            "moxin_jiu_old_info":"",
            "辅佐":"辅佐",
            "辅佐_info":"每当一名其他角色于其出牌阶段内使用黑色牌指定目标后，则你可以摸一张牌回复1点体力然后你翻面",
            "诏书":"诏书",
            "诏书_info":"出牌阶段，(限五次)你可以展示一张手牌，然后选择距离最近的一名其他角色，该角色声明一张基本牌的牌名。在此出牌阶段内，你可以将此手牌当声明的牌使用且你不能被选择为目标",
            "zhaoshu2":"诏书",
            "zhaoshu2_info":"",
            "zhaoshu3":"诏书",
            "zhaoshu3_info":"",
            "禅心":"禅心",
            "禅心_info":"当你受到伤害或流失体力后，你可以摸一张牌回复1点体力，或对“矫诏”的描述依次执行下列一项修改：1.将“基本牌”改为“基本牌或锦囊牌”；2.将“选择距离最近的一名其他角色，该角色”改为“你”",
            "pilang2":"劈浪",
            "pilang2_info":"你受到伤害后，你可以令对你造成伤害的角色翻面，然后你摸一张牌增加1点体力上限",
            "劈浪":"劈浪",
            "劈浪_info":"摸牌阶段，多摸你损失体力的牌，你受到伤害后可以摸一张牌增加1点体力上限",
            "雄才":"雄才",
            "雄才_info":"每当你受到伤害或失去体力后，你可以选择一项：摸一张牌回复2点体力，或获得对你造成伤害的牌并增加1点体力上限。",
            "护主":"护主",
            "护主_info":"主公技，魏势力角色可以替你打出[闪]",
            "料敌":"料敌",
            "料敌_info":"每当你受到1点伤害或失去体力上限和失去体力后，你可以获得伤害来源的1张牌并令其受到2点神圣伤害。",
            "谋士":"谋士",
            "谋士_info":"在任意角色的判定牌生效前，你可以先增加1点体力上限，然后可以打出一张牌代替之",
            "獠牙":"獠牙",
            "獠牙_info":"回合开始和结束时，你可以选择1~5名手牌与你不等的其他角色，获得这些角色的各一张手牌。",
            "偷营":"偷营",
            "偷营_info":"锁定技，你不能成为[兵粮寸断]，[乐不思蜀],[闪电]的目标",
            "虎痴":"虎痴",
            "虎痴_info":"你可以跳过摸牌阶段，然后展示牌堆顶的10张牌，获得其中的基本牌、武器牌和【决斗】，若如此做，直到你的下回合开始，你为伤害来源的【杀】或【决斗】造成的伤害+2。",
            "huchi2":"虎痴",
            "huchi2_info":"",
            "狂拳":"狂拳",
            "狂拳_info":"锁定技，你不能成为[兵粮寸断],[乐不思蜀],[过河拆桥],[闪电]的目标",
            "惊天":"惊天",
            "惊天_info":"你可以立即获得你的判定牌，然后你摸x张牌，且本回合跳过弃牌阶段并将体力值回复至体力上限，x=你损失的体力",
            "jingtian2":"惊天",
            "jingtian2_info":"你始终跳过弃牌阶段",
            "遗策":"遗策",
            "遗策_info":"每当你受到1点伤害后，你可以摸x张牌。然后你可以在至多两名角色的武将牌旁边分别扣置至多两张手牌，这些角色的下个摸牌阶段开始时，该角色获得其武将牌旁的这些牌。x=你损失的体力，你受到的伤害至多为1",
            "yice2":"遗策",
            "yice2_info":"",
            "yice3":"遗策",
            "yice3_info":"你受到的伤害至多为1",
            "厚兵":"厚兵",
            "厚兵_info":"摸牌阶段，你可以放弃摸牌，改为观看牌堆顶的五张牌，然后获得其中的三张牌，将其余的牌以任意顺序置于牌堆底。",
            "破虏":"破虏",
            "破虏_info":"每当你对其他角色造成1点伤害后，或受到其他角色造成的1点伤害和体力流失后，你可与该角色各摸一张牌，然后你回复本次伤害的体力值，随机获得其一项技能",
            "gui1":"鬼雄",
            "gui1_info":"你可以立即获得对你造成伤害或体力流失的牌,并增加1点体力上限回复1点体力",
            "护驾":"护驾",
            "护驾_info":"主公技，魏势力角色可以替你打出[闪]",
            fangu:"反骨",
            "fangu_info":"锁定技，每当你造成一点伤害，你回复一点体力，你的回复效果+1",
            "善谋":"善谋",
            "善谋_info":"限定技，出牌阶段，你可以失去任意点体力，然后直到回合结束，你计算与其他角色的距离-X，且你可以多使用X张【杀】（X为你失去的体力值）x最多为9",
            "shanmou2":"善谋",
            "shanmou2_info":"",
            "fangu2":"反骨",
            "fangu2_info":"",
            "xingchen7":"星辰",
            "xingchen7_info":"每当你失去最后一张手牌，可摸一张牌",
            "病疾":"病疾",
            "病疾_info":"出牌阶段限一次，你可以弃置X张牌（X为你已损失的体力值），然后令至多X名已受伤的角色各回复1点体力摸一张牌。若你以此法弃置的牌中有黑色牌，你增加一点体力上限摸2张牌。",
            "兵谋":"兵谋",
            "兵谋_info":"每当一名角色的手牌于回合外被弃置时，你可以令该角色摸两张牌增加1点体力然后你弃置2张手牌。",
            "烈帝":"烈帝",
            "烈帝_info":"出牌阶段限10次，你可以将任意手牌送给其他角色，若送出的手牌不少于两张，你回复一点体力摸一张牌",
            "liedi1":"烈帝",
            "liedi1_info":"",
            "亲征":"亲征",
            "亲征_info":"主公技，蜀势力角色可以帮你使用或打出[杀]",
            "qinzheng1":"亲征",
            "qinzheng1_info":"",
            "qinzheng2":"亲征",
            "qinzheng2_info":"",
            "qinzheng3":"亲征",
            "qinzheng3_info":"",
            "险计":"险计",
            "险计_info":"锁定技，当你没有手牌时，不能成为[杀]，[决斗]，[万箭齐发],[南蛮入侵]的目标",
            "xianji1":"险计",
            "xianji1_info":"",
            "星象":"星象",
            "星象_info":"回合开始和回合结束阶段，你可以观看牌堆顶的x张牌，并将其以任意顺序置于牌堆项或牌堆底，x为存活角色个数且不超过5",
            "铁索":"铁索",
            "铁索_info":" 你可以将一张黑色手牌当重铸使用，你摸一张牌，回复1点体力",
            "tiesuo1":"铁索",
            "tiesuo1_info":"",
            "tiesuo2":"铁索",
            "tiesuo2_info":"",
            "落凤":"落凤",
            "落凤_info":"限定技，出牌阶段或当你处于濒死状态时，你可以丢弃你所有的牌和你判定区里的牌，并重置你的武将牌，然后体力回复至体力上限",
            "燃火":"燃火",
            "燃火_info":"出牌阶段，你可以将你的任意一张♥或♦手牌当【火攻】使用。你防止受到火焰伤害，且改为增加1点体力上限",
            "ranhuo2":"燃火",
            "ranhuo2_info":"锁定技，你防止即将受到的火焰伤害，改为回复1点体力",
            "八卦":"八卦",
            "八卦_info":"当你没装备防具时，始终视为你装备着【八卦阵】。你防止受到的雷电伤害，并回复2点体力摸一张牌",
            "yiqunbagua2":"八卦",
            "yiqunbagua2_info":"",
            "看穿":"看穿",
            "看穿_info":"你可以将你的任意一张♠或♣手牌当【无懈可击】使用。你使用或打出的黑色锦囊不能被无懈可击响应",
            "kanchuan2":"看穿",
            "kanchuan2_info":"锁定技，你使用的非延时类锦囊牌不能被无懈可击响应；你不能成为其他角色的延时类锦囊的目标",
            "胆略":"胆略",
            "胆略_info":"出牌阶段，你可以指定一名使用【杀】能攻击到你的角色，该角色需对你使用一张【杀】，若该角色不如此做，你弃掉他的2张牌并让其失去1点体力上限，每回合限一次。",
            "承志":"承志",
            "承志_info":"觉醒技，回合开始阶段，若你手牌大于或等于4，你须回复体力至体力上限或摸10张牌，然后减1点体力上限，并永久获得技能“麒麟”。",
            "麒麟":"麒麟",
            "麒麟_info":"你的红色手牌可以当决斗使用，你的黑色手牌可以当无懈可击使用，你不能被乐不思蜀，兵粮寸断，闪电选作目标",
            "qilin2":"麒麟",
            "qilin2_info":"你可以将你的任意一张♠或♣手牌当【无懈可击】使用。",
            "qilin3":"麒麟",
            "qilin3_info":"锁定技，你不能成为[顺手牵羊]和[乐不思蜀]的目标",
            "后主":"后主",
            "后主_info":"锁定技，当其他玩家使用【杀】指定你为目标时，需额外弃掉一张基本牌，否则该【杀】对你无效并且你可以摸一张牌。",
            "简政":"简政",
            "简政_info":"你可跳过你的出牌阶段并摸一张牌，若如此做，在回合结束时可弃一张手牌令一名其他角色进行一个额外的回合。",
            "jianzheng2":"简政",
            "jianzheng2_info":"",
            "jianzheng3":"简政",
            "jianzheng3_info":"",
            "愚智":"愚智",
            "愚智_info":"主公技，觉醒技，回合开始阶段，若你的体力是全场最少的(或之一)，你须增加1点体力上限，回复1点体力，并永久获得技能“栋梁”。",
            "栋梁":"栋梁",
            "栋梁_info":"锁定技，你在回合结束后随机获得一个蜀势力角色的所有技能",
            "助威":"助威",
            "助威_info":"当一名角色于其出牌阶段内回复体力时，你可以选择一项：1、你摸2张牌；2、令该角色摸两张牌回复1点体力 ",
            "归吴":"归吴",
            "归吴_info":"觉醒技，准备阶段开始时，若全场有至少一名已受伤且你曾发动【助威】令其摸牌的角色，则你回复1点体力，流失3点体力，获得技能【观武】",
            "观武":"观武",
            "观武_info":"每当你失去一张装备牌，可以获得诸葛连弩并回复1点体力，每回合限3次触发",
            "虎将":"虎将",
            "虎将_info":"锁定技，若你的体力值为7或更少，你视为拥有技能“叫阵”；若你的体力值为5或更少；你视为拥有技能“横扫”；若你的体力值小于或等于3，你视为拥有技能“清兵”。",
            "叫阵":"叫阵",
            "叫阵_info":"出牌阶段，你可以指定一名使用【杀】能攻击到你的角色，该角色需对你使用一张【杀】，若该角色不如此做，你弃掉他的一张牌并让其翻面，每回合限一次。",
            "横扫":"横扫",
            "横扫_info":"你使用杀可以额外指定3名角色为目标，你使用杀无限次数，你对其造成伤害后其必须弃置1张牌",
            "清兵":"清兵",
            "清兵_info":"你可以选择一至三项：1. 跳过判定阶段和摸牌阶段；2. 跳过出牌阶段并弃置一张装备牌；3. 跳过弃牌阶段。你每选择一项，视为你对一名其他角色使用一张【杀】",
            "qingbing1":"清兵",
            "qingbing1_info":"",
            "qingbing2":"清兵",
            "qingbing2_info":"",
            "qingbing4":"清兵",
            "qingbing4_info":"",
            "协睦":"协睦",
            "协睦_info":"每当你成为其他角色的黑色牌的目标，可以弃置一张杀并摸3张牌并增加1点体力上限，南蛮入侵和万箭齐发对你无效",
            "zhishixiemu2":"协睦",
            "zhishixiemu2_info":"锁定技，你不能成为[顺手牵羊]和[乐不思蜀]的目标",
            "蛮兵":"蛮兵",
            "蛮兵_info":"你可以获得其他角色打出的杀，你使用或打出杀无次数限制",
            "manbing2":"蛮兵",
            "manbing2_info":"出牌阶段，你使用[杀]无数量限制",
            "恩仇":"恩仇",
            "恩仇_info":"当你获得一名其他角色两张或更多的牌后，你可以令其摸1张牌回复1点体力；当你受到1点伤害或流失体力后，你可以令伤害来源选择一项：1、将2张手牌交给你；2、失去1点体力上限并流失1点体力",
            "enchou2":"恩仇",
            "enchou2_info":"",
            "辅翼":"辅翼",
            "辅翼_info":"摸牌阶段开始时，你可以放弃摸牌并选择一名其他角色。若如此做，该角色摸三张牌，然后该角色需对其攻击范围内你选择的另一名角色使用一张【杀】，否则你获得其两张牌",
            "不言":"不言",
            "不言_info":"锁定技，每当你受到锦囊牌对你造成的伤害时，你防止此伤害然后你摸一张牌增加1点体力上限。",
            "洞察":"洞察",
            "洞察_info":"回合结束阶段开始时，你可以弃置一张牌并选择一名其他角色，令其选择一项：1.摸五张牌；2.回复五点体力；3.将其武将牌翻转至正面朝上并重置之。",
            "先锋":"先锋",
            "先锋_info":"锁定技，回合开始和结束时，你摸3张牌然后执行一个额外的出牌阶段",
            "迟暮":"迟暮",
            "迟暮_info":"限定技，当你处于濒死状态时，可以将体力回复至体力上限，然后摸5张牌",
            "xianfeng2":"先锋",
            "xianfeng2_info":"锁定技，回合开始和结束时，你执行一个额外的出牌阶段",
            "青龙":"青龙",
            "青龙_info":"每当一名角色在其出牌阶段使用【杀】时，你可弃置一张牌令此【杀】不计入出牌阶段使用次数，若此【杀】为红色，你摸2张牌，你的红色手牌可以当杀使用",
            "qinglong3":"青龙",
            "qinglong3_info":"你可以将一张红色牌当[杀]使用",
            "潜行":"潜行",
            "潜行_info":"回合开始阶段，你可以摸三张牌，并弃置一张牌，然后令一名距离为1的角色不能使用或打出与你弃置的牌颜色相同的手牌，直到回合结束；当你使用【杀】对距离为1的目标角色造成伤害时，你可以进行一次判定，若判定结果不为红桃，你防止此伤害，令其减1点体力上限",
            "qianxing2":"潜行",
            "qianxing2_info":"回合开始阶段，你可以摸一张牌，并弃置一张牌，然后令一名距离为1的角色不能使用或打出与你弃置的牌颜色相同的手牌，直到回合结束。",
            "qianxing3":"潜行",
            "qianxing3_info":"",
            "危嗣":"危嗣",
            "危嗣_info":"准备阶段开始时，你可以将一至两名角色的各三张牌置于你的武将牌上，称为“危”；每当一名角色需要对你使用杀时，该角色可以将两张“危”置入弃牌堆，视为对你使用一张杀。",
            "weisi2":"危嗣",
            "weisi2_info":"",
            "过目":"过目",
            "过目_info":"出牌阶段开始时，你可以展示一名其他角色的一张手牌。若如此做，每当你于此阶段内使用与此牌类别相同的牌时，你可以摸两张牌回复1点体力。",
            "guomu2":"过目",
            "guomu2_info":"",
            "guomu3":"过目",
            "guomu3_info":"",
            "展图":"展图",
            "展图_info":"一名其他角色的出牌阶段开始时，你可以摸五张牌，然后交给其3张牌。若如此做，此阶段结束时，若该角色未于此阶段内杀死过一名角色，则你失去1点体力，回合结束时你可以弃置1张牌指定一名角色在其判定区内增加1张延迟锦囊",
            "zhantu5":"展图",
            "zhantu5_info":"",
            "zhantu2":"展图",
            "zhantu2_info":"",
            "zhantu3":"展图",
            "zhantu3_info":"",
            "忠胆":"忠胆",
            "忠胆_info":"当你使用的【杀】被闪抵消后，你可以摸两张牌然后将此【杀】或目标角色使用的【闪】交给一名该角色以外的其他角色,且你本回合出杀无次数限制，以此法获得红色牌的角色可以对你攻击范围内的角色使用一张【杀】，你使用杀造成的伤害+2",
            "zhongdan2":"忠胆",
            "zhongdan2_info":"锁定技，你的【杀】额外造成1点伤害",
            "采樵":"采樵",
            "采樵_info":"其他角色的结束阶段开始时，若你的手牌数与其相等，则你可以与其各摸两张牌，然后你回复1点体力。",
            "呢喃":"呢喃",
            "呢喃_info":"出牌阶段，你可以重铸【杀】并增加1点体力上限。出牌阶段结束时，若你于此阶段以此法重铸了至少两张【杀】，则你可以令一名男性角色摸3张牌增加2点体力上限然且你回复2点体力。",
            "ninan2":"呢喃",
            "ninan2_info":"",
            "祸乱":"祸乱",
            "祸乱_info":"结束阶段开始时，你可以弃置攻击范围内含有主公的一名其他角色的一张牌，令其摸2张牌，然后若其手牌比主公多，你摸2张牌增加1点体力上限",
            "贿赂":"贿赂",
            "贿赂_info":"每名角色限一次，当你受到其他角色造成的伤害时，你可选你的任意数量的牌令该角色观看，然后该角色选择：1.获得这些牌中的一张，然后防止伤害。2.弃置等量的牌，你免疫体力流失伤害，你受到的伤害最多为1",
            "huilu2":"贿赂",
            "huilu2_info":"你受到的伤害至多为1<br>你始终跳过弃牌阶段",
            "huilu3":"贿赂",
            "huilu3_info":"你免疫体力流失伤害",
            "昭烈":"昭烈",
            "昭烈_info":"当你回复1点体力或受到1点体力流失伤害时，你可以令一名其他角色回复2点体力或摸3张牌",
            "智心":"智心",
            "智心_info":"回合开始阶段开始时，你可以弃置所有手牌，若你以此法弃置的牌的张数与你的体力值不等，你回复1点体力，将手牌摸至体力上限。",
            "仁王":"仁王",
            "仁王_info":"当你一次获得或失去至少两张牌后，你可以令一名其他角色摸3张牌增加1点体力上限",
            "御驾":"御驾",
            "御驾_info":"弃牌阶段结束时，若你本回合内造成过伤害，你回复2点体力并摸2张牌",
            "烈武":"烈武",
            "烈武_info":"你可以将一张红色牌当[杀]使用，你不能成为杀和火攻的目标，你无视其防具，你使用杀或决斗造成的伤害+3",
            "liewu2":"烈武",
            "liewu2_info":"锁定技，你不能成为【杀】的目标",
            "liewu3":"烈武",
            "liewu3_info":"",
            "liewu4":"烈武",
            "liewu4_info":"",
            "恩断":"恩断",
            "恩断_info":"出牌阶段限一次，你可以与一名其他角色拼点，若你赢，则直到回合结束，该角色不能使用或打出手牌且其非锁定技失效且你获得技能咆哮直到回合结束，若你没赢，你可令该角色回复3点体力。",
            "enduan2":"恩断",
            "enduan2_info":"",
            "豪气":"豪气",
            "豪气_info":"你使用杀无次数限制，你可以装备任意数量的武器牌，你无视其防具，你免疫体力流失伤害，你不能被锦囊牌选中，你受到伤害时20%令其无效，你使用杀造成的伤害+5",
            "haoqi2":"豪气",
            "haoqi2_info":"锁定技，你不能成为延时类锦囊的目标",
            "haoqi3":"豪气",
            "haoqi3_info":"你可以额外装备任意数量的装备",
            "haoqi4":"豪气",
            "haoqi4_info":"你免疫体力流失伤害",
            "haoqi5":"豪气",
            "haoqi5_info":"当一名其他角色回复体力时，50%概率终止回复结算，然后你回复一点体力",
            "真假":"真假",
            "真假_info":"限定技，准备阶段开始时，你可以将体力回复至等同于你上回合结束时的体力值，然后你每以此法回复1点体力，便摸一张牌。",
            "zhenjia2":"真假",
            "zhenjia2_info":"",
            "haoqi6":"豪气",
            "haoqi6_info":"",
            "haoqi7":"豪气",
            "haoqi7_info":"锁定技，你的【杀】额外造成1点伤害",
            "绝尘":"绝尘",
            "绝尘_info":"你可以将[杀]当[闪]，或[闪]当[杀]使用或打出",
            "横枪":"横枪",
            "横枪_info":"每当你于回合外使用或打出一张手牌时，你可以亮出牌堆顶的一张牌，若此牌与你此次使用或打出的牌类别相同，你可以将之交给任意一名角色；若不同则你可以将之置入弃牌堆。",
            "咫尺":"咫尺",
            "咫尺_info":"每当你发动“绝尘”使用或打出一张手牌时，你可以立即获得对方的一张手牌并摸一张牌增加1点体力上限。",
            "longzhichi2":"咫尺",
            "longzhichi2_info":"",
            "longzhichi3":"咫尺",
            "longzhichi3_info":"",
            "沧海":"沧海",
            "沧海_info":"你受到伤害或体力流失后，你随机获得2张杀，并回复2点体力",
            "西凉":"西凉",
            "西凉_info":"出牌阶段你可以多使用2张杀,当你使用【杀】指定一名角色为目标后，你可以进行一次判定并令该角色的非锁定技失效直到回合结束且你回复2点体力摸两张牌，除非该角色弃置一张与判定结果花色相同的牌，否则不能使用【闪】抵消此【杀】。当你造成伤害后，你可以随机摸2张杀",
            "xiliang2":"西凉",
            "xiliang2_info":"受到伤害后，你可以从青钢剑，八卦阵，紫锌中随机获得2张，并失去1点体力",
            "谋杀":"谋杀",
            "谋杀_info":"一名其他角色的结束阶段开始时，若该角色本回合造成过伤害，你可以先摸2张牌然后对其使用一张【杀】。",
            "弃武":"弃武",
            "弃武_info":"觉醒技，当你造成一次伤害后，若你已受伤，你须减1点体力上限，摸2张牌并获得技能“从文”。",
            "从文":"从文",
            "从文_info":"出牌阶段限5次，你可以声明一种牌的类别或颜色，然后连续亮出牌堆顶的牌，直到亮出符合你声明的牌为止，选择一名男性角色，该角色获得此牌，再将其余以此法亮出的牌置入弃牌堆",
            "玉碎":"玉碎",
            "玉碎_info":"每当你成为其他角色的卡牌的目标时，你可以失去一点体力上限摸一张牌回复2点体力取消之，然后弃置对方2张牌",
            "孤险":"孤险",
            "孤险_info":"回合结束阶段，若你已受伤，可以增加3点体力上限并摸X张牌，然后可以将等量的牌交给一名其他角色，X为你已损失的体力值",
            "匡汉":"匡汉",
            "匡汉_info":"你受到伤害后令对你受到伤害的目标受到1点神圣火焰伤害，然后全场蜀国角色回复1点体力",
            "文昭":"文昭",
            "文昭_info":"当其他角色死亡后，你增加副将魏王称帝并回复3点体力，然后失去此技能",
            "横冲":"横冲",
            "横冲_info":"你收到普通伤害之前可以增加2点体力上限，并回复2点体力",
            "镇守2":"镇守",
            "镇守2_info":"",
            "白衣2":"白衣",
            "白衣2_info":"",
            "悟法":"悟法",
            "悟法_info":"你免疫所受到的普通属性伤害，改为增加1点体力上限流失1点体力，你每次使用或打出非转化锦囊牌可以回复1点体力",
            "悟法2":"悟法",
            "悟法2_info":"每当你使用一张非转化的普通锦囊牌，可以摸一张牌",
            "锦计":"锦计",
            "锦计_info":"锁定技，当你进入濒死状态时，你进行一次判定，若结果不为红桃，你将体力回复至1，你受到的伤害最多为2",
            "锦计2":"锦计",
            "锦计2_info":"",
            shenmou:"深谋",
            "shenmou_info":"锁定技，你每次造成伤害可以获得1枚谋标记，你每于弃牌阶段弃置一张牌获得1张谋",
            "shenmou2":"深谋",
            "shenmou2_info":"",
            "伟略":"伟略",
            "伟略_info":"出牌阶段，你可以弃置15枚谋来指定一名角色令其失去所有技能然后其死亡",
            "辩论":"辩论",
            "辩论_info":"出牌阶段开始时，你可与一名其他角色拼点。若你赢，你使用的下一张基本牌或普通锦囊牌可以额外指定任意一名其他角色为目标或减少指定一个目标；若你没赢，你使用锦囊牌可以摸2张牌并回复1点体力",
            "辩论2":"辩论",
            "辩论2_info":"",
            "辩论3":"辩论",
            "辩论3_info":"每当你使用一张非转化的普通锦囊牌，可以摸一张牌",
            "使臣":"使臣",
            "使臣_info":"每当你拼点赢，你可以获得对方此次拼点的牌；每当你拼点没赢，你可以收回你此次拼点的牌， 你不能成为延迟类锦囊牌的目标",
        },
    },
},files:{"character":["十二奇策.jpg","魏武霸业.jpg","虎将无双.jpg","雷霆之威.jpg","清流雅望.jpg","下辩扬威.jpg","立嗣陷危.jpg","魏武东临.jpg","醉玉颓山.jpg","白衣渡江.jpg","一统江山.jpg","狂傲不羁.jpg","观星唤雨.jpg","战神金刚.jpg","魏王称帝.jpg","绰约多姿.jpg","从征四方.jpg","烽火乱世.jpg","挤眉弄眼.jpg","猛击劈浪.jpg","浴火士元.jpg","龙吟九霄.jpg","一言不发.jpg","计斩妙才.jpg","白眉智士.jpg","平北将军.jpg","智擒严颜.jpg","老骥伏枥.jpg","绝色异彩.jpg","侠义谋略.jpg","寒光凛然.jpg","空城退敌.jpg","业火红莲.jpg","恢拓洪业.jpg","武继先人.jpg","彪劲虎卫.jpg","神兵天降.jpg","抬棺决死.jpg","握筹布画.jpg","镇卫江夏.jpg","破羌攻胡.jpg","镇守魏南.jpg","轻舞花烛.jpg","胸中兵甲.jpg","浴火蛮神.jpg","婉娩流逸.jpg","鬼谋乱世.jpg","翩若惊鸿.jpg","符檄擅声.jpg","枪碎星河.jpg","明以举贤.jpg","单骑千里.jpg","挥剑惊石.jpg","仁爱神童.jpg","七步绝章.jpg","精练策数.jpg","辅政平乱.jpg","破虏大将.jpg","御驾亲征.jpg","诗礼之训.jpg","逸群之才.jpg","忠勇当先.jpg","单刀赴会.jpg","持权贪贿.jpg","断石酬志.jpg","大展宏图.jpg","西凉雄狮.jpg","试尝百草.jpg","舐犊情深.jpg","一世风华.jpg","佳期若梦.jpg","烈帝后裔.jpg","威震华夏.jpg","傲雪凌霜.jpg","势如破竹.jpg","采映荷灯.jpg","心系君魂.jpg","猛勇精进.jpg","威重严整.jpg","身先士卒.jpg","谑浪笑傲.jpg"],"card":[],"skill":[]}})